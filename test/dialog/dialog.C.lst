0001   0000                 DEVICE ZXSPECTRUM128
0002   0000             
0003   0000                 include "../module.inc"
0001+  0000             ;romAddr        = 0
0002+  0000             ;screenAddr     = 4000h
0003+  0000             ;cacheAddr      = 5B00h
0004+  0000             
0005+  0000             irqTableAddr      = 5F00h
0006+  0000             irqAddr           = 6060h
0007+  0000             stackBeginAddr    = 6001h
0008+  0000             stackEndAddr      = 605Fh
0009+  0000             baseAddr          = 6063h
0010+  0000             moduleLoadAddr    = 7000h
0011+  0000             moverAddr         = 8000h
0012+  0000             
0013+  0000             gEnd = baseAddr
0014+  0000             
0015+  0000             ; Функции
0016+  0000             gDrawText         = gEnd
0017+  0000             gEnd = gEnd + 3
0018+  0000             gDrawTextCenter   = gEnd
0019+  0000             gEnd = gEnd + 3
0020+  0000             gDrawTextEx       = gEnd
0021+  0000             gEnd = gEnd + 3
0022+  0000             gClearScreen      = gEnd
0023+  0000             gEnd = gEnd + 3
0024+  0000             gDrawImage        = gEnd
0025+  0000             gEnd = gEnd + 3
0026+  0000             gMeasureText      = gEnd
0027+  0000             gEnd = gEnd + 3
0028+  0000             gCalcCoords       = gEnd
0029+  0000             gEnd = gEnd + 3
0030+  0000             gDrawCharSub      = gEnd
0031+  0000             gEnd = gEnd + 3
0032+  0000             gExec             = gEnd
0033+  0000             gEnd = gEnd + 3
0034+  0000             gLoadFile         = gEnd
0035+  0000             gEnd = gEnd + 3
0036+  0000             gFarCall          = gEnd
0037+  0000             gEnd = gEnd + 3
0038+  0000             gIrqHandler       = gEnd
0039+  0000             gEnd = gEnd + 3
0040+  0000             gDrawPanel        = gEnd
0041+  0000             gEnd = gEnd + 3
0042+  0000             gBeginDraw        = gEnd
0043+  0000             gEnd = gEnd + 3
0044+  0000             gEndDraw          = gEnd
0045+  0000             gEnd = gEnd + 3
0046+  0000             gCopyVideoPage    = gEnd
0047+  0000             gEnd = gEnd + 3
0048+  0000             gPanelRedraw      = gEnd
0049+  0000             gEnd = gEnd + 3
0050+  0000             gCopyPanel        = gEnd
0051+  0000             gEnd = gEnd + 3
0052+  0000             gStringBuffer     = gEnd
0053+  0000             gStringBufferSize = 32
0054+  0000             gEnd = gEnd + gStringBufferSize
0055+  0000             
0056+  0000             ; Переменные
0057+  0000             gFrame            = gEnd
0058+  0000             gEnd = gEnd + 1
0059+  0000             gVideoPage        = gEnd
0060+  0000             gEnd = gEnd + 1
0061+  0000             gSystemPage       = gEnd
0062+  0000             gEnd = gEnd + 1
0063+  0000             gKeyTrigger       = gEnd
0064+  0000             gEnd = gEnd + 1
0065+  0000             gKeyPressed       = gEnd
0066+  0000             gEnd = gEnd + 1
0067+  0000             gPlayerMoney      = gEnd
0068+  0000             gEnd = gEnd + 2
0069+  0000             gPlayerLut        = gEnd
0070+  0000             playerLutMax = 12
0071+  0000             gEnd = gEnd + 2 * playerLutMax
0072+  0000             gPlayerLutCount   = gEnd
0073+  0000             gEnd = gEnd + 1
0074+  0000             gPlayerItems      = gEnd
0075+  0000             playerItemsMax = 5
0076+  0000             gEnd = gEnd + playerItemsMax
0077+  0000             gPlayerItemsCount = gEnd
0078+  0000             gEnd = gEnd + 1
0079+  0000             gPanelChangedA    = gEnd
0080+  0000             gEnd = gEnd + 1
0081+  0000             gPanelChangedB    = gEnd
0082+  0000             gEnd = gEnd + 1
0083+  0000             gPlayerSecondWeaponCount = gEnd
0084+  0000             gEnd = gEnd + 1
0085+  0000             gPlayerSecondWeaponCounters = gEnd
0086+  0000             secondWeaponMax = 9
0087+  0000             gEnd = gEnd + secondWeaponMax
0088+  0000             gPlayerSecondWeaponSel = gEnd
0089+  0000             gEnd = gEnd + 1
0090+  0000             
0091+  0000             ; Другие модули
0092+  0000             gPanelgraphPage = 6
0093+  0000             gPanelgraph = 0C003h
0094+  0000             gPanelX = 0
0095+  0000             gPanelY = 20
0096+  0000             
0004   0000             
0005   0000                 org 0C000h
0006   C000             
0007   C000             begin: 
0008   C000 C3 E3 D0        jp   invent
0009   C003 C3 FA D3        jp   panelFullRedraw
0010   C006 C3 07 D4        jp   panelRedrawImages
0011   C009 C3 1B C3        jp   shopMain
0012   C00C             
0013   C00C             ;-----------------------------------------------------------------------------------------------------------------------
0014   C00C             
0015   C00C             callIx: 
0016   C00C DD E9           jp   ix
0017   C00E             
0018   C00E             ;-----------------------------------------------------------------------------------------------------------------------
0019   C00E             
0001   C00E             ; HL делится на DE, результат в HL, остаток в DE
0002   C00E             
0003   C00E EB          div16:   EX HL, DE
0004   C00F 7C          _DIV: 	LD A,H
0005   C010 B5                  OR L
0006   C011 C8                  RET Z
0007   C012 01 00 00            LD BC,0000
0008   C015 C5                  PUSH BC
0009   C016 7B          _DIV1: 	LD A,E
0010   C017 95          	SUB L
0011   C018 7A                  LD A,D
0012   C019 9C                  SBC H
0013   C01A DA 22 C0            JP C, _DIV2
0014   C01D E5                  PUSH HL
0015   C01E 29                  ADD HL, HL
0016   C01F D2 16 C0            JP NC, _DIV1
0017   C022 21 00 00    _DIV2: 	LD HL,0000
0018   C025 C1          _DIV3: 	POP BC
0019   C026 78                  LD A,B
0020   C027 B1                  OR C
0021   C028 C8                  RET Z
0022   C029 29                  ADD HL, HL
0023   C02A D5                  PUSH DE
0024   C02B 7B                  LD A,E
0025   C02C 91          	SUB C
0026   C02D 5F                  LD E,A
0027   C02E 7A                  LD A,D
0028   C02F 98                  SBC B
0029   C030 57                  LD D,A
0030   C031 DA 39 C0            JP C, _DIV4
0031   C034 23                  INC HL
0032   C035 C1                  POP BC
0033   C036 C3 25 C0            JP _DIV3
0034   C039 D1          _DIV4: 	POP DE
0035   C03A C3 25 C0            JP _DIV3
0036   C03D             
0001   C03D                 ; dialog/alg.c:2 
0002   C03D                 ; common.h:2 const int itemsCount = 8;
0003   C03D                 ; common.h:3 
0004   C03D                 ; common.h:4 // Размер глобального строкового буфера
0005   C03D                 ; common.h:5 const int gStringBufferSize = 32;
0006   C03D                 ; common.h:6 
0007   C03D                 ; common.h:7 // Флаги для переменных gPanelChangedA, gPanelChangedB
0008   C03D                 ; common.h:8 const int gPanelChangedMoney = 0x01;
0009   C03D                 ; common.h:9 const int gPanelChangedPlace = 0x02;
0010   C03D                 ; common.h:10 //const int gPanelChangedImages = 0x04;
0011   C03D                 ; common.h:11 const int gPanelChanedSecondWeaponCount = 0x08;
0012   C03D                 ; common.h:12 const int gPanelChanedArmorCount = 0x10;
0013   C03D                 ; common.h:13 
0014   C03D                 ; common.h:14 // Максимальное кол-во символов (не учитывая терминатор строки), которое возращает функция numberToString16
0015   C03D                 ; common.h:15 const int numberToString16max = 5;
0016   C03D                 ; common.h:16 
0017   C03D                 ; common.h:17 // Максимальное кол-во предметов у игрока
0018   C03D                 ; common.h:18 const int playerItemsMax = 5;
0019   C03D                 ; common.h:19 
0020   C03D                 ; common.h:20 // Максимальное кол-во типов лута у игрока (кол-во отображаемых строк в инвентаре)
0021   C03D                 ; common.h:21 const int playerLutMax = 12;
0022   C03D                 ; common.h:22 
0023   C03D                 ; common.h:23 // Максимальное кол-во лута у игрока (сумма)
0024   C03D                 ; common.h:24 const int playerLutMaxCountInLine = 99;
0025   C03D                 ; common.h:25 
0026   C03D                 ; common.h:26 const int secondWeaponMax = 9;
0027   C03D                 ; common.h:27 
0028   C03D                 ; common.h:28 // Флаги клавиш для переменные gKeyPressed, gKeyTrigger
0029   C03D                 ; common.h:29 const int KEY_UP = 1;
0030   C03D                 ; common.h:30 const int KEY_DOWN = 2;
0031   C03D                 ; common.h:31 const int KEY_LEFT = 4;
0032   C03D                 ; common.h:32 const int KEY_RIGHT = 8;
0033   C03D                 ; common.h:33 const int KEY_FIRE = 16;
0034   C03D                 ; common.h:34 const int KEY_MENU = 32;
0035   C03D                 ; common.h:35 
0036   C03D                 ; common.h:36 // Стандартные адреса ZX Spectrum
0037   C03D                 ; common.h:37 const int screenBw0 = 0x4000;
0038   C03D                 ; common.h:38 const int screenAttr0 = 0x5800;
0039   C03D                 ; common.h:39 
0040   C03D                 ; common.h:40 // Размеры экрана
0041   C03D                 ; common.h:41 const int screenWidthTails = 32;
0042   C03D                 ; common.h:42 const int panelHeightTails = 4;
0043   C03D                 ; common.h:43 const int tailHeight = 8;
0044   C03D                 ; common.h:44 const int tailWidth = 8;
0045   C03D                 ; common.h:45 const int playfieldHeightTails = 20;
0046   C03D                 ; common.h:46 
0047   C03D                 ; common.h:47 // Используется при упаковке координат X, Y в регистровую пару
0048   C03D                 ; common.h:48 const int bpl = 256;
0049   C03D                 ; common.h:49 
0050   C03D                 ; common.h:50 // Точки входа
0051   C03D                 ; common.h:51 const int gPanelRedrawImagesPage = 6;
0052   C03D                 ; common.h:52 const int gPanelRedrawImages = 0xC006;
0053   C03D                 ; common.h:53 const int gInventPage = 6;
0054   C03D                 ; common.h:54 const int gInvent = 0xC000;
0055   C03D                 ; common.h:55 
0056   C03D                 ; common.h:56 // Параметр для drawText
0057   C03D                 ; common.h:57 const int smallFontFlag = 0x80;
0058   C03D                 ; common.h:58 
0059   C03D                 ; dialog/alg.c:3 const int colorCursor = 0x43;
0060   C03D                 ; dialog/alg.c:4 const int colorText   = 0x47;
0061   C03D                 ; dialog/alg.c:5 const int colorItem   = 0x45;
0062   C03D                 ; dialog/alg.c:6 const int colorPrice  = 0x44;
0063   C03D                 ; dialog/alg.c:7 
0064   C03D                 ; dialog/alg.c:8 uint16_t shopText;
0065   C03D 00 00       shopText dw 0
0066   C03F                 ; dialog/alg.c:9 uint16_t shopGetLine;
0067   C03F 00 00       shopGetLine dw 0
0068   C041                 ; dialog/alg.c:10 uint8_t shopX;
0069   C041 00          shopX db 0
0070   C042                 ; dialog/alg.c:11 uint8_t shopY;
0071   C042 00          shopY db 0
0072   C043                 ; dialog/alg.c:12 uint8_t shopW;
0073   C043 00          shopW db 0
0074   C044                 ; dialog/alg.c:13 uint8_t shopH;
0075   C044 00          shopH db 0
0076   C045                 ; dialog/alg.c:14 const int shopLineHeight = 10;
0077   C045                 ; dialog/alg.c:15 uint16_t dialogCursor;
0078   C045 00 00       dialogCursor dw 0
0079   C047                 ; dialog/alg.c:16 uint8_t dialogX;
0080   C047 00          dialogX db 0
0081   C048                 ; dialog/alg.c:17 uint8_t dialogX1;
0082   C048 00          dialogX1 db 0
0083   C049                 ; dialog/alg.c:18 
0084   C049                 ; dialog/alg.c:19 //---------------------------------------------------------------------------------------------------------------------
0085   C049                 ; dialog/alg.c:20 // Вход: ix - функция динамического текста, iyh - режим, de - указатель на текст
0086   C049                 ; dialog/alg.c:21 // Вход: de - указатель на следующий текст, iyh - новый режим
0087   C049                 ; dialog/alg.c:22 // Сохраняет: hl, ix, iyl
0088   C049                 ; dialog/alg.c:23 
0089   C049                 ; dialog/alg.c:24 void shopNextLine()
0090   C049             shopNextLine: 
0091   C049                 ; dialog/alg.c:25 {
0092   C049                 ; dialog/alg.c:26 // Вывод статического текста
0093   C049                 ; dialog/alg.c:27 if (flag_z (a = iyh) & 0x80)
0094   C049 FD 7C           ld   a, iyh
0095   C04B CB 7F           bit  7, a
0096   C04D                 ; dialog/alg.c:28 {
0097   C04D C2 5C C0        jp   nz, l0
0098   C050                 ; dialog/alg.c:29 do { a = *de; de++; } while(a >= 32);
0099   C050             l1: 
0100   C050 1A              ld   a, (de)
0101   C051 13              inc  de
0102   C052 FE 20           cp   32
0103   C054 D2 50 C0        jp   nc, l1
0104   C057             l2: 
0105   C057                 ; dialog/alg.c:30 if (flag_nz a |= a) return; // nz
0106   C057 B7              or   a
0107   C058 C0              ret  nz
0108   C059                 ; dialog/alg.c:31 // Переход к динамическому тексту
0109   C059                 ; dialog/alg.c:32 iyh = 0x80;
0110   C059 FD 26 80        ld   iyh, 128
0111   C05C                 ; dialog/alg.c:33 }
0112   C05C                 ; dialog/alg.c:34 // Вывод динамического текста
0113   C05C                 ; dialog/alg.c:35 if (flag_z a |= ixl) return; // z
0114   C05C             l0: 
0115   C05C DD B5           or   ixl
0116   C05E C8              ret  z
0117   C05F                 ; dialog/alg.c:36 (a = iyh) &= 0x7F; iyh++;
0118   C05F FD 7C           ld   a, iyh
0119   C061 E6 7F           and  127
0120   C063 FD 24           inc  iyh
0121   C065                 ; dialog/alg.c:37 push(hl)
0122   C065                 ; dialog/alg.c:38 {
0123   C065 E5              push hl
0124   C066                 ; dialog/alg.c:39 callIx(); // Вход: a - номер. Выход: hl - текст. Портит: a, bc, de
0125   C066 CD 0C C0        call callIx
0126   C069                 ; dialog/alg.c:40 ex(hl, de);
0127   C069 EB              ex de, hl
0128   C06A                 ; dialog/alg.c:41 }
0129   C06A E1              pop  hl
0130   C06B                 ; dialog/alg.c:42 (a = d) |= e; // return z/nz
0131   C06B 7A              ld   a, d
0132   C06C B3              or   e
0133   C06D                 ; dialog/alg.c:43 }
0134   C06D C9              ret
0135   C06E                 ; dialog/alg.c:44 
0136   C06E                 ; dialog/alg.c:45 //---------------------------------------------------------------------------------------------------------------------
0137   C06E                 ; dialog/alg.c:46 // Алгоритм диалога
0138   C06E                 ; dialog/alg.c:47 
0139   C06E                 ; dialog/alg.c:48 const int tailSize = 8;
0140   C06E                 ; dialog/alg.c:49 const int shopTopPadding = 4;
0141   C06E                 ; dialog/alg.c:50 const int shopAnswerSeparatorHeight = 4;
0142   C06E                 ; dialog/alg.c:51 
0143   C06E                 ; dialog/alg.c:52 void shopStart(de, ix)
0144   C06E             shopStart: 
0145   C06E                 ; dialog/alg.c:53 {
0146   C06E                 ; dialog/alg.c:54 shopText = de;
0147   C06E ED 53 3D C0     ld   (shopText), de
0148   C072                 ; dialog/alg.c:55 shopGetLine = ix;
0149   C072 DD 22 3F C0     ld   (shopGetLine), ix
0150   C076                 ; dialog/alg.c:56 
0151   C076                 ; dialog/alg.c:57 // ВЫЧИСЛЕНИЕ РАЗМЕРА
0152   C076                 ; dialog/alg.c:58 
0153   C076                 ; dialog/alg.c:59 ex(bc, de, hl);
0154   C076 D9              exx
0155   C077                 ; dialog/alg.c:60 hl` = 0; // h` - ширина цен, l` - ширина товаров
0156   C077 21 00 00        ld   hl, 0
0157   C07A                 ; dialog/alg.c:61 ex(bc, de, hl);
0158   C07A D9              exx
0159   C07B                 ; dialog/alg.c:62 hl = shopTopPadding; // h - ширина назчаний, l - высота всех элементов
0160   C07B 21 04 00        ld   hl, 4
0161   C07E                 ; dialog/alg.c:63 iy = 0; // iyl - режим ответов, iyh - режим динамического текста
0162   C07E FD 21 00 00     ld   iy, 0
0163   C082                 ; dialog/alg.c:64 // de - указатель на текст
0164   C082                 ; dialog/alg.c:65 do
0165   C082             l3: 
0166   C082                 ; dialog/alg.c:66 {
0167   C082                 ; dialog/alg.c:67 push(de)
0168   C082                 ; dialog/alg.c:68 {
0169   C082 D5              push de
0170   C083                 ; dialog/alg.c:69 push(hl)
0171   C083                 ; dialog/alg.c:70 {
0172   C083 E5              push hl
0173   C084                 ; dialog/alg.c:71 gMeasureText(); // Вход: de - текст. Выход: de - текст, a - терминатор, c - ширина в пикселях. Портит: b, hl.
0174   C084 CD 72 60        call gMeasureText
0175   C087                 ; dialog/alg.c:72 }
0176   C087 E1              pop  hl
0177   C088                 ; dialog/alg.c:73 
0178   C088                 ; dialog/alg.c:74 ex(a); // Сохраняем термиатор
0179   C088 08              ex   af, af
0180   C089                 ; dialog/alg.c:75 a = c;
0181   C089 79              ld   a, c
0182   C08A                 ; dialog/alg.c:76 if (a != 0)
0183   C08A B7              or   a
0184   C08B                 ; dialog/alg.c:77 {
0185   C08B CA B9 C0        jp   z, l5
0186   C08E                 ; dialog/alg.c:78 a += iyl; // Добавляем отступ ответов
0187   C08E FD 85           add  iyl
0188   C090                 ; dialog/alg.c:79 ex(a);
0189   C090 08              ex   af, af
0190   C091                 ; dialog/alg.c:80 if (a == 9) // Если есть цена
0191   C091 FE 09           cp   9
0192   C093                 ; dialog/alg.c:81 {
0193   C093 C2 AF C0        jp   nz, l6
0194   C096                 ; dialog/alg.c:82 ex(bc, de, hl);
0195   C096 D9              exx
0196   C097                 ; dialog/alg.c:83 ex(a);
0197   C097 08              ex   af, af
0198   C098                 ; dialog/alg.c:84 if (a >= l`) l` = a;  // Вычисляем максимальную ширину
0199   C098 BD              cp   l
0200   C099 DA 9D C0        jp   c, l7
0201   C09C 6F              ld   l, a
0202   C09D                 ; dialog/alg.c:85 ex(bc, de, hl);
0203   C09D             l7: 
0204   C09D D9              exx
0205   C09E                 ; dialog/alg.c:86 
0206   C09E                 ; dialog/alg.c:87 push(hl)
0207   C09E                 ; dialog/alg.c:88 {
0208   C09E E5              push hl
0209   C09F                 ; dialog/alg.c:89 gMeasureText();
0210   C09F CD 72 60        call gMeasureText
0211   C0A2                 ; dialog/alg.c:90 }
0212   C0A2 E1              pop  hl
0213   C0A3                 ; dialog/alg.c:91 // Учет ширины и высоты
0214   C0A3                 ; dialog/alg.c:92 
0215   C0A3                 ; dialog/alg.c:93 ex(a); // Сохраняем термиатор
0216   C0A3 08              ex   af, af
0217   C0A4                 ; dialog/alg.c:94 a = c;
0218   C0A4 79              ld   a, c
0219   C0A5                 ; dialog/alg.c:95 ex(bc, de, hl);
0220   C0A5 D9              exx
0221   C0A6                 ; dialog/alg.c:96 if (a >= h`) h` = a;  // Вычисляем максимальную ширину
0222   C0A6 BC              cp   h
0223   C0A7 DA AB C0        jp   c, l8
0224   C0AA 67              ld   h, a
0225   C0AB                 ; dialog/alg.c:97 ex(bc, de, hl);
0226   C0AB             l8: 
0227   C0AB D9              exx
0228   C0AC                 ; dialog/alg.c:98 }
0229   C0AC                 ; dialog/alg.c:99 else
0230   C0AC C3 B5 C0        jp   l9
0231   C0AF             l6: 
0232   C0AF                 ; dialog/alg.c:100 {
0233   C0AF                 ; dialog/alg.c:101 ex(a);
0234   C0AF 08              ex   af, af
0235   C0B0                 ; dialog/alg.c:102 if (a >= h) h = a; // Вычисляем максимальную ширину
0236   C0B0 BC              cp   h
0237   C0B1 DA B5 C0        jp   c, l10
0238   C0B4 67              ld   h, a
0239   C0B5                 ; dialog/alg.c:103 }
0240   C0B5             l10: 
0241   C0B5             l9: 
0242   C0B5                 ; dialog/alg.c:104 l = ((a = l) += shopLineHeight); // Вычисляем высоту
0243   C0B5 7D              ld   a, l
0244   C0B6 C6 0A           add  10
0245   C0B8 6F              ld   l, a
0246   C0B9                 ; dialog/alg.c:105 }
0247   C0B9                 ; dialog/alg.c:106 ex(a);
0248   C0B9             l5: 
0249   C0B9 08              ex   af, af
0250   C0BA                 ; dialog/alg.c:107 
0251   C0BA                 ; dialog/alg.c:108 // Если строка оканчивается кодом 13, то далее идут ответы
0252   C0BA                 ; dialog/alg.c:109 if (a == 13)
0253   C0BA FE 0D           cp   13
0254   C0BC                 ; dialog/alg.c:110 {
0255   C0BC C2 C6 C0        jp   nz, l11
0256   C0BF                 ; dialog/alg.c:111 iyl = tailSize; // Отступ для ответов
0257   C0BF FD 2E 08        ld   iyl, 8
0258   C0C2                 ; dialog/alg.c:112 l = ((a = l) += [shopAnswerSeparatorHeight]); // Отступ ответов. Это примерно половина высота строки. Это гарантирует отсутсвтие клешинга.
0259   C0C2 7D              ld   a, l
0260   C0C3 C6 04           add  4
0261   C0C5 6F              ld   l, a
0262   C0C6                 ; dialog/alg.c:113 }
0263   C0C6                 ; dialog/alg.c:114 }
0264   C0C6             l11: 
0265   C0C6 D1              pop  de
0266   C0C7                 ; dialog/alg.c:115 
0267   C0C7                 ; dialog/alg.c:116 // Следующая строка
0268   C0C7                 ; dialog/alg.c:117 shopNextLine();
0269   C0C7 CD 49 C0        call shopNextLine
0270   C0CA                 ; dialog/alg.c:118 } while(flag_nz);
0271   C0CA C2 82 C0        jp   nz, l3
0272   C0CD             l4: 
0273   C0CD                 ; dialog/alg.c:119 
0274   C0CD                 ; dialog/alg.c:120 // Преобразование пикселей в знакоместа
0275   C0CD                 ; dialog/alg.c:121 ex(bc, de, hl);
0276   C0CD D9              exx
0277   C0CE                 ; dialog/alg.c:122 a = h`;
0278   C0CE 7C              ld   a, h
0279   C0CF                 ; dialog/alg.c:123 if (flag_nz a |= a) a += tailSize; // Если есть цена, то добавляем разделитель в одно знакоместо между наименованием и ценой.
0280   C0CF B7              or   a
0281   C0D0 CA D5 C0        jp   z, l12
0282   C0D3 C6 08           add  8
0283   C0D5                 ; dialog/alg.c:124 a += l`; // Суммируем ширину наименований и цен
0284   C0D5             l12: 
0285   C0D5 85              add  l
0286   C0D6                 ; dialog/alg.c:125 ex(bc, de, hl);
0287   C0D6 D9              exx
0288   C0D7                 ; dialog/alg.c:126 if (a < h) a = h;
0289   C0D7 BC              cp   h
0290   C0D8 D2 DC C0        jp   nc, l13
0291   C0DB 7C              ld   a, h
0292   C0DC                 ; dialog/alg.c:127 
0293   C0DC                 ; dialog/alg.c:128 h = ((a += 7) >>= 3); shopW = a; // Преобразуем в знакоместа
0294   C0DC             l13: 
0295   C0DC C6 07           add  7
0296   C0DE CB 3F           srl  a
0297   C0E0 CB 3F           srl  a
0298   C0E2 CB 3F           srl  a
0299   C0E4 67              ld   h, a
0300   C0E5 32 43 C0        ld   (shopW), a
0301   C0E8                 ; dialog/alg.c:129 l = (((a = l) += 7) >>= 3); shopH = a; // Преобразуем в знакоместа
0302   C0E8 7D              ld   a, l
0303   C0E9 C6 07           add  7
0304   C0EB CB 3F           srl  a
0305   C0ED CB 3F           srl  a
0306   C0EF CB 3F           srl  a
0307   C0F1 6F              ld   l, a
0308   C0F2 32 44 C0        ld   (shopH), a
0309   C0F5                 ; dialog/alg.c:130 shopX = (((a = [32 - 2]) -= h) >>= 1); // Вычисляем положение диалога
0310   C0F5 3E 1E           ld   a, 30
0311   C0F7 94              sub  h
0312   C0F8 CB 3F           srl  a
0313   C0FA 32 41 C0        ld   (shopX), a
0314   C0FD                 ; dialog/alg.c:131 shopY = (((a = [20 - 3]) -= l) >>= 1);
0315   C0FD 3E 11           ld   a, 17
0316   C0FF 95              sub  l
0317   C100 CB 3F           srl  a
0318   C102 32 42 C0        ld   (shopY), a
0319   C105                 ; dialog/alg.c:132 
0320   C105                 ; dialog/alg.c:133 // РИСОВАНИЕ
0321   C105                 ; dialog/alg.c:134 
0322   C105                 ; dialog/alg.c:135 // Выбираем 0-ую страницу для рисования
0323   C105                 ; dialog/alg.c:136 gBeginDraw();
0324   C105 CD 8A 60        call gBeginDraw
0325   C108                 ; dialog/alg.c:137 gFarCall(iyl = 7, ix = &gPanelRedraw);
0326   C108 FD 2E 07        ld   iyl, 7
0327   C10B DD 21 93 60     ld   ix, gPanelRedraw
0328   C10F CD 81 60        call gFarCall
0329   C112                 ; dialog/alg.c:138 
0330   C112                 ; dialog/alg.c:139 // Рисуем рамку
0331   C112                 ; dialog/alg.c:140 hl = shopX; // И за одно shopY
0332   C112 2A 41 C0        ld   hl, (shopX)
0333   C115                 ; dialog/alg.c:141 calcAddr(); // bc - чб, hl = цвет
0334   C115 CD 63 C2        call calcAddr
0335   C118                 ; dialog/alg.c:142 iy = shopW; // И за одно shopH
0336   C118 FD 2A 43 C0     ld   iy, (shopW)
0337   C11C                 ; dialog/alg.c:143 drawDialog2(de = &dialogrect_0, bc, hl, iyl);
0338   C11C 11 1C C9        ld   de, dialogrect_0
0339   C11F CD 33 C2        call drawDialog2
0340   C122                 ; dialog/alg.c:144 do
0341   C122             l14: 
0342   C122                 ; dialog/alg.c:145 {
0343   C122                 ; dialog/alg.c:146 drawDialog2(de = &dialogrect_3, bc, hl, iyl);
0344   C122 11 37 C9        ld   de, dialogrect_3
0345   C125 CD 33 C2        call drawDialog2
0346   C128                 ; dialog/alg.c:147 } while(flag_nz --iyh);
0347   C128 FD 25           dec  iyh
0348   C12A C2 22 C1        jp   nz, l14
0349   C12D             l15: 
0350   C12D                 ; dialog/alg.c:148 drawDialog2(de = &dialogrect_6, bc, hl, iyl);
0351   C12D 11 52 C9        ld   de, dialogrect_6
0352   C130 CD 33 C2        call drawDialog2
0353   C133                 ; dialog/alg.c:149 drawSprite2(bc, de, hl);
0354   C133 CD 97 C8        call drawSprite2
0355   C136                 ; dialog/alg.c:150 
0356   C136                 ; dialog/alg.c:151 *[&shopStartColor + 1] = a = colorText;
0357   C136 3E 47           ld   a, 71
0358   C138 32 5D C1        ld   ((shopStartColor) + (1)), a
0359   C13B                 ; dialog/alg.c:152 // Рисуем текст
0360   C13B                 ; dialog/alg.c:153 ix = shopGetLine;  // ix - функция динамического текста
0361   C13B DD 2A 3F C0     ld   ix, (shopGetLine)
0362   C13F                 ; dialog/alg.c:154 de = shopText;     // de - статический текст
0363   C13F ED 5B 3D C0     ld   de, (shopText)
0364   C143                 ; dialog/alg.c:155 hl = shopX;        // hl - Координаты для вывода текста в знакоместах
0365   C143 2A 41 C0        ld   hl, (shopX)
0366   C146                 ; dialog/alg.c:156 (((hl += hl) += hl) += hl) += (bc = [(tailSize + shopTopPadding) * 256 + tailSize]); // Вычисляем координаты в внутри рамки в пикселях
0367   C146 29              add  hl, hl
0368   C147 29              add  hl, hl
0369   C148 29              add  hl, hl
0370   C149 01 08 0C        ld   bc, 3080
0371   C14C 09              add  hl, bc
0372   C14D                 ; dialog/alg.c:157 dialogCursor = hl; // hl - координаты первого ответа (что бы не было глюка, если программист забудет в диалоге описать варианты ответов)
0373   C14D 22 45 C0        ld   (dialogCursor), hl
0374   C150                 ; dialog/alg.c:158 iy = 0;            // iyl - кол-во ответов, iyh - режим динамического текста
0375   C150 FD 21 00 00     ld   iy, 0
0376   C154                 ; dialog/alg.c:159 do
0377   C154             l16: 
0378   C154                 ; dialog/alg.c:160 {
0379   C154                 ; dialog/alg.c:161 a = *de;
0380   C154 1A              ld   a, (de)
0381   C155                 ; dialog/alg.c:162 if (a >= ' ')
0382   C155 FE 20           cp   32
0383   C157                 ; dialog/alg.c:163 {
0384   C157 DA 8B C1        jp   c, l18
0385   C15A                 ; dialog/alg.c:164 push(de)
0386   C15A                 ; dialog/alg.c:165 {
0387   C15A D5              push de
0388   C15B                 ; dialog/alg.c:166 push(hl)
0389   C15B                 ; dialog/alg.c:167 {
0390   C15B E5              push hl
0391   C15C                 ; dialog/alg.c:168 shopStartColor: a = colorText;
0392   C15C             shopStartColor: 
0393   C15C 3E 47           ld   a, 71
0394   C15E                 ; dialog/alg.c:169 gDrawTextEx(hl, de, a); // Выводим наименование
0395   C15E CD 69 60        call gDrawTextEx
0396   C161                 ; dialog/alg.c:170 }
0397   C161 E1              pop  hl
0398   C162                 ; dialog/alg.c:171 if (a == 9)
0399   C162 FE 09           cp   9
0400   C164                 ; dialog/alg.c:172 {
0401   C164 C2 86 C1        jp   nz, l19
0402   C167                 ; dialog/alg.c:173 push(hl)
0403   C167                 ; dialog/alg.c:174 {
0404   C167 E5              push hl
0405   C168                 ; dialog/alg.c:175 push(de, hl)
0406   C168                 ; dialog/alg.c:176 {
0407   C168 D5              push de
0408   C169 E5              push hl
0409   C16A                 ; dialog/alg.c:177 gMeasureText(); // Вычисляем ширину цены, что бы прижать её к правому краю
0410   C16A CD 72 60        call gMeasureText
0411   C16D                 ; dialog/alg.c:178 }
0412   C16D E1              pop  hl
0413   C16E D1              pop  de
0414   C16F                 ; dialog/alg.c:179 l = a = shopW;
0415   C16F 3A 43 C0        ld   a, (shopW)
0416   C172 6F              ld   l, a
0417   C173                 ; dialog/alg.c:180 (a = shopX) += l;
0418   C173 3A 41 C0        ld   a, (shopX)
0419   C176 85              add  l
0420   C177                 ; dialog/alg.c:181 a++;
0421   C177 3C              inc  a
0422   C178                 ; dialog/alg.c:182 a <<= 3;
0423   C178 CB 27           sla  a
0424   C17A CB 27           sla  a
0425   C17C CB 27           sla  a
0426   C17E                 ; dialog/alg.c:183 l = (a -= c);
0427   C17E 91              sub  c
0428   C17F 6F              ld   l, a
0429   C180                 ; dialog/alg.c:184 gDrawTextEx(hl, de, a = colorPrice); // Выводим цену
0430   C180 3E 44           ld   a, 68
0431   C182 CD 69 60        call gDrawTextEx
0432   C185                 ; dialog/alg.c:185 }
0433   C185 E1              pop  hl
0434   C186                 ; dialog/alg.c:186 }
0435   C186                 ; dialog/alg.c:187 }
0436   C186             l19: 
0437   C186 D1              pop  de
0438   C187                 ; dialog/alg.c:188 hl += (bc = [shopLineHeight * 256]);
0439   C187 01 00 0A        ld   bc, 2560
0440   C18A 09              add  hl, bc
0441   C18B                 ; dialog/alg.c:189 }
0442   C18B                 ; dialog/alg.c:190 if (a == 13)
0443   C18B             l18: 
0444   C18B FE 0D           cp   13
0445   C18D                 ; dialog/alg.c:191 {
0446   C18D C2 A3 C1        jp   nz, l20
0447   C190                 ; dialog/alg.c:192 h = ((a = h) += shopAnswerSeparatorHeight); // Если есть цена, то добавляем разделитель в одно знакоместо между наименованием и ценой.
0448   C190 7C              ld   a, h
0449   C191 C6 04           add  4
0450   C193 67              ld   h, a
0451   C194                 ; dialog/alg.c:193 dialogCursor = hl; // Координаты первого ответа
0452   C194 22 45 C0        ld   (dialogCursor), hl
0453   C197                 ; dialog/alg.c:194 l = ((a = l) += tailSize); // Отступ для ответов
0454   C197 7D              ld   a, l
0455   C198 C6 08           add  8
0456   C19A 6F              ld   l, a
0457   C19B                 ; dialog/alg.c:195 iyl = -1; // Сброс счетчика кол-ва ответов
0458   C19B FD 2E FF        ld   iyl, -1
0459   C19E                 ; dialog/alg.c:196 *[&shopStartColor + 1] = a = colorItem;
0460   C19E 3E 45           ld   a, 69
0461   C1A0 32 5D C1        ld   ((shopStartColor) + (1)), a
0462   C1A3                 ; dialog/alg.c:197 }
0463   C1A3                 ; dialog/alg.c:198 iyl++; // Счетчик кол-ва ответов
0464   C1A3             l20: 
0465   C1A3 FD 2C           inc  iyl
0466   C1A5                 ; dialog/alg.c:199 shopNextLine();
0467   C1A5 CD 49 C0        call shopNextLine
0468   C1A8                 ; dialog/alg.c:200 } while(flag_nz);
0469   C1A8 C2 54 C1        jp   nz, l16
0470   C1AB             l17: 
0471   C1AB                 ; dialog/alg.c:201 
0472   C1AB                 ; dialog/alg.c:202 // Начальное положение курсора
0473   C1AB                 ; dialog/alg.c:203 dialogX = (a ^= a);
0474   C1AB AF              xor  a
0475   C1AC 32 47 C0        ld   (dialogX), a
0476   C1AF                 ; dialog/alg.c:204 dialogX1 = a;
0477   C1AF 32 48 C0        ld   (dialogX1), a
0478   C1B2                 ; dialog/alg.c:205 
0479   C1B2                 ; dialog/alg.c:206 // Рисуем курсор
0480   C1B2                 ; dialog/alg.c:207 dialogDrawCursor();
0481   C1B2 CD 22 C2        call dialogDrawCursor
0482   C1B5                 ; dialog/alg.c:208 
0483   C1B5                 ; dialog/alg.c:209 // Выводим на экран
0484   C1B5                 ; dialog/alg.c:210 gEndDraw();
0485   C1B5 CD 8D 60        call gEndDraw
0486   C1B8                 ; dialog/alg.c:211 
0487   C1B8                 ; dialog/alg.c:212 // Клавиатура
0488   C1B8                 ; dialog/alg.c:213 while()
0489   C1B8             l21: 
0490   C1B8                 ; dialog/alg.c:214 {
0491   C1B8                 ; dialog/alg.c:215 // Ждем, если прошло меньше 1/50 сек с прошлого цикла.
0492   C1B8                 ; dialog/alg.c:216 while ((a = gVideoPage) & 1);
0493   C1B8             l23: 
0494   C1B8 3A BA 60        ld   a, (gVideoPage)
0495   C1BB CB 47           bit  0, a
0496   C1BD CA C3 C1        jp   z, l24
0497   C1C0 C3 B8 C1        jp   l23
0498   C1C3             l24: 
0499   C1C3                 ; dialog/alg.c:217 gVideoPage = (a |= 1);
0500   C1C3 F6 01           or   1
0501   C1C5 32 BA 60        ld   (gVideoPage), a
0502   C1C8                 ; dialog/alg.c:218 
0503   C1C8                 ; dialog/alg.c:219 // Получить нажатую клавишу
0504   C1C8                 ; dialog/alg.c:220 hl = &gKeyTrigger;
0505   C1C8 21 BC 60        ld   hl, gKeyTrigger
0506   C1CB                 ; dialog/alg.c:221 b = *hl;
0507   C1CB 46              ld   b, (hl)
0508   C1CC                 ; dialog/alg.c:222 *hl = 0;
0509   C1CC 36 00           ld   (hl), 0
0510   C1CE                 ; dialog/alg.c:223 
0511   C1CE                 ; dialog/alg.c:224 // Нажат выстрел
0512   C1CE                 ; dialog/alg.c:225 if (b & KEY_FIRE)
0513   C1CE CB 60           bit  4, b
0514   C1D0                 ; dialog/alg.c:226 {
0515   C1D0 CA E1 C1        jp   z, l25
0516   C1D3                 ; dialog/alg.c:227 // Отмечаем, что весь экран нужно перерисовать и выходим
0517   C1D3                 ; dialog/alg.c:228 gFarCall(iyl = 7, ix = &gCopyVideoPage);
0518   C1D3 FD 2E 07        ld   iyl, 7
0519   C1D6 DD 21 90 60     ld   ix, gCopyVideoPage
0520   C1DA CD 81 60        call gFarCall
0521   C1DD                 ; dialog/alg.c:229 a = dialogX;
0522   C1DD 3A 47 C0        ld   a, (dialogX)
0523   C1E0                 ; dialog/alg.c:230 return;
0524   C1E0 C9              ret
0525   C1E1                 ; dialog/alg.c:231 }
0526   C1E1                 ; dialog/alg.c:232 
0527   C1E1                 ; dialog/alg.c:233 // Перемещение курсора
0528   C1E1                 ; dialog/alg.c:234 a = dialogX;
0529   C1E1             l25: 
0530   C1E1 3A 47 C0        ld   a, (dialogX)
0531   C1E4                 ; dialog/alg.c:235 if (b & KEY_UP)
0532   C1E4 CB 40           bit  0, b
0533   C1E6                 ; dialog/alg.c:236 {
0534   C1E6 CA F1 C1        jp   z, l26
0535   C1E9                 ; dialog/alg.c:237 a -= 1;
0536   C1E9 D6 01           sub  1
0537   C1EB                 ; dialog/alg.c:238 if (flag_c) continue;
0538   C1EB DA B8 C1        jp   c, l21
0539   C1EE                 ; dialog/alg.c:239 }
0540   C1EE                 ; dialog/alg.c:240 else if (b & KEY_DOWN)
0541   C1EE C3 FC C1        jp   l27
0542   C1F1             l26: 
0543   C1F1 CB 48           bit  1, b
0544   C1F3                 ; dialog/alg.c:241 {
0545   C1F3 CA FC C1        jp   z, l28
0546   C1F6                 ; dialog/alg.c:242 a++;
0547   C1F6 3C              inc  a
0548   C1F7                 ; dialog/alg.c:243 if (a >= iyl) continue;
0549   C1F7 FD BD           cp   iyl
0550   C1F9 D2 B8 C1        jp   nc, l21
0551   C1FC                 ; dialog/alg.c:244 }
0552   C1FC                 ; dialog/alg.c:245 dialogX = a;
0553   C1FC             l28: 
0554   C1FC             l27: 
0555   C1FC 32 47 C0        ld   (dialogX), a
0556   C1FF                 ; dialog/alg.c:246 
0557   C1FF                 ; dialog/alg.c:247 // Умножение на 10
0558   C1FF                 ; dialog/alg.c:248 c = (a += a);
0559   C1FF 87              add  a
0560   C200 4F              ld   c, a
0561   C201                 ; dialog/alg.c:249 ((a += a) += a) += c;
0562   C201 87              add  a
0563   C202 87              add  a
0564   C203 81              add  c
0565   C204                 ; dialog/alg.c:250 
0566   C204                 ; dialog/alg.c:251 // Плавное перемещение курсора
0567   C204                 ; dialog/alg.c:252 hl = &dialogX1;
0568   C204 21 48 C0        ld   hl, dialogX1
0569   C207                 ; dialog/alg.c:253 b = *hl;
0570   C207 46              ld   b, (hl)
0571   C208                 ; dialog/alg.c:254 if (a == b) continue; // Оставит флаг CF при выполнении dialogX1 - menuX
0572   C208 B8              cp   b
0573   C209 CA B8 C1        jp   z, l21
0574   C20C                 ; dialog/alg.c:255 b++; // Не изменяет CF
0575   C20C 04              inc  b
0576   C20D                 ; dialog/alg.c:256 if (flag_c) ----b;
0577   C20D D2 12 C2        jp   nc, l29
0578   C210 05              dec  b
0579   C211 05              dec  b
0580   C212                 ; dialog/alg.c:257 
0581   C212                 ; dialog/alg.c:258 // Стираем прошлый курсор
0582   C212                 ; dialog/alg.c:259 push(bc);
0583   C212             l29: 
0584   C212 C5              push bc
0585   C213                 ; dialog/alg.c:260 dialogDrawCursor();
0586   C213 CD 22 C2        call dialogDrawCursor
0587   C216                 ; dialog/alg.c:261 pop(bc);
0588   C216 C1              pop  bc
0589   C217                 ; dialog/alg.c:262 
0590   C217                 ; dialog/alg.c:263 // Сохраняем новые координаты курсора
0591   C217                 ; dialog/alg.c:264 *(hl = &dialogX1) = b;
0592   C217 21 48 C0        ld   hl, dialogX1
0593   C21A 70              ld   (hl), b
0594   C21B                 ; dialog/alg.c:265 
0595   C21B                 ; dialog/alg.c:266 // Рисуем курсор
0596   C21B                 ; dialog/alg.c:267 dialogDrawCursor();
0597   C21B CD 22 C2        call dialogDrawCursor
0598   C21E                 ; dialog/alg.c:268 }
0599   C21E C3 B8 C1        jp   l21
0600   C221             l22: 
0601   C221                 ; dialog/alg.c:269 }
0602   C221 C9              ret
0603   C222                 ; dialog/alg.c:270 
0604   C222                 ; dialog/alg.c:271 void dialogDrawCursor()
0605   C222             dialogDrawCursor: 
0606   C222                 ; dialog/alg.c:272 {
0607   C222                 ; dialog/alg.c:273 hl = dialogCursor;
0608   C222 2A 45 C0        ld   hl, (dialogCursor)
0609   C225                 ; dialog/alg.c:274 h = ((a = dialogX1) += h);
0610   C225 3A 48 C0        ld   a, (dialogX1)
0611   C228 84              add  h
0612   C229 67              ld   h, a
0613   C22A                 ; dialog/alg.c:275 gDrawTextEx(hl, de = "@", a = colorCursor);
0614   C22A 11 84 C2        ld   de, s0
0615   C22D 3E 43           ld   a, 67
0616   C22F CD 69 60        call gDrawTextEx
0617   C232                 ; dialog/alg.c:276 }
0618   C232 C9              ret
0619   C233                 ; dialog/alg.c:277 
0620   C233                 ; dialog/alg.c:278 void drawDialog2()
0621   C233             drawDialog2: 
0622   C233                 ; dialog/alg.c:279 {
0623   C233                 ; dialog/alg.c:280 push(bc, hl)
0624   C233                 ; dialog/alg.c:281 {
0625   C233 C5              push bc
0626   C234 E5              push hl
0627   C235                 ; dialog/alg.c:282 drawSprite2();
0628   C235 CD 97 C8        call drawSprite2
0629   C238                 ; dialog/alg.c:283 a = iyl;
0630   C238 FD 7D           ld   a, iyl
0631   C23A                 ; dialog/alg.c:284 ix = de;
0632   C23A DD 62           ld   ixh, d
0633   C23C DD 6B           ld   ixl, e
0634   C23E                 ; dialog/alg.c:285 do
0635   C23E             l30: 
0636   C23E                 ; dialog/alg.c:286 {
0637   C23E                 ; dialog/alg.c:287 ex(a);
0638   C23E 08              ex   af, af
0639   C23F                 ; dialog/alg.c:288 d = ixh; e = ixl;
0640   C23F DD 54           ld   d, ixh
0641   C241 DD 5D           ld   e, ixl
0642   C243                 ; dialog/alg.c:289 drawSprite2();
0643   C243 CD 97 C8        call drawSprite2
0644   C246                 ; dialog/alg.c:290 ex(a);
0645   C246 08              ex   af, af
0646   C247                 ; dialog/alg.c:291 } while(flag_nz --a);
0647   C247 3D              dec  a
0648   C248 C2 3E C2        jp   nz, l30
0649   C24B             l31: 
0650   C24B                 ; dialog/alg.c:292 drawSprite2();
0651   C24B CD 97 C8        call drawSprite2
0652   C24E                 ; dialog/alg.c:293 }
0653   C24E E1              pop  hl
0654   C24F C1              pop  bc
0655   C250                 ; dialog/alg.c:294 // Следующая строка
0656   C250                 ; dialog/alg.c:295 l = ((a = l) += 32); h = ((a +@= h) -= l);
0657   C250 7D              ld   a, l
0658   C251 C6 20           add  32
0659   C253 6F              ld   l, a
0660   C254 8C              adc  h
0661   C255 95              sub  l
0662   C256 67              ld   h, a
0663   C257                 ; dialog/alg.c:296 c = ((a = c) += 32); if (flag_c) b = ((a = b) += 8);
0664   C257 79              ld   a, c
0665   C258 C6 20           add  32
0666   C25A 4F              ld   c, a
0667   C25B D2 62 C2        jp   nc, l32
0668   C25E 78              ld   a, b
0669   C25F C6 08           add  8
0670   C261 47              ld   b, a
0671   C262                 ; dialog/alg.c:297 }
0672   C262             l32: 
0673   C262 C9              ret
0674   C263                 ; dialog/alg.c:298 
0675   C263                 ; dialog/alg.c:299 // Вход:
0676   C263                 ; dialog/alg.c:300 //   l - x
0677   C263                 ; dialog/alg.c:301 //   h - y
0678   C263                 ; dialog/alg.c:302 //   hl - цветной адрес
0679   C263                 ; dialog/alg.c:303 //   bc - чб адрес
0680   C263                 ; dialog/alg.c:304 
0681   C263                 ; dialog/alg.c:305 void calcAddr()
0682   C263             calcAddr: 
0683   C263                 ; dialog/alg.c:306 {
0684   C263                 ; dialog/alg.c:307 //        43210     43210
0685   C263                 ; dialog/alg.c:308 // bc  .1.43...  210.....
0686   C263                 ; dialog/alg.c:309 // hl  .1.11.43  210.....
0687   C263                 ; dialog/alg.c:310 b = (((a = h) &= 0x18) |= 0x40);
0688   C263 7C              ld   a, h
0689   C264 E6 18           and  24
0690   C266 F6 40           or   64
0691   C268 47              ld   b, a
0692   C269                 ; dialog/alg.c:311 h = ((a = h) >>r= 3);
0693   C269 7C              ld   a, h
0694   C26A 0F              rrca
0695   C26B 0F              rrca
0696   C26C 0F              rrca
0697   C26D 67              ld   h, a
0698   C26E                 ; dialog/alg.c:312 c = l = ((a &= 0xE0) |= l);
0699   C26E E6 E0           and  224
0700   C270 B5              or   l
0701   C271 6F              ld   l, a
0702   C272 4D              ld   c, l
0703   C273                 ; dialog/alg.c:313 h = (((a = h) &= 0x03) |= 0x58);
0704   C273 7C              ld   a, h
0705   C274 E6 03           and  3
0706   C276 F6 58           or   88
0707   C278 67              ld   h, a
0708   C279                 ; dialog/alg.c:314 
0709   C279                 ; dialog/alg.c:315 if (flag_z (a = gVideoPage) & 0x80) return;
0710   C279 3A BA 60        ld   a, (gVideoPage)
0711   C27C CB 7F           bit  7, a
0712   C27E C8              ret  z
0713   C27F                 ; dialog/alg.c:316 h |= 0x80;
0714   C27F CB FC           set  7, h
0715   C281                 ; dialog/alg.c:317 b |= 0x80;
0716   C281 CB F8           set  7, b
0717   C283                 ; dialog/alg.c:318 }
0718   C283 C9              ret
0719   C284                 ; dialog/alg.c:319 
0720   C284                 ; strings
0721   C284 40 00       s0 db "@",0
0722   C286             
0001   C286                 ; dialog/shop.c:2 
0002   C286                 ; common.h:2 const int itemsCount = 8;
0003   C286                 ; common.h:3 
0004   C286                 ; common.h:4 // Размер глобального строкового буфера
0005   C286                 ; common.h:5 const int gStringBufferSize = 32;
0006   C286                 ; common.h:6 
0007   C286                 ; common.h:7 // Флаги для переменных gPanelChangedA, gPanelChangedB
0008   C286                 ; common.h:8 const int gPanelChangedMoney = 0x01;
0009   C286                 ; common.h:9 const int gPanelChangedPlace = 0x02;
0010   C286                 ; common.h:10 //const int gPanelChangedImages = 0x04;
0011   C286                 ; common.h:11 const int gPanelChanedSecondWeaponCount = 0x08;
0012   C286                 ; common.h:12 const int gPanelChanedArmorCount = 0x10;
0013   C286                 ; common.h:13 
0014   C286                 ; common.h:14 // Максимальное кол-во символов (не учитывая терминатор строки), которое возращает функция numberToString16
0015   C286                 ; common.h:15 const int numberToString16max = 5;
0016   C286                 ; common.h:16 
0017   C286                 ; common.h:17 // Максимальное кол-во предметов у игрока
0018   C286                 ; common.h:18 const int playerItemsMax = 5;
0019   C286                 ; common.h:19 
0020   C286                 ; common.h:20 // Максимальное кол-во типов лута у игрока (кол-во отображаемых строк в инвентаре)
0021   C286                 ; common.h:21 const int playerLutMax = 12;
0022   C286                 ; common.h:22 
0023   C286                 ; common.h:23 // Максимальное кол-во лута у игрока (сумма)
0024   C286                 ; common.h:24 const int playerLutMaxCountInLine = 99;
0025   C286                 ; common.h:25 
0026   C286                 ; common.h:26 const int secondWeaponMax = 9;
0027   C286                 ; common.h:27 
0028   C286                 ; common.h:28 // Флаги клавиш для переменные gKeyPressed, gKeyTrigger
0029   C286                 ; common.h:29 const int KEY_UP = 1;
0030   C286                 ; common.h:30 const int KEY_DOWN = 2;
0031   C286                 ; common.h:31 const int KEY_LEFT = 4;
0032   C286                 ; common.h:32 const int KEY_RIGHT = 8;
0033   C286                 ; common.h:33 const int KEY_FIRE = 16;
0034   C286                 ; common.h:34 const int KEY_MENU = 32;
0035   C286                 ; common.h:35 
0036   C286                 ; common.h:36 // Стандартные адреса ZX Spectrum
0037   C286                 ; common.h:37 const int screenBw0 = 0x4000;
0038   C286                 ; common.h:38 const int screenAttr0 = 0x5800;
0039   C286                 ; common.h:39 
0040   C286                 ; common.h:40 // Размеры экрана
0041   C286                 ; common.h:41 const int screenWidthTails = 32;
0042   C286                 ; common.h:42 const int panelHeightTails = 4;
0043   C286                 ; common.h:43 const int tailHeight = 8;
0044   C286                 ; common.h:44 const int tailWidth = 8;
0045   C286                 ; common.h:45 const int playfieldHeightTails = 20;
0046   C286                 ; common.h:46 
0047   C286                 ; common.h:47 // Используется при упаковке координат X, Y в регистровую пару
0048   C286                 ; common.h:48 const int bpl = 256;
0049   C286                 ; common.h:49 
0050   C286                 ; common.h:50 // Точки входа
0051   C286                 ; common.h:51 const int gPanelRedrawImagesPage = 6;
0052   C286                 ; common.h:52 const int gPanelRedrawImages = 0xC006;
0053   C286                 ; common.h:53 const int gInventPage = 6;
0054   C286                 ; common.h:54 const int gInvent = 0xC000;
0055   C286                 ; common.h:55 
0056   C286                 ; common.h:56 // Параметр для drawText
0057   C286                 ; common.h:57 const int smallFontFlag = 0x80;
0058   C286                 ; common.h:58 
0059   C286                 ; dialog/shop.c:3 #counter 4000
0060   C286                 ; dialog/shop.c:4 
0061   C286                 ; dialog/shop.c:5 uint8_t shopSel = 0;
0062   C286 00          shopSel db 0
0063   C287                 ; dialog/shop.c:6 
0064   C287                 ; dialog/shop.c:7 //+ Добавить магазин амулетов
0065   C287                 ; dialog/shop.c:8 
0066   C287                 ; dialog/shop.c:9 void playerAddItem(a)
0067   C287             playerAddItem: 
0068   C287                 ; dialog/shop.c:10 {
0069   C287                 ; dialog/shop.c:11 return addElement(de = &gPlayerItems, hl = &gPlayerItemsCount, c = playerItemsMax);
0070   C287 11 D9 60        ld   de, gPlayerItems
0071   C28A 21 DE 60        ld   hl, gPlayerItemsCount
0072   C28D 0E 05           ld   c, 5
0073   C28F C3 76 C8        jp   addElement
0074   C292                 ; dialog/shop.c:12 }
0075   C292 C9              ret
0076   C293                 ; dialog/shop.c:13 
0077   C293                 ; dialog/shop.c:14 void playerRemoveItem(a)
0078   C293             playerRemoveItem: 
0079   C293                 ; dialog/shop.c:15 {
0080   C293                 ; dialog/shop.c:16 return removeElement(de = &gPlayerItems, hl = &gPlayerItemsCount, a);
0081   C293 11 D9 60        ld   de, gPlayerItems
0082   C296 21 DE 60        ld   hl, gPlayerItemsCount
0083   C299 C3 84 C8        jp   removeElement
0084   C29C                 ; dialog/shop.c:17 }
0085   C29C C9              ret
0086   C29D                 ; dialog/shop.c:18 
0087   C29D                 ; dialog/shop.c:19 // Вход: d - тип предмета
0088   C29D                 ; dialog/shop.c:20 
0089   C29D                 ; dialog/shop.c:21 void playerAddLut(d)
0090   C29D             playerAddLut: 
0091   C29D                 ; dialog/shop.c:22 {
0092   C29D                 ; dialog/shop.c:23 // Поиск этого предмета в кармане
0093   C29D                 ; dialog/shop.c:24 
0094   C29D                 ; dialog/shop.c:25 hl = &gPlayerLut;
0095   C29D 21 C0 60        ld   hl, gPlayerLut
0096   C2A0                 ; dialog/shop.c:26 a = gPlayerLutCount;
0097   C2A0 3A D8 60        ld   a, (gPlayerLutCount)
0098   C2A3                 ; dialog/shop.c:27 if (a != 0) // Если карман пуст, то не ищем
0099   C2A3 B7              or   a
0100   C2A4                 ; dialog/shop.c:28 {
0101   C2A4 CA C4 C2        jp   z, l4000
0102   C2A7                 ; dialog/shop.c:29 b = a; // Для while который замеится на djnz
0103   C2A7 47              ld   b, a
0104   C2A8                 ; dialog/shop.c:30 a = d; // Для ускорения поиска помещаем тип предмета в A
0105   C2A8 7A              ld   a, d
0106   C2A9                 ; dialog/shop.c:31 do {
0107   C2A9             l4001: 
0108   C2A9                 ; dialog/shop.c:32 if (a == *hl) // Найден предмет этого типа
0109   C2A9 BE              cp   (hl)
0110   C2AA                 ; dialog/shop.c:33 {
0111   C2AA C2 BB C2        jp   nz, l4003
0112   C2AD                 ; dialog/shop.c:34 hl += (de = playerLutMax);
0113   C2AD 11 0C 00        ld   de, 12
0114   C2B0 19              add  hl, de
0115   C2B1                 ; dialog/shop.c:35 a = *hl; // Учеличиваем кол-во
0116   C2B1 7E              ld   a, (hl)
0117   C2B2                 ; dialog/shop.c:36 a++;
0118   C2B2 3C              inc  a
0119   C2B3                 ; dialog/shop.c:37 if (a >= playerLutMaxCountInLine) a |= 0x80; // Исключаем из поиска
0120   C2B3 FE 63           cp   99
0121   C2B5 DA BA C2        jp   c, l4004
0122   C2B8 F6 80           or   128
0123   C2BA                 ; dialog/shop.c:38 return; // nz
0124   C2BA             l4004: 
0125   C2BA C9              ret
0126   C2BB                 ; dialog/shop.c:39 }
0127   C2BB                 ; dialog/shop.c:40 hl++;
0128   C2BB             l4003: 
0129   C2BB 23              inc  hl
0130   C2BC                 ; dialog/shop.c:41 } while(--b);
0131   C2BC 10 EB           djnz l4001
0132   C2BE             l4002: 
0133   C2BE                 ; dialog/shop.c:42 
0134   C2BE                 ; dialog/shop.c:43 // Если максимум ЛУТ-а, то выходим
0135   C2BE                 ; dialog/shop.c:44 a = gPlayerLutCount;
0136   C2BE 3A D8 60        ld   a, (gPlayerLutCount)
0137   C2C1                 ; dialog/shop.c:45 if (a == playerLutMax) return ; // Z - Нет места в кармане
0138   C2C1 FE 0C           cp   12
0139   C2C3 C8              ret  z
0140   C2C4                 ; dialog/shop.c:46 }
0141   C2C4                 ; dialog/shop.c:47 
0142   C2C4                 ; dialog/shop.c:48 gPlayerLutCount = ++a; // Тут получится флаг NZ
0143   C2C4             l4000: 
0144   C2C4 3C              inc  a
0145   C2C5 32 D8 60        ld   (gPlayerLutCount), a
0146   C2C8                 ; dialog/shop.c:49 
0147   C2C8                 ; dialog/shop.c:50 // Создаем новую запись
0148   C2C8                 ; dialog/shop.c:51 *hl = d;
0149   C2C8 72              ld   (hl), d
0150   C2C9                 ; dialog/shop.c:52 hl += (de = playerLutMax);
0151   C2C9 11 0C 00        ld   de, 12
0152   C2CC 19              add  hl, de
0153   C2CD                 ; dialog/shop.c:53 *hl = 1;
0154   C2CD 36 01           ld   (hl), 1
0155   C2CF                 ; dialog/shop.c:54 
0156   C2CF                 ; dialog/shop.c:55 // return nz
0157   C2CF                 ; dialog/shop.c:56 }
0158   C2CF C9              ret
0159   C2D0                 ; dialog/shop.c:57 
0160   C2D0                 ; dialog/shop.c:58 // Вход: a - порядковый номер ЛУТ-а
0161   C2D0                 ; dialog/shop.c:59 
0162   C2D0                 ; dialog/shop.c:60 void playerRemoveLut(a)
0163   C2D0             playerRemoveLut: 
0164   C2D0                 ; dialog/shop.c:61 {
0165   C2D0                 ; dialog/shop.c:62 push(a)
0166   C2D0                 ; dialog/shop.c:63 {
0167   C2D0 F5              push af
0168   C2D1                 ; dialog/shop.c:64 removeElement(de = &gPlayerLut, hl = &gPlayerLutCount, a);
0169   C2D1 11 C0 60        ld   de, gPlayerLut
0170   C2D4 21 D8 60        ld   hl, gPlayerLutCount
0171   C2D7 CD 84 C8        call removeElement
0172   C2DA                 ; dialog/shop.c:65 }
0173   C2DA F1              pop  af
0174   C2DB                 ; dialog/shop.c:66 return removeElement2(de = [&gPlayerLut + playerLutMax], hl = &gPlayerLutCount, a);
0175   C2DB 11 CC 60        ld   de, (gPlayerLut) + (12)
0176   C2DE 21 D8 60        ld   hl, gPlayerLutCount
0177   C2E1 C3 85 C8        jp   removeElement2
0178   C2E4                 ; dialog/shop.c:67 }
0179   C2E4 C9              ret
0180   C2E5                 ; dialog/shop.c:68 
0181   C2E5                 ; dialog/shop.c:69 void setPlayerMoney(hl)
0182   C2E5             setPlayerMoney: 
0183   C2E5                 ; dialog/shop.c:70 {
0184   C2E5                 ; dialog/shop.c:71 gPlayerMoney = hl;
0185   C2E5 22 BE 60        ld   (gPlayerMoney), hl
0186   C2E8                 ; dialog/shop.c:72 hl = &gPanelChangedA;
0187   C2E8 21 DF 60        ld   hl, gPanelChangedA
0188   C2EB                 ; dialog/shop.c:73 *hl |= gPanelChangedMoney;
0189   C2EB CB C6           set  0, (hl)
0190   C2ED                 ; dialog/shop.c:74 hl++;
0191   C2ED 23              inc  hl
0192   C2EE                 ; dialog/shop.c:75 *hl |= gPanelChangedMoney;    
0193   C2EE CB C6           set  0, (hl)
0194   C2F0                 ; dialog/shop.c:76 //panelRedraw:
0195   C2F0                 ; dialog/shop.c:77 //    return gFarCall(iyl = 7, ix = &gPanelRedraw);
0196   C2F0                 ; dialog/shop.c:78 }
0197   C2F0 C9              ret
0198   C2F1                 ; dialog/shop.c:79 
0199   C2F1                 ; dialog/shop.c:80 //----------------------------------------------------------------------------------------------------------------------
0200   C2F1                 ; dialog/shop.c:81 // Сформировать строку во временном буфере с наименованием и ценой.
0201   C2F1                 ; dialog/shop.c:82 // de - имя
0202   C2F1                 ; dialog/shop.c:83 // hl - цена
0203   C2F1                 ; dialog/shop.c:84 // bc - разделитель
0204   C2F1                 ; dialog/shop.c:85 
0205   C2F1                 ; dialog/shop.c:86 void shopMakeNamePrice(bc, de, hl)
0206   C2F1             shopMakeNamePrice: 
0207   C2F1                 ; dialog/shop.c:87 {
0208   C2F1                 ; dialog/shop.c:88 push(hl);
0209   C2F1 E5              push hl
0210   C2F2                 ; dialog/shop.c:89 push(bc);
0211   C2F2 C5              push bc
0212   C2F3                 ; dialog/shop.c:90 hl = &gStringBuffer;
0213   C2F3 21 99 60        ld   hl, gStringBuffer
0214   C2F6                 ; dialog/shop.c:91 strcpyn(hl, b = [gStringBufferSize - 7 - numberToString16max - 1], de); // Запас для " за  ?\r" или "\t"
0215   C2F6 06 13           ld   b, 19
0216   C2F8 CD 25 C8        call strcpyn
0217   C2FB                 ; dialog/shop.c:92 pop(de);
0218   C2FB D1              pop  de
0219   C2FC                 ; dialog/shop.c:93 strcpyn(hl, b = 4, de);
0220   C2FC 06 04           ld   b, 4
0221   C2FE CD 25 C8        call strcpyn
0222   C301                 ; dialog/shop.c:94 pop(de);
0223   C301 D1              pop  de
0224   C302                 ; dialog/shop.c:95 numberToString16(hl, de);
0225   C302 CD 32 C8        call numberToString16
0226   C305                 ; dialog/shop.c:96 hl = &gStringBuffer;
0227   C305 21 99 60        ld   hl, gStringBuffer
0228   C308                 ; dialog/shop.c:97 }
0229   C308 C9              ret
0230   C309                 ; dialog/shop.c:98 
0231   C309                 ; dialog/shop.c:99 //----------------------------------------------------------------------------------------------------------------------
0232   C309                 ; dialog/shop.c:100 // Сформировать строку во временном буфере с наименованием и ценой.
0233   C309                 ; dialog/shop.c:101 // de - имя
0234   C309                 ; dialog/shop.c:102 // hl - цена
0235   C309                 ; dialog/shop.c:103 
0236   C309                 ; dialog/shop.c:104 void shopMakeNamePrice2()
0237   C309             shopMakeNamePrice2: 
0238   C309                 ; dialog/shop.c:105 {
0239   C309                 ; dialog/shop.c:106 shopMakeNamePrice(bc = " за ");
0240   C309 01 CC C5        ld   bc, s4000
0241   C30C CD F1 C2        call shopMakeNamePrice
0242   C30F                 ; dialog/shop.c:107 // hl - указатель на начало строки, de - указатель на терминатор строки
0243   C30F                 ; dialog/shop.c:108 // Добавляем строку
0244   C30F                 ; dialog/shop.c:109 push (hl)
0245   C30F                 ; dialog/shop.c:110 {
0246   C30F E5              push hl
0247   C310                 ; dialog/shop.c:111 ex(hl, de);
0248   C310 EB              ex de, hl
0249   C311                 ; dialog/shop.c:112 strcpyn(hl, b = 3, de = " ?\r");
0250   C311 06 03           ld   b, 3
0251   C313 11 C8 C5        ld   de, s4001
0252   C316 CD 25 C8        call strcpyn
0253   C319                 ; dialog/shop.c:113 }
0254   C319 E1              pop  hl
0255   C31A                 ; dialog/shop.c:114 }
0256   C31A C9              ret
0257   C31B                 ; dialog/shop.c:115 
0258   C31B                 ; dialog/shop.c:116 //----------------------------------------------------------------------------------------------------------------------
0259   C31B                 ; dialog/shop.c:117 // Главная страница магазина
0260   C31B                 ; dialog/shop.c:118 
0261   C31B                 ; dialog/shop.c:119 void shopMain()
0262   C31B             shopMain: 
0263   C31B                 ; dialog/shop.c:120 {
0264   C31B                 ; dialog/shop.c:121 shopStart(de =
0265   C31B                 ; dialog/shop.c:122 "Добрый день, чем я\n"
0266   C31B                 ; dialog/shop.c:123 "могу вам помочь?"
0267   C31B                 ; dialog/shop.c:124 "\r"
0268   C31B                 ; dialog/shop.c:125 "Мне пора идти\n"
0269   C31B                 ; dialog/shop.c:126 "Я хочу купить\n"
0270   C31B                 ; dialog/shop.c:127 "Я хочу продать\n"
0271   C31B                 ; dialog/shop.c:128 "Я хочу продать ЛУТ",
0272   C31B 11 9A C6        ld   de, s4002
0273   C31E                 ; dialog/shop.c:129 ix = 0
0274   C31E DD 21 00 00     ld   ix, 0
0275   C322                 ; dialog/shop.c:130 );
0276   C322 CD 6E C0        call shopStart
0277   C325                 ; dialog/shop.c:131 if (flag_z a |= a) return; // Выход из магазина
0278   C325 B7              or   a
0279   C326 C8              ret  z
0280   C327                 ; dialog/shop.c:132 if (flag_z a--) return shopBuy();
0281   C327 3D              dec  a
0282   C328 CA 33 C3        jp   z, shopBuy
0283   C32B                 ; dialog/shop.c:133 if (flag_z a--) return shopTrade();
0284   C32B 3D              dec  a
0285   C32C CA F2 C3        jp   z, shopTrade
0286   C32F                 ; dialog/shop.c:134 return shopTradeLut();
0287   C32F C3 D6 C4        jp   shopTradeLut
0288   C332                 ; dialog/shop.c:135 }
0289   C332 C9              ret
0290   C333                 ; dialog/shop.c:136 
0291   C333                 ; dialog/shop.c:137 //----------------------------------------------------------------------------------------------------------------------
0292   C333                 ; dialog/shop.c:138 // Страница с товарами для покупки
0293   C333                 ; dialog/shop.c:139 
0294   C333                 ; dialog/shop.c:140 void shopBuy()
0295   C333             shopBuy: 
0296   C333                 ; dialog/shop.c:141 {
0297   C333                 ; dialog/shop.c:142 shopStart(de =
0298   C333                 ; dialog/shop.c:143 "Что вы хотите купить?"
0299   C333                 ; dialog/shop.c:144 "\r"
0300   C333                 ; dialog/shop.c:145 "Ничего",
0301   C333 11 C7 C7        ld   de, s4003
0302   C336                 ; dialog/shop.c:146 ix = &shopBuyGetText
0303   C336 DD 21 60 C3     ld   ix, shopBuyGetText
0304   C33A                 ; dialog/shop.c:147 );
0305   C33A CD 6E C0        call shopStart
0306   C33D                 ; dialog/shop.c:148 if (flag_z a |= a) return shopMain();
0307   C33D B7              or   a
0308   C33E CA 1B C3        jp   z, shopMain
0309   C341                 ; dialog/shop.c:149 shopSel = (--a);
0310   C341 3D              dec  a
0311   C342 32 86 C2        ld   (shopSel), a
0312   C345                 ; dialog/shop.c:150 return shopBuyItem();
0313   C345 C3 6D C3        jp   shopBuyItem
0314   C348                 ; dialog/shop.c:151 }
0315   C348 C9              ret
0316   C349                 ; dialog/shop.c:152 
0317   C349                 ; dialog/shop.c:153 // Вход: a - порядковый номер
0318   C349                 ; dialog/shop.c:154 // Выход: de - наименование, hl - цена продажи. Если нет предмета, то de = 0
0319   C349                 ; dialog/shop.c:155 
0320   C349                 ; dialog/shop.c:156 void shopBuyGetNamePrice(a)
0321   C349             shopBuyGetNamePrice: 
0322   C349                 ; dialog/shop.c:157 {
0323   C349                 ; dialog/shop.c:158 hl = 0;
0324   C349 21 00 00        ld   hl, 0
0325   C34C                 ; dialog/shop.c:159 de = 0;
0326   C34C 11 00 00        ld   de, 0
0327   C34F                 ; dialog/shop.c:160 if (a >= itemsCount) return;
0328   C34F FE 08           cp   8
0329   C351 D0              ret  nc
0330   C352                 ; dialog/shop.c:161 getItemOfArray16(hl = &itemNames, a);
0331   C352 21 00 D6        ld   hl, itemNames
0332   C355 CD 18 C8        call getItemOfArray16
0333   C358                 ; dialog/shop.c:162 ex(hl, de);
0334   C358 EB              ex de, hl
0335   C359                 ; dialog/shop.c:163 getItemOfArray16(hl = &itemPrices, a);
0336   C359 21 3E D6        ld   hl, itemPrices
0337   C35C CD 18 C8        call getItemOfArray16
0338   C35F                 ; dialog/shop.c:164 }
0339   C35F C9              ret
0340   C360                 ; dialog/shop.c:165 
0341   C360                 ; dialog/shop.c:166 void shopBuyGetText(a)
0342   C360             shopBuyGetText: 
0343   C360                 ; dialog/shop.c:167 {
0344   C360                 ; dialog/shop.c:168 shopBuyGetNamePrice(a);    
0345   C360 CD 49 C3        call shopBuyGetNamePrice
0346   C363                 ; dialog/shop.c:169 if (flag_z (a ^= a) |= d) return;
0347   C363 AF              xor  a
0348   C364 B2              or   d
0349   C365 C8              ret  z
0350   C366                 ; dialog/shop.c:170 shopMakeNamePrice(bc = "\x09", hl, de);
0351   C366 01 C0 C5        ld   bc, s4004
0352   C369 CD F1 C2        call shopMakeNamePrice
0353   C36C                 ; dialog/shop.c:171 }
0354   C36C C9              ret
0355   C36D                 ; dialog/shop.c:172 
0356   C36D                 ; dialog/shop.c:173 //----------------------------------------------------------------------------------------------------------------------
0357   C36D                 ; dialog/shop.c:174 // Страница с подтверждением покупки
0358   C36D                 ; dialog/shop.c:175 
0359   C36D                 ; dialog/shop.c:176 void shopBuyItem()
0360   C36D             shopBuyItem: 
0361   C36D                 ; dialog/shop.c:177 {
0362   C36D                 ; dialog/shop.c:178 shopStart(de =
0363   C36D                 ; dialog/shop.c:179 "Вы уверены, что хотите\n"
0364   C36D                 ; dialog/shop.c:180 "купить заклинание",
0365   C36D 11 44 C6        ld   de, s4005
0366   C370                 ; dialog/shop.c:181 ix = &shopBuyItemGetText
0367   C370 DD 21 AE C3     ld   ix, shopBuyItemGetText
0368   C374                 ; dialog/shop.c:182 );
0369   C374 CD 6E C0        call shopStart
0370   C377                 ; dialog/shop.c:183 
0371   C377                 ; dialog/shop.c:184 if (flag_z a |= a) return shopBuy();
0372   C377 B7              or   a
0373   C378 CA 33 C3        jp   z, shopBuy
0374   C37B                 ; dialog/shop.c:185 if (flag_nz a--) return shopBuyInfo();
0375   C37B 3D              dec  a
0376   C37C C2 CF C3        jp   nz, shopBuyInfo
0377   C37F                 ; dialog/shop.c:186 
0378   C37F                 ; dialog/shop.c:187 // Вычисление цены
0379   C37F                 ; dialog/shop.c:188 shopBuyGetNamePrice(a = shopSel);
0380   C37F 3A 86 C2        ld   a, (shopSel)
0381   C382 CD 49 C3        call shopBuyGetNamePrice
0382   C385                 ; dialog/shop.c:189 // hl - цена
0383   C385                 ; dialog/shop.c:190 
0384   C385                 ; dialog/shop.c:191 // Хватит ли денег?
0385   C385                 ; dialog/shop.c:192 ex(hl, de);
0386   C385 EB              ex de, hl
0387   C386                 ; dialog/shop.c:193 (hl = gPlayerMoney) -= de;
0388   C386 2A BE 60        ld   hl, (gPlayerMoney)
0389   C389 B7              or   a
0390   C38A B7 ED 52        sub  hl, de
0391   C38D                 ; dialog/shop.c:194 if (flag_c) return shopBuyNoMoney();
0392   C38D DA 94 C4        jp   c, shopBuyNoMoney
0393   C390                 ; dialog/shop.c:195 
0394   C390                 ; dialog/shop.c:196 // Добавляем в карман
0395   C390                 ; dialog/shop.c:197 playerAddItem(a = shopSel);
0396   C390 3A 86 C2        ld   a, (shopSel)
0397   C393 CD 87 C2        call playerAddItem
0398   C396                 ; dialog/shop.c:198 if (flag_z) return shopBuyNoSpace();
0399   C396 CA A2 C4        jp   z, shopBuyNoSpace
0400   C399                 ; dialog/shop.c:199 
0401   C399                 ; dialog/shop.c:200 // Уменьшаем деньги
0402   C399                 ; dialog/shop.c:201 shopBuyGetNamePrice(a = shopSel);
0403   C399 3A 86 C2        ld   a, (shopSel)
0404   C39C CD 49 C3        call shopBuyGetNamePrice
0405   C39F                 ; dialog/shop.c:202 // hl - цена
0406   C39F                 ; dialog/shop.c:203 ex(hl, de);
0407   C39F EB              ex de, hl
0408   C3A0                 ; dialog/shop.c:204 (hl = gPlayerMoney) -= de;
0409   C3A0 2A BE 60        ld   hl, (gPlayerMoney)
0410   C3A3 B7              or   a
0411   C3A4 B7 ED 52        sub  hl, de
0412   C3A7                 ; dialog/shop.c:205 setPlayerMoney(hl);
0413   C3A7 CD E5 C2        call setPlayerMoney
0414   C3AA                 ; dialog/shop.c:206 
0415   C3AA                 ; dialog/shop.c:207 // Переход на главную страницу
0416   C3AA                 ; dialog/shop.c:208 return shopAnyElseBuy();
0417   C3AA C3 B0 C4        jp   shopAnyElseBuy
0418   C3AD                 ; dialog/shop.c:209 }
0419   C3AD C9              ret
0420   C3AE                 ; dialog/shop.c:210 
0421   C3AE                 ; dialog/shop.c:211 void shopBuyItemGetText()
0422   C3AE             shopBuyItemGetText: 
0423   C3AE                 ; dialog/shop.c:212 {
0424   C3AE                 ; dialog/shop.c:213 if (flag_z a |= a)
0425   C3AE B7              or   a
0426   C3AF                 ; dialog/shop.c:214 {
0427   C3AF C2 BC C3        jp   nz, l4005
0428   C3B2                 ; dialog/shop.c:215 shopBuyGetNamePrice(a = shopSel, de, hl);
0429   C3B2 3A 86 C2        ld   a, (shopSel)
0430   C3B5 CD 49 C3        call shopBuyGetNamePrice
0431   C3B8                 ; dialog/shop.c:216 // de - наимерование, hl - цена
0432   C3B8                 ; dialog/shop.c:217 shopMakeNamePrice2(hl, de); // Сформировать строку de + " за " + numberToString(hl) + " ?"
0433   C3B8 CD 09 C3        call shopMakeNamePrice2
0434   C3BB                 ; dialog/shop.c:218 return;
0435   C3BB C9              ret
0436   C3BC                 ; dialog/shop.c:219 }
0437   C3BC                 ; dialog/shop.c:220 hl = "Нет";            if (flag_z a--) return;
0438   C3BC             l4005: 
0439   C3BC 21 FC C6        ld   hl, s4006
0440   C3BF 3D              dec  a
0441   C3C0 C8              ret  z
0442   C3C1                 ; dialog/shop.c:221 hl = "Да";             if (flag_z a--) return;
0443   C3C1 21 97 C6        ld   hl, s4007
0444   C3C4 3D              dec  a
0445   C3C5 C8              ret  z
0446   C3C6                 ; dialog/shop.c:222 hl = "Что это такое?"; if (flag_z a--) return;
0447   C3C6 21 02 C8        ld   hl, s4008
0448   C3C9 3D              dec  a
0449   C3CA C8              ret  z
0450   C3CB                 ; dialog/shop.c:223 hl = 0;
0451   C3CB 21 00 00        ld   hl, 0
0452   C3CE                 ; dialog/shop.c:224 }
0453   C3CE C9              ret
0454   C3CF                 ; dialog/shop.c:225 
0455   C3CF                 ; dialog/shop.c:226 //----------------------------------------------------------------------------------------------------------------------
0456   C3CF                 ; dialog/shop.c:227 // Страница с информацией о товаре
0457   C3CF                 ; dialog/shop.c:228 
0458   C3CF                 ; dialog/shop.c:229 void shopBuyInfo()
0459   C3CF             shopBuyInfo: 
0460   C3CF                 ; dialog/shop.c:230 {
0461   C3CF                 ; dialog/shop.c:231 getItemOfArray16(hl = &itemInfo, a = shopSel);
0462   C3CF 21 2E D6        ld   hl, itemInfo
0463   C3D2 3A 86 C2        ld   a, (shopSel)
0464   C3D5 CD 18 C8        call getItemOfArray16
0465   C3D8                 ; dialog/shop.c:232 ex(hl, de);
0466   C3D8 EB              ex de, hl
0467   C3D9                 ; dialog/shop.c:233 shopStart(de, ix = &shopBuyInfoGetText);
0468   C3D9 DD 21 E4 C3     ld   ix, shopBuyInfoGetText
0469   C3DD CD 6E C0        call shopStart
0470   C3E0                 ; dialog/shop.c:234 return shopBuyItem();
0471   C3E0 C3 6D C3        jp   shopBuyItem
0472   C3E3                 ; dialog/shop.c:235 }
0473   C3E3 C9              ret
0474   C3E4                 ; dialog/shop.c:236 
0475   C3E4                 ; dialog/shop.c:237 void shopBuyInfoGetText(a)
0476   C3E4             shopBuyInfoGetText: 
0477   C3E4                 ; dialog/shop.c:238 {
0478   C3E4                 ; dialog/shop.c:239 hl = "\r"; if (flag_z a |= a) return;
0479   C3E4 21 C2 C5        ld   hl, s4009
0480   C3E7 B7              or   a
0481   C3E8 C8              ret  z
0482   C3E9                 ; dialog/shop.c:240 hl = "Ок"; if (flag_z a--) return;
0483   C3E9 21 00 C7        ld   hl, s4010
0484   C3EC 3D              dec  a
0485   C3ED C8              ret  z
0486   C3EE                 ; dialog/shop.c:241 hl = 0;
0487   C3EE 21 00 00        ld   hl, 0
0488   C3F1                 ; dialog/shop.c:242 }
0489   C3F1 C9              ret
0490   C3F2                 ; dialog/shop.c:243 
0491   C3F2                 ; dialog/shop.c:244 //----------------------------------------------------------------------------------------------------------------------
0492   C3F2                 ; dialog/shop.c:245 // Страница с товарами для продажи
0493   C3F2                 ; dialog/shop.c:246 
0494   C3F2                 ; dialog/shop.c:247 void shopTrade()
0495   C3F2             shopTrade: 
0496   C3F2                 ; dialog/shop.c:248 {
0497   C3F2                 ; dialog/shop.c:249 shopStart(de =
0498   C3F2                 ; dialog/shop.c:250 "Что вы хотите продать?"
0499   C3F2                 ; dialog/shop.c:251 "\r"
0500   C3F2                 ; dialog/shop.c:252 "Ничего",
0501   C3F2 11 E4 C7        ld   de, s4011
0502   C3F5                 ; dialog/shop.c:253 ix = &stopTradeGetText
0503   C3F5 DD 21 27 C4     ld   ix, stopTradeGetText
0504   C3F9                 ; dialog/shop.c:254 );
0505   C3F9 CD 6E C0        call shopStart
0506   C3FC                 ; dialog/shop.c:255 if (flag_z a |= a) return shopMain();
0507   C3FC B7              or   a
0508   C3FD CA 1B C3        jp   z, shopMain
0509   C400                 ; dialog/shop.c:256 shopSel = --a;
0510   C400 3D              dec  a
0511   C401 32 86 C2        ld   (shopSel), a
0512   C404                 ; dialog/shop.c:257 return shopTradeItem();
0513   C404 C3 3D C4        jp   shopTradeItem
0514   C407                 ; dialog/shop.c:258 }
0515   C407 C9              ret
0516   C408                 ; dialog/shop.c:259 
0517   C408                 ; dialog/shop.c:260 // Вход: a - порядковый номер
0518   C408                 ; dialog/shop.c:261 // Выход: z - нет предмена, de - наименование, hl - цена продажи
0519   C408                 ; dialog/shop.c:262 
0520   C408                 ; dialog/shop.c:263 void stopTradeGetNamePrice(a)
0521   C408             stopTradeGetNamePrice: 
0522   C408                 ; dialog/shop.c:264 {
0523   C408                 ; dialog/shop.c:265 getItemOfArray8(hl = &gPlayerItems, a);
0524   C408 21 D9 60        ld   hl, gPlayerItems
0525   C40B CD 11 C8        call getItemOfArray8
0526   C40E                 ; dialog/shop.c:266 hl = 0;
0527   C40E 21 00 00        ld   hl, 0
0528   C411                 ; dialog/shop.c:267 if (a == 0xFF) return; // return z
0529   C411 FE FF           cp   255
0530   C413 C8              ret  z
0531   C414                 ; dialog/shop.c:268 getItemOfArray16(hl = &itemNames, a);
0532   C414 21 00 D6        ld   hl, itemNames
0533   C417 CD 18 C8        call getItemOfArray16
0534   C41A                 ; dialog/shop.c:269 ex(hl, de);
0535   C41A EB              ex de, hl
0536   C41B                 ; dialog/shop.c:270 // de - наименование
0537   C41B                 ; dialog/shop.c:271 getItemOfArray16(hl = &itemPrices, a);
0538   C41B 21 3E D6        ld   hl, itemPrices
0539   C41E CD 18 C8        call getItemOfArray16
0540   C421                 ; dialog/shop.c:272 // hl - цена
0541   C421                 ; dialog/shop.c:273 h >>= 1; l >>c= 1; // Делим цену на 2
0542   C421 CB 3C           srl  h
0543   C423 CB 1D           rr   l
0544   C425                 ; dialog/shop.c:274 a |= d; // return nz
0545   C425 B2              or   d
0546   C426                 ; dialog/shop.c:275 }
0547   C426 C9              ret
0548   C427                 ; dialog/shop.c:276 
0549   C427                 ; dialog/shop.c:277 void stopTradeGetText(a)
0550   C427             stopTradeGetText: 
0551   C427                 ; dialog/shop.c:278 {
0552   C427                 ; dialog/shop.c:279 if (a >= *(hl = &gPlayerItemsCount))
0553   C427 21 DE 60        ld   hl, gPlayerItemsCount
0554   C42A BE              cp   (hl)
0555   C42B                 ; dialog/shop.c:280 {
0556   C42B DA 32 C4        jp   c, l4006
0557   C42E                 ; dialog/shop.c:281 hl = 0;
0558   C42E 21 00 00        ld   hl, 0
0559   C431                 ; dialog/shop.c:282 return; // return hl = 0
0560   C431 C9              ret
0561   C432                 ; dialog/shop.c:283 }
0562   C432                 ; dialog/shop.c:284 stopTradeGetNamePrice(a);
0563   C432             l4006: 
0564   C432 CD 08 C4        call stopTradeGetNamePrice
0565   C435                 ; dialog/shop.c:285 if (flag_z) return; // В этой функции hl = 0, поэтому return hl = 0
0566   C435 C8              ret  z
0567   C436                 ; dialog/shop.c:286 // de - наимерование, hl - цена
0568   C436                 ; dialog/shop.c:287 shopMakeNamePrice(bc = "\x09", hl, de); // Сформировать строку de + "\x09" + numberToString(hl)
0569   C436 01 C0 C5        ld   bc, s4004
0570   C439 CD F1 C2        call shopMakeNamePrice
0571   C43C                 ; dialog/shop.c:288 // hl - указатель на временную строку
0572   C43C                 ; dialog/shop.c:289 }
0573   C43C C9              ret
0574   C43D                 ; dialog/shop.c:290 
0575   C43D                 ; dialog/shop.c:291 //----------------------------------------------------------------------------------------------------------------------
0576   C43D                 ; dialog/shop.c:292 // Страница с подтверждением продажи
0577   C43D                 ; dialog/shop.c:293 
0578   C43D                 ; dialog/shop.c:294 void shopTradeItem()
0579   C43D             shopTradeItem: 
0580   C43D                 ; dialog/shop.c:295 {
0581   C43D                 ; dialog/shop.c:296 shopStart(de =
0582   C43D                 ; dialog/shop.c:297 "Вы уверены, что хотите\n"
0583   C43D                 ; dialog/shop.c:298 "продать заклинание",
0584   C43D 11 6D C6        ld   de, s4012
0585   C440                 ; dialog/shop.c:299 ix = &shopTradeItemGetText
0586   C440 DD 21 6C C4     ld   ix, shopTradeItemGetText
0587   C444                 ; dialog/shop.c:300 );
0588   C444 CD 6E C0        call shopStart
0589   C447                 ; dialog/shop.c:301 if (flag_z a |= a) return shopTrade();
0590   C447 B7              or   a
0591   C448 CA F2 C3        jp   z, shopTrade
0592   C44B                 ; dialog/shop.c:302 
0593   C44B                 ; dialog/shop.c:303 // Узнаем цену
0594   C44B                 ; dialog/shop.c:304 stopTradeGetNamePrice(a = shopSel);
0595   C44B 3A 86 C2        ld   a, (shopSel)
0596   C44E CD 08 C4        call stopTradeGetNamePrice
0597   C451                 ; dialog/shop.c:305 // hl - цена
0598   C451                 ; dialog/shop.c:306 // Увеличиваем деньги игрока
0599   C451                 ; dialog/shop.c:307 hl += (de = gPlayerMoney);
0600   C451 ED 5B BE 60     ld   de, (gPlayerMoney)
0601   C455 19              add  hl, de
0602   C456                 ; dialog/shop.c:308 if (flag_c) { return shopOverflow(hl = &shopTrade); } // Денег больше, чем 65536 быть не может
0603   C456 D2 5F C4        jp   nc, l4007
0604   C459 21 F2 C3        ld   hl, shopTrade
0605   C45C C3 88 C4        jp   shopOverflow
0606   C45F                 ; dialog/shop.c:309 setPlayerMoney(hl);
0607   C45F             l4007: 
0608   C45F CD E5 C2        call setPlayerMoney
0609   C462                 ; dialog/shop.c:310 // Удаляем предмет из кармана
0610   C462                 ; dialog/shop.c:311 playerRemoveItem(a = shopSel);  
0611   C462 3A 86 C2        ld   a, (shopSel)
0612   C465 CD 93 C2        call playerRemoveItem
0613   C468                 ; dialog/shop.c:312 // Возвращаемся в меню
0614   C468                 ; dialog/shop.c:313 return shopAnyElseTrade();
0615   C468 C3 C2 C4        jp   shopAnyElseTrade
0616   C46B                 ; dialog/shop.c:314 }
0617   C46B C9              ret
0618   C46C                 ; dialog/shop.c:315 
0619   C46C                 ; dialog/shop.c:316 void shopTradeItemGetText(a)
0620   C46C             shopTradeItemGetText: 
0621   C46C                 ; dialog/shop.c:317 {
0622   C46C                 ; dialog/shop.c:318 if (flag_z a |= a)
0623   C46C B7              or   a
0624   C46D                 ; dialog/shop.c:319 {
0625   C46D C2 7A C4        jp   nz, l4008
0626   C470                 ; dialog/shop.c:320 stopTradeGetNamePrice(a = shopSel);
0627   C470 3A 86 C2        ld   a, (shopSel)
0628   C473 CD 08 C4        call stopTradeGetNamePrice
0629   C476                 ; dialog/shop.c:321 // de - наименование, hl - цена
0630   C476                 ; dialog/shop.c:322 shopMakeNamePrice2(hl, de); // Сформировать строку: de + " за " + numberToString(hl) + " ?"
0631   C476 CD 09 C3        call shopMakeNamePrice2
0632   C479                 ; dialog/shop.c:323 // hl - указатель на временную строку
0633   C479                 ; dialog/shop.c:324 return;
0634   C479 C9              ret
0635   C47A                 ; dialog/shop.c:325 }
0636   C47A                 ; dialog/shop.c:326 hl = "Нет"; if (flag_z a--) return;
0637   C47A             l4008: 
0638   C47A 21 FC C6        ld   hl, s4006
0639   C47D 3D              dec  a
0640   C47E C8              ret  z
0641   C47F                 ; dialog/shop.c:327 hl = "Да";  if (flag_z a--) return;
0642   C47F 21 97 C6        ld   hl, s4007
0643   C482 3D              dec  a
0644   C483 C8              ret  z
0645   C484                 ; dialog/shop.c:328 hl = 0;
0646   C484 21 00 00        ld   hl, 0
0647   C487                 ; dialog/shop.c:329 }
0648   C487 C9              ret
0649   C488                 ; dialog/shop.c:330 
0650   C488                 ; dialog/shop.c:331 //----------------------------------------------------------------------------------------------------------------------
0651   C488                 ; dialog/shop.c:332 // Страница с ошибкой
0652   C488                 ; dialog/shop.c:333 
0653   C488                 ; dialog/shop.c:334 void shopOverflow(hl)
0654   C488             shopOverflow: 
0655   C488                 ; dialog/shop.c:335 {
0656   C488                 ; dialog/shop.c:336 push(hl);
0657   C488 E5              push hl
0658   C489                 ; dialog/shop.c:337 shopStart(de =
0659   C489                 ; dialog/shop.c:338 "Вам не унести\n"
0660   C489                 ; dialog/shop.c:339 "столько денег!"
0661   C489                 ; dialog/shop.c:340 "\r"
0662   C489                 ; dialog/shop.c:341 "Ок",
0663   C489 11 D1 C5        ld   de, s4013
0664   C48C                 ; dialog/shop.c:342 ix = 0
0665   C48C DD 21 00 00     ld   ix, 0
0666   C490                 ; dialog/shop.c:343 );
0667   C490 CD 6E C0        call shopStart
0668   C493                 ; dialog/shop.c:344 }
0669   C493 C9              ret
0670   C494                 ; dialog/shop.c:345 
0671   C494                 ; dialog/shop.c:346 //----------------------------------------------------------------------------------------------------------------------
0672   C494                 ; dialog/shop.c:347 // Страница с ошибкой
0673   C494                 ; dialog/shop.c:348 
0674   C494                 ; dialog/shop.c:349 void shopBuyNoMoney()
0675   C494             shopBuyNoMoney: 
0676   C494                 ; dialog/shop.c:350 {
0677   C494                 ; dialog/shop.c:351 shopStart(de =
0678   C494                 ; dialog/shop.c:352 "У вас не хватает денег.\n"
0679   C494                 ; dialog/shop.c:353 "Я не могу продать вам это\n"
0680   C494                 ; dialog/shop.c:354 "в кредит. Может быть у вас\n"
0681   C494                 ; dialog/shop.c:355 "есть что-нибудь на продажу?"
0682   C494                 ; dialog/shop.c:356 "\r"
0683   C494                 ; dialog/shop.c:357 "Ок",
0684   C494 11 10 C7        ld   de, s4014
0685   C497                 ; dialog/shop.c:358 ix = 0
0686   C497 DD 21 00 00     ld   ix, 0
0687   C49B                 ; dialog/shop.c:359 );
0688   C49B CD 6E C0        call shopStart
0689   C49E                 ; dialog/shop.c:360 return shopBuy();
0690   C49E C3 33 C3        jp   shopBuy
0691   C4A1                 ; dialog/shop.c:361 }
0692   C4A1 C9              ret
0693   C4A2                 ; dialog/shop.c:362 
0694   C4A2                 ; dialog/shop.c:363 //----------------------------------------------------------------------------------------------------------------------
0695   C4A2                 ; dialog/shop.c:364 // Страница с ошибкой
0696   C4A2                 ; dialog/shop.c:365 
0697   C4A2                 ; dialog/shop.c:366 void shopBuyNoSpace()
0698   C4A2             shopBuyNoSpace: 
0699   C4A2                 ; dialog/shop.c:367 {
0700   C4A2                 ; dialog/shop.c:368 shopStart(de =
0701   C4A2                 ; dialog/shop.c:369 "Вам не унести сколько\n"
0702   C4A2                 ; dialog/shop.c:370 "предметов с собой.\n"
0703   C4A2                 ; dialog/shop.c:371 "Я могу у вас купить\n"
0704   C4A2                 ; dialog/shop.c:372 "что-нибудь лишнее."
0705   C4A2                 ; dialog/shop.c:373 "\r"
0706   C4A2                 ; dialog/shop.c:374 "Ок",
0707   C4A2 11 F1 C5        ld   de, s4015
0708   C4A5                 ; dialog/shop.c:375 ix = 0
0709   C4A5 DD 21 00 00     ld   ix, 0
0710   C4A9                 ; dialog/shop.c:376 );
0711   C4A9 CD 6E C0        call shopStart
0712   C4AC                 ; dialog/shop.c:377 return shopBuy();
0713   C4AC C3 33 C3        jp   shopBuy
0714   C4AF                 ; dialog/shop.c:378 }
0715   C4AF C9              ret
0716   C4B0                 ; dialog/shop.c:379 
0717   C4B0                 ; dialog/shop.c:380 //----------------------------------------------------------------------------------------------------------------------
0718   C4B0                 ; dialog/shop.c:381 // Страница с продолжением покупки
0719   C4B0                 ; dialog/shop.c:382 
0720   C4B0                 ; dialog/shop.c:383 void shopAnyElseBuy()
0721   C4B0             shopAnyElseBuy: 
0722   C4B0                 ; dialog/shop.c:384 {
0723   C4B0                 ; dialog/shop.c:385 shopStart(de =
0724   C4B0                 ; dialog/shop.c:386 "Хотите купить\n"
0725   C4B0                 ; dialog/shop.c:387 "что-нибудь еще?"
0726   C4B0                 ; dialog/shop.c:388 "\r"
0727   C4B0                 ; dialog/shop.c:389 "Нет\n"
0728   C4B0                 ; dialog/shop.c:390 "Да",
0729   C4B0 11 7C C7        ld   de, s4016
0730   C4B3                 ; dialog/shop.c:391 ix = 0
0731   C4B3 DD 21 00 00     ld   ix, 0
0732   C4B7                 ; dialog/shop.c:392 );
0733   C4B7 CD 6E C0        call shopStart
0734   C4BA                 ; dialog/shop.c:393 if(flag_z a |= a) return shopMain();
0735   C4BA B7              or   a
0736   C4BB CA 1B C3        jp   z, shopMain
0737   C4BE                 ; dialog/shop.c:394 return shopBuy();
0738   C4BE C3 33 C3        jp   shopBuy
0739   C4C1                 ; dialog/shop.c:395 }
0740   C4C1 C9              ret
0741   C4C2                 ; dialog/shop.c:396 
0742   C4C2                 ; dialog/shop.c:397 //----------------------------------------------------------------------------------------------------------------------
0743   C4C2                 ; dialog/shop.c:398 // Страница с продолжением покупки
0744   C4C2                 ; dialog/shop.c:399 
0745   C4C2                 ; dialog/shop.c:400 void shopAnyElseTrade()
0746   C4C2             shopAnyElseTrade: 
0747   C4C2                 ; dialog/shop.c:401 {
0748   C4C2                 ; dialog/shop.c:402 shopStart(de =
0749   C4C2                 ; dialog/shop.c:403 "Хотите продать\n"
0750   C4C2                 ; dialog/shop.c:404 "что-нибудь еще?"
0751   C4C2                 ; dialog/shop.c:405 "\r"
0752   C4C2                 ; dialog/shop.c:406 "Нет\n"
0753   C4C2                 ; dialog/shop.c:407 "Да",
0754   C4C2 11 A1 C7        ld   de, s4017
0755   C4C5                 ; dialog/shop.c:408 ix = 0
0756   C4C5 DD 21 00 00     ld   ix, 0
0757   C4C9                 ; dialog/shop.c:409 );
0758   C4C9 CD 6E C0        call shopStart
0759   C4CC                 ; dialog/shop.c:410 if(flag_z a |= a) return shopMain();
0760   C4CC B7              or   a
0761   C4CD CA 1B C3        jp   z, shopMain
0762   C4D0                 ; dialog/shop.c:411 return shopTrade();
0763   C4D0 C3 F2 C3        jp   shopTrade
0764   C4D3                 ; dialog/shop.c:412 }
0765   C4D3 C9              ret
0766   C4D4                 ; dialog/shop.c:413 
0767   C4D4                 ; dialog/shop.c:414 //----------------------------------------------------------------------------------------------------------------------
0768   C4D4                 ; dialog/shop.c:415 // Страница с ЛУТ-ом для продажи
0769   C4D4                 ; dialog/shop.c:416 
0770   C4D4                 ; dialog/shop.c:417 uint16_t shopSum;
0771   C4D4 00 00       shopSum dw 0
0772   C4D6                 ; dialog/shop.c:418 
0773   C4D6                 ; dialog/shop.c:419 void shopTradeLut()
0774   C4D6             shopTradeLut: 
0775   C4D6                 ; dialog/shop.c:420 {
0776   C4D6                 ; dialog/shop.c:421 while()
0777   C4D6             l4009: 
0778   C4D6                 ; dialog/shop.c:422 {
0779   C4D6                 ; dialog/shop.c:423 // Расчет общей суммы
0780   C4D6                 ; dialog/shop.c:424 hl = 0;
0781   C4D6 21 00 00        ld   hl, 0
0782   C4D9                 ; dialog/shop.c:425 a = gPlayerLutCount;
0783   C4D9 3A D8 60        ld   a, (gPlayerLutCount)
0784   C4DC                 ; dialog/shop.c:426 while(a != 0)
0785   C4DC             l4011: 
0786   C4DC B7              or   a
0787   C4DD CA EC C4        jp   z, l4012
0788   C4E0                 ; dialog/shop.c:427 {
0789   C4E0                 ; dialog/shop.c:428 a--;
0790   C4E0 3D              dec  a
0791   C4E1                 ; dialog/shop.c:429 push(hl);
0792   C4E1 E5              push hl
0793   C4E2                 ; dialog/shop.c:430 push(a)
0794   C4E2                 ; dialog/shop.c:431 {
0795   C4E2 F5              push af
0796   C4E3                 ; dialog/shop.c:432 stopTradeLutGetNameCntPrice(a);
0797   C4E3 CD 3F C5        call stopTradeLutGetNameCntPrice
0798   C4E6                 ; dialog/shop.c:433 }
0799   C4E6 F1              pop  af
0800   C4E7                 ; dialog/shop.c:434 pop(de);
0801   C4E7 D1              pop  de
0802   C4E8                 ; dialog/shop.c:435 hl += de;
0803   C4E8 19              add  hl, de
0804   C4E9                 ; dialog/shop.c:436 }
0805   C4E9 C3 DC C4        jp   l4011
0806   C4EC             l4012: 
0807   C4EC                 ; dialog/shop.c:437 shopSum = hl;
0808   C4EC 22 D4 C4        ld   (shopSum), hl
0809   C4EF                 ; dialog/shop.c:438 
0810   C4EF                 ; dialog/shop.c:439 // Диалог
0811   C4EF                 ; dialog/shop.c:440 shopStart(de =
0812   C4EF                 ; dialog/shop.c:441 "Что вы хотите продать?"
0813   C4EF                 ; dialog/shop.c:442 "\r"
0814   C4EF                 ; dialog/shop.c:443 "Ничего",
0815   C4EF 11 E4 C7        ld   de, s4011
0816   C4F2                 ; dialog/shop.c:444 ix = &stopTradeLutGetText
0817   C4F2 DD 21 62 C5     ld   ix, stopTradeLutGetText
0818   C4F6                 ; dialog/shop.c:445 );
0819   C4F6 CD 6E C0        call shopStart
0820   C4F9                 ; dialog/shop.c:446 
0821   C4F9                 ; dialog/shop.c:447 // Выход
0822   C4F9                 ; dialog/shop.c:448 a -= 1;
0823   C4F9 D6 01           sub  1
0824   C4FB                 ; dialog/shop.c:449 if (flag_c) return shopMain();
0825   C4FB DA 1B C3        jp   c, shopMain
0826   C4FE                 ; dialog/shop.c:450 
0827   C4FE                 ; dialog/shop.c:451 // Продать всё
0828   C4FE                 ; dialog/shop.c:452 if (flag_z)
0829   C4FE                 ; dialog/shop.c:453 {
0830   C4FE C2 1D C5        jp   nz, l4013
0831   C501                 ; dialog/shop.c:454 hl = gPlayerMoney;
0832   C501 2A BE 60        ld   hl, (gPlayerMoney)
0833   C504                 ; dialog/shop.c:455 hl += (de = shopSum);
0834   C504 ED 5B D4 C4     ld   de, (shopSum)
0835   C508 19              add  hl, de
0836   C509                 ; dialog/shop.c:456 if (flag_c) { return shopOverflow(hl = &shopTradeLut); } // Денег больше, чем 65536 быть не может
0837   C509 D2 12 C5        jp   nc, l4014
0838   C50C 21 D6 C4        ld   hl, shopTradeLut
0839   C50F C3 88 C4        jp   shopOverflow
0840   C512                 ; dialog/shop.c:457 setPlayerMoney(hl);
0841   C512             l4014: 
0842   C512 CD E5 C2        call setPlayerMoney
0843   C515                 ; dialog/shop.c:458 gPlayerLutCount = a = 0; // Удаляем все предметы
0844   C515 3E 00           ld   a, 0
0845   C517 32 D8 60        ld   (gPlayerLutCount), a
0846   C51A                 ; dialog/shop.c:459 return shopMain();
0847   C51A C3 1B C3        jp   shopMain
0848   C51D                 ; dialog/shop.c:460 }
0849   C51D                 ; dialog/shop.c:461 
0850   C51D                 ; dialog/shop.c:462 // Продать один
0851   C51D                 ; dialog/shop.c:463 a--;
0852   C51D             l4013: 
0853   C51D 3D              dec  a
0854   C51E                 ; dialog/shop.c:464 shopSel = a;
0855   C51E 32 86 C2        ld   (shopSel), a
0856   C521                 ; dialog/shop.c:465 // Узнаем цену
0857   C521                 ; dialog/shop.c:466 stopTradeLutGetNameCntPrice(a);
0858   C521 CD 3F C5        call stopTradeLutGetNameCntPrice
0859   C524                 ; dialog/shop.c:467 // hl - цена
0860   C524                 ; dialog/shop.c:468 // Увеличиваем деньги игрока
0861   C524                 ; dialog/shop.c:469 hl += (de = gPlayerMoney);
0862   C524 ED 5B BE 60     ld   de, (gPlayerMoney)
0863   C528 19              add  hl, de
0864   C529                 ; dialog/shop.c:470 if (flag_c) { return shopOverflow(hl = &shopTradeLut); } // Денег больше, чем 65536 быть не может
0865   C529 D2 32 C5        jp   nc, l4015
0866   C52C 21 D6 C4        ld   hl, shopTradeLut
0867   C52F C3 88 C4        jp   shopOverflow
0868   C532                 ; dialog/shop.c:471 setPlayerMoney(hl);
0869   C532             l4015: 
0870   C532 CD E5 C2        call setPlayerMoney
0871   C535                 ; dialog/shop.c:472 // Удаляем предмет из кармана
0872   C535                 ; dialog/shop.c:473 playerRemoveLut(a = shopSel);
0873   C535 3A 86 C2        ld   a, (shopSel)
0874   C538 CD D0 C2        call playerRemoveLut
0875   C53B                 ; dialog/shop.c:474 }
0876   C53B C3 D6 C4        jp   l4009
0877   C53E             l4010: 
0878   C53E                 ; dialog/shop.c:475 }
0879   C53E C9              ret
0880   C53F                 ; dialog/shop.c:476 
0881   C53F                 ; dialog/shop.c:477 // Получить информацию о ЛУТ-е
0882   C53F                 ; dialog/shop.c:478 // Вход: a - порядковый номер
0883   C53F                 ; dialog/shop.c:479 // Выход: de - наименование, hl - цена, c - кол-во
0884   C53F                 ; dialog/shop.c:480 
0885   C53F                 ; dialog/shop.c:481 void stopTradeLutGetNameCntPrice(a)
0886   C53F             stopTradeLutGetNameCntPrice: 
0887   C53F                 ; dialog/shop.c:482 {
0888   C53F                 ; dialog/shop.c:483 getItemOfArray8(hl = &gPlayerLut, a);
0889   C53F 21 C0 60        ld   hl, gPlayerLut
0890   C542 CD 11 C8        call getItemOfArray8
0891   C545                 ; dialog/shop.c:484 hl += (de = playerLutMax);
0892   C545 11 0C 00        ld   de, 12
0893   C548 19              add  hl, de
0894   C549                 ; dialog/shop.c:485 c = *hl;
0895   C549 4E              ld   c, (hl)
0896   C54A                 ; dialog/shop.c:486 // с - кол-во
0897   C54A                 ; dialog/shop.c:487 getItemOfArray16(hl = &lutNames, a);
0898   C54A 21 10 D6        ld   hl, lutNames
0899   C54D CD 18 C8        call getItemOfArray16
0900   C550                 ; dialog/shop.c:488 ex(hl, de);
0901   C550 EB              ex de, hl
0902   C551                 ; dialog/shop.c:489 // de - наименование
0903   C551                 ; dialog/shop.c:490 getItemOfArray16(hl = &lutPrices, a);
0904   C551 21 28 D6        ld   hl, lutPrices
0905   C554 CD 18 C8        call getItemOfArray16
0906   C557                 ; dialog/shop.c:491 // hl - цена (hl *= c)
0907   C557                 ; dialog/shop.c:492 push(bc, de)
0908   C557                 ; dialog/shop.c:493 {
0909   C557 C5              push bc
0910   C558 D5              push de
0911   C559                 ; dialog/shop.c:494 d = 0; e = c;
0912   C559 16 00           ld   d, 0
0913   C55B 59              ld   e, c
0914   C55C                 ; dialog/shop.c:495 mul16();
0915   C55C CD 55 C8        call mul16
0916   C55F                 ; dialog/shop.c:496 }
0917   C55F D1              pop  de
0918   C560 C1              pop  bc
0919   C561                 ; dialog/shop.c:497 }
0920   C561 C9              ret
0921   C562                 ; dialog/shop.c:498 
0922   C562                 ; dialog/shop.c:499 // Сформировать текст для вывода на экран
0923   C562                 ; dialog/shop.c:500 // Вход: a - порядковый номер
0924   C562                 ; dialog/shop.c:501 // Выход: hl - строка (если hl = 0, то конец)
0925   C562                 ; dialog/shop.c:502 
0926   C562                 ; dialog/shop.c:503 void stopTradeLutGetText(a)
0927   C562             stopTradeLutGetText: 
0928   C562                 ; dialog/shop.c:504 {
0929   C562                 ; dialog/shop.c:505 // Продать все
0930   C562                 ; dialog/shop.c:506 a -= 1;
0931   C562 D6 01           sub  1
0932   C564                 ; dialog/shop.c:507 if (flag_c)
0933   C564                 ; dialog/shop.c:508 {
0934   C564 D2 86 C5        jp   nc, l4016
0935   C567                 ; dialog/shop.c:509 hl = &gStringBuffer;
0936   C567 21 99 60        ld   hl, gStringBuffer
0937   C56A                 ; dialog/shop.c:510 strcpyn(hl, b = [gStringBufferSize - numberToString16max - 1], de = "Продать все\x09");
0938   C56A 06 1A           ld   b, 26
0939   C56C 11 03 C7        ld   de, s4018
0940   C56F CD 25 C8        call strcpyn
0941   C572                 ; dialog/shop.c:511 de = shopSum;
0942   C572 ED 5B D4 C4     ld   de, (shopSum)
0943   C576                 ; dialog/shop.c:512 if (flag_z (a = d) |= e)
0944   C576 7A              ld   a, d
0945   C577 B3              or   e
0946   C578                 ; dialog/shop.c:513 {
0947   C578 C2 7F C5        jp   nz, l4017
0948   C57B                 ; dialog/shop.c:514 hl = 0;
0949   C57B 21 00 00        ld   hl, 0
0950   C57E                 ; dialog/shop.c:515 return;
0951   C57E C9              ret
0952   C57F                 ; dialog/shop.c:516 }
0953   C57F                 ; dialog/shop.c:517 numberToString16(hl, de);
0954   C57F             l4017: 
0955   C57F CD 32 C8        call numberToString16
0956   C582                 ; dialog/shop.c:518 hl = &gStringBuffer;
0957   C582 21 99 60        ld   hl, gStringBuffer
0958   C585                 ; dialog/shop.c:519 return;
0959   C585 C9              ret
0960   C586                 ; dialog/shop.c:520 }
0961   C586                 ; dialog/shop.c:521 
0962   C586                 ; dialog/shop.c:522 // По отдельности
0963   C586                 ; dialog/shop.c:523 if (a < *(hl = &gPlayerLutCount))
0964   C586             l4016: 
0965   C586 21 D8 60        ld   hl, gPlayerLutCount
0966   C589 BE              cp   (hl)
0967   C58A                 ; dialog/shop.c:524 {
0968   C58A D2 BB C5        jp   nc, l4018
0969   C58D                 ; dialog/shop.c:525 // Получить информацию
0970   C58D                 ; dialog/shop.c:526 stopTradeLutGetNameCntPrice(a);
0971   C58D CD 3F C5        call stopTradeLutGetNameCntPrice
0972   C590                 ; dialog/shop.c:527 // de - наимерование, hl - цена, c - кол-во
0973   C590                 ; dialog/shop.c:528 push(hl);
0974   C590 E5              push hl
0975   C591                 ; dialog/shop.c:529 push(bc);
0976   C591 C5              push bc
0977   C592                 ; dialog/shop.c:530 hl = &gStringBuffer;
0978   C592 21 99 60        ld   hl, gStringBuffer
0979   C595                 ; dialog/shop.c:531 strcpyn(hl, b = [gStringBufferSize - 3 - 2 - 1 - numberToString16max - 1], de);
0980   C595 06 14           ld   b, 20
0981   C597 CD 25 C8        call strcpyn
0982   C59A                 ; dialog/shop.c:532 strcpyn(hl, b = 3, de = " * ");
0983   C59A 06 03           ld   b, 3
0984   C59C 11 C4 C5        ld   de, s4019
0985   C59F CD 25 C8        call strcpyn
0986   C5A2                 ; dialog/shop.c:533 pop(de);
0987   C5A2 D1              pop  de
0988   C5A3                 ; dialog/shop.c:534 d = 0;
0989   C5A3 16 00           ld   d, 0
0990   C5A5                 ; dialog/shop.c:535 if ((a = e) < 100) numberToString16(hl, de);
0991   C5A5 7B              ld   a, e
0992   C5A6 FE 64           cp   100
0993   C5A8 DC 32 C8        call c, numberToString16
0994   C5AB                 ; dialog/shop.c:536 strcpyn(hl, b = 1, de = "\x09");
0995   C5AB 06 01           ld   b, 1
0996   C5AD 11 C0 C5        ld   de, s4004
0997   C5B0 CD 25 C8        call strcpyn
0998   C5B3                 ; dialog/shop.c:537 pop(de);
0999   C5B3 D1              pop  de
1000   C5B4                 ; dialog/shop.c:538 numberToString16(hl, de);
1001   C5B4 CD 32 C8        call numberToString16
1002   C5B7                 ; dialog/shop.c:539 hl = &gStringBuffer;
1003   C5B7 21 99 60        ld   hl, gStringBuffer
1004   C5BA                 ; dialog/shop.c:540 return;
1005   C5BA C9              ret
1006   C5BB                 ; dialog/shop.c:541 }
1007   C5BB                 ; dialog/shop.c:542 
1008   C5BB                 ; dialog/shop.c:543 // Конец
1009   C5BB                 ; dialog/shop.c:544 hl = 0;
1010   C5BB             l4018: 
1011   C5BB 21 00 00        ld   hl, 0
1012   C5BE                 ; dialog/shop.c:545 return;
1013   C5BE C9              ret
1014   C5BF                 ; dialog/shop.c:546 }
1015   C5BF C9              ret
1016   C5C0                 ; dialog/shop.c:547 
1017   C5C0                 ; strings
1018   C5C0 09 00       s4004 db 9,0
1019   C5C2 0D 00       s4009 db 13,0
1020   C5C4 20 2A 20 00 s4019 db " * ",0
1021   C5C8 20 3F 0D 00 s4001 db " ?",13,0
1022   C5CC 20E7E02000  s4000 db "  ",0
1023   C5D1             s4013 db "  ",10," !",13,"",0
1023   C5D1 C2E0EC20EDE520F3EDE5F1F2E80AF1F2EEEBFCEAEE20E4E5EDE5E3210DCEEA00
1024   C5F1             s4015 db "   ",10,"  .",10,"    ",10,"- .",13,"",0
1024   C5F1 C2E0EC20EDE520F3EDE5F1F2E820F1EAEEEBFCEAEE0AEFF0E5E4ECE5F2EEE220
1024   C611 F120F1EEE1EEE92E0ADF20ECEEE3F320F320E2E0F120EAF3EFE8F2FC0AF7F2EE
1024   C631 2DEDE8E1F3E4FC20EBE8F8EDE5E52E0DCEEA00
1025   C644             s4005 db " ,  ",10," ",0
1025   C644 C2FB20F3E2E5F0E5EDFB2C20F7F2EE20F5EEF2E8F2E50AEAF3EFE8F2FC20E7E0
1025   C664 EAEBE8EDE0EDE8E500
1026   C66D             s4012 db " ,  ",10," ",0
1026   C66D C2FB20F3E2E5F0E5EDFB2C20F7F2EE20F5EEF2E8F2E50AEFF0EEE4E0F2FC20E7
1026   C68D E0EAEBE8EDE0EDE8E500
1027   C697 C4 E0 00    s4007 db "",0
1028   C69A             s4002 db " ,  ",10,"  ?",13,"  ",10,"  ",10,"  ",10,"   ",0
1028   C69A C4EEE1F0FBE920E4E5EDFC2C20F7E5EC20FF0AECEEE3F320E2E0EC20EFEEECEE
1028   C6BA F7FC3F0DCCEDE520EFEEF0E020E8E4F2E80ADF20F5EEF7F320EAF3EFE8F2FC0A
1028   C6DA DF20F5EEF7F320EFF0EEE4E0F2FC0ADF20F5EEF7F320EFF0EEE4E0F2FC20CBD3
1028   C6FA D200
1029   C6FC CD E5 F2 00 s4006 db "",0
1030   C700 CE EA 00    s4010 db "",0
1031   C703             s4018 db " ",9,0
1031   C703 CFF0EEE4E0F2FC20E2F1E50900
1032   C710             s4014 db "    .",10,"     ",10," .    ",10," -  ?",13,"",0
1032   C710 D320E2E0F120EDE520F5E2E0F2E0E5F220E4E5EDE5E32E0ADF20EDE520ECEEE3
1032   C730 F320EFF0EEE4E0F2FC20E2E0EC20FDF2EE0AE220EAF0E5E4E8F22E20CCEEE6E5
1032   C750 F220E1FBF2FC20F320E2E0F10AE5F1F2FC20F7F2EE2DEDE8E1F3E4FC20EDE020
1032   C770 EFF0EEE4E0E6F33F0DCEEA00
1033   C77C             s4016 db " ",10,"- ?",13,"",10,"",0
1033   C77C D5EEF2E8F2E520EAF3EFE8F2FC0AF7F2EE2DEDE8E1F3E4FC20E5F9E53F0DCDE5
1033   C79C F20AC4E000
1034   C7A1             s4017 db " ",10,"- ?",13,"",10,"",0
1034   C7A1 D5EEF2E8F2E520EFF0EEE4E0F2FC0AF7F2EE2DEDE8E1F3E4FC20E5F9E53F0DCD
1034   C7C1 E5F20AC4E000
1035   C7C7             s4003 db "   ?",13,"",0
1035   C7C7 D7F2EE20E2FB20F5EEF2E8F2E520EAF3EFE8F2FC3F0DCDE8F7E5E3EE00
1036   C7E4             s4011 db "   ?",13,"",0
1036   C7E4 D7F2EE20E2FB20F5EEF2E8F2E520EFF0EEE4E0F2FC3F0DCDE8F7E5E3EE00
1037   C802             s4008 db "  ?",0
1037   C802 D7F2EE20FDF2EE20F2E0EAEEE53F00
1038   C811             
0001   C811                 ; dialog/tools.c:2 
0002   C811                 ; dialog/tools.c:3 void getItemOfArray8()
0003   C811             getItemOfArray8: 
0004   C811                 ; dialog/tools.c:4 {
0005   C811                 ; dialog/tools.c:5 l = (a += l);
0006   C811 85              add  l
0007   C812 6F              ld   l, a
0008   C813                 ; dialog/tools.c:6 h = ((a +@= h) -= l);
0009   C813 8C              adc  h
0010   C814 95              sub  l
0011   C815 67              ld   h, a
0012   C816                 ; dialog/tools.c:7 a = *hl;
0013   C816 7E              ld   a, (hl)
0014   C817                 ; dialog/tools.c:8 }
0015   C817 C9              ret
0016   C818                 ; dialog/tools.c:9 
0017   C818                 ; dialog/tools.c:10 void getItemOfArray16()
0018   C818             getItemOfArray16: 
0019   C818                 ; dialog/tools.c:11 {
0020   C818                 ; dialog/tools.c:12 push(a)
0021   C818                 ; dialog/tools.c:13 {
0022   C818 F5              push af
0023   C819                 ; dialog/tools.c:14 l = ((a += a) += l);
0024   C819 87              add  a
0025   C81A 85              add  l
0026   C81B 6F              ld   l, a
0027   C81C                 ; dialog/tools.c:15 h = ((a +@= h) -= l);
0028   C81C 8C              adc  h
0029   C81D 95              sub  l
0030   C81E 67              ld   h, a
0031   C81F                 ; dialog/tools.c:16 a = *hl; hl++; h = *hl; l = a;
0032   C81F 7E              ld   a, (hl)
0033   C820 23              inc  hl
0034   C821 66              ld   h, (hl)
0035   C822 6F              ld   l, a
0036   C823                 ; dialog/tools.c:17 }
0037   C823 F1              pop  af
0038   C824                 ; dialog/tools.c:18 }
0039   C824 C9              ret
0040   C825                 ; dialog/tools.c:19 
0041   C825                 ; dialog/tools.c:20 // b - указывает на максимальное кол-во копируемых символов, размер буфера должен быть на 1 байт больше.
0042   C825                 ; dialog/tools.c:21 
0043   C825                 ; dialog/tools.c:22 void strcpyn(hl, de, b)
0044   C825             strcpyn: 
0045   C825                 ; dialog/tools.c:23 {
0046   C825                 ; dialog/tools.c:24 do
0047   C825             l7000: 
0048   C825                 ; dialog/tools.c:25 {
0049   C825                 ; dialog/tools.c:26 a = *de; de++;
0050   C825 1A              ld   a, (de)
0051   C826 13              inc  de
0052   C827                 ; dialog/tools.c:27 if (a == 0) break;
0053   C827 B7              or   a
0054   C828 CA 2F C8        jp   z, l7001
0055   C82B                 ; dialog/tools.c:28 *hl = a; hl++;
0056   C82B 77              ld   (hl), a
0057   C82C 23              inc  hl
0058   C82D                 ; dialog/tools.c:29 } while(--b);
0059   C82D 10 F6           djnz l7000
0060   C82F             l7001: 
0061   C82F                 ; dialog/tools.c:30 *hl = 0;
0062   C82F 36 00           ld   (hl), 0
0063   C831                 ; dialog/tools.c:31 }
0064   C831 C9              ret
0065   C832                 ; dialog/tools.c:32 
0066   C832                 ; dialog/tools.c:33 void numberToString16(hl, de)
0067   C832             numberToString16: 
0068   C832                 ; dialog/tools.c:34 {
0069   C832                 ; dialog/tools.c:35 *[&uint16_to_str_addr + 1] = hl;
0070   C832 22 48 C8        ld   ((uint16_to_str_addr) + (1)), hl
0071   C835                 ; dialog/tools.c:36 
0072   C835                 ; dialog/tools.c:37 // Терминатор
0073   C835                 ; dialog/tools.c:38 a ^= a;
0074   C835 AF              xor  a
0075   C836                 ; dialog/tools.c:39 push(a);
0076   C836 F5              push af
0077   C837                 ; dialog/tools.c:40 
0078   C837                 ; dialog/tools.c:41 // Разделение числа на цифры
0079   C837                 ; dialog/tools.c:42 ex(hl, de);
0080   C837 EB              ex de, hl
0081   C838                 ; dialog/tools.c:43 do
0082   C838             l7002: 
0083   C838                 ; dialog/tools.c:44 {
0084   C838                 ; dialog/tools.c:45 div16(hl, de = 10);
0085   C838 11 0A 00        ld   de, 10
0086   C83B CD 0E C0        call div16
0087   C83E                 ; dialog/tools.c:46 (a = e) += '0';
0088   C83E 7B              ld   a, e
0089   C83F C6 30           add  48
0090   C841                 ; dialog/tools.c:47 push(a);
0091   C841 F5              push af
0092   C842                 ; dialog/tools.c:48 } while (flag_nz (a = h) |= l);
0093   C842 7C              ld   a, h
0094   C843 B5              or   l
0095   C844 C2 38 C8        jp   nz, l7002
0096   C847             l7003: 
0097   C847                 ; dialog/tools.c:49 
0098   C847                 ; dialog/tools.c:50 // Вывод в строку
0099   C847                 ; dialog/tools.c:51 uint16_to_str_addr:
0100   C847             uint16_to_str_addr: 
0101   C847                 ; dialog/tools.c:52 de = 0;
0102   C847 11 00 00        ld   de, 0
0103   C84A                 ; dialog/tools.c:53 do
0104   C84A             l7004: 
0105   C84A                 ; dialog/tools.c:54 {
0106   C84A                 ; dialog/tools.c:55 pop(a);
0107   C84A F1              pop  af
0108   C84B                 ; dialog/tools.c:56 *de = a; de++;
0109   C84B 12              ld   (de), a
0110   C84C 13              inc  de
0111   C84D                 ; dialog/tools.c:57 } while(flag_nz a |= a);
0112   C84D B7              or   a
0113   C84E C2 4A C8        jp   nz, l7004
0114   C851             l7005: 
0115   C851                 ; dialog/tools.c:58 de--;
0116   C851 1B              dec  de
0117   C852                 ; dialog/tools.c:59 hl = de;
0118   C852 62              ld   h, d
0119   C853 6B              ld   l, e
0120   C854                 ; dialog/tools.c:60 }
0121   C854 C9              ret
0122   C855                 ; dialog/tools.c:61 
0123   C855                 ; dialog/tools.c:62 // Умножение HL на DE, результат в HL. BC портить нельзя
0124   C855                 ; dialog/tools.c:63 
0125   C855                 ; dialog/tools.c:64 void mul16()
0126   C855             mul16: 
0127   C855                 ; dialog/tools.c:65 {
0128   C855                 ; dialog/tools.c:66 bc = hl;
0129   C855 44              ld   b, h
0130   C856 4D              ld   c, l
0131   C857                 ; dialog/tools.c:67 hl = 0;
0132   C857 21 00 00        ld   hl, 0
0133   C85A                 ; dialog/tools.c:68 a = 17;
0134   C85A 3E 11           ld   a, 17
0135   C85C                 ; dialog/tools.c:69 while()
0136   C85C             l7006: 
0137   C85C                 ; dialog/tools.c:70 {
0138   C85C                 ; dialog/tools.c:71 a--;
0139   C85C 3D              dec  a
0140   C85D                 ; dialog/tools.c:72 if (flag_z) return;
0141   C85D C8              ret  z
0142   C85E                 ; dialog/tools.c:73 hl += hl;
0143   C85E 29              add  hl, hl
0144   C85F                 ; dialog/tools.c:74 ex(hl, de);
0145   C85F EB              ex de, hl
0146   C860                 ; dialog/tools.c:75 if (flag_c)
0147   C860                 ; dialog/tools.c:76 {
0148   C860 D2 68 C8        jp   nc, l7008
0149   C863                 ; dialog/tools.c:77 hl += hl;
0150   C863 29              add  hl, hl
0151   C864                 ; dialog/tools.c:78 hl++;
0152   C864 23              inc  hl
0153   C865                 ; dialog/tools.c:79 }
0154   C865                 ; dialog/tools.c:80 else
0155   C865 C3 69 C8        jp   l7009
0156   C868             l7008: 
0157   C868                 ; dialog/tools.c:81 {
0158   C868                 ; dialog/tools.c:82 hl += hl;
0159   C868 29              add  hl, hl
0160   C869                 ; dialog/tools.c:83 }
0161   C869             l7009: 
0162   C869                 ; dialog/tools.c:84 ex(hl, de);
0163   C869 EB              ex de, hl
0164   C86A                 ; dialog/tools.c:85 if (flag_nc) continue;
0165   C86A D2 5C C8        jp   nc, l7006
0166   C86D                 ; dialog/tools.c:86 hl += bc;
0167   C86D 09              add  hl, bc
0168   C86E                 ; dialog/tools.c:87 if (flag_nc) continue;
0169   C86E D2 5C C8        jp   nc, l7006
0170   C871                 ; dialog/tools.c:88 de++;
0171   C871 13              inc  de
0172   C872                 ; dialog/tools.c:89 }
0173   C872 C3 5C C8        jp   l7006
0174   C875             l7007: 
0175   C875                 ; dialog/tools.c:90 }
0176   C875 C9              ret
0177   C876                 ; dialog/tools.c:91 
0178   C876                 ; dialog/tools.c:92 // Добавить элемент в конец массива uint8_t[]
0179   C876                 ; dialog/tools.c:93 //
0180   C876                 ; dialog/tools.c:94 // Вход:
0181   C876                 ; dialog/tools.c:95 //   de - адрес начала массива
0182   C876                 ; dialog/tools.c:96 //   hl - адрес, где хранится длинна массива
0183   C876                 ; dialog/tools.c:97 //   c  - максимальное кол-во элементов в массиве
0184   C876                 ; dialog/tools.c:98 // Выход:
0185   C876                 ; dialog/tools.c:99 //   z  - В массиве нет места
0186   C876                 ; dialog/tools.c:100 
0187   C876                 ; dialog/tools.c:101 void addElement(de, hl, c, a)
0188   C876             addElement: 
0189   C876                 ; dialog/tools.c:102 {
0190   C876                 ; dialog/tools.c:103 b = a;
0191   C876 47              ld   b, a
0192   C877                 ; dialog/tools.c:104 a = *hl;
0193   C877 7E              ld   a, (hl)
0194   C878                 ; dialog/tools.c:105 if (a == c) return; // z
0195   C878 B9              cp   c
0196   C879 C8              ret  z
0197   C87A                 ; dialog/tools.c:106 (*hl)++;
0198   C87A 34              inc  (hl)
0199   C87B                 ; dialog/tools.c:107 l = (a += e); h = ((a +@= d) -= l);
0200   C87B 83              add  e
0201   C87C 6F              ld   l, a
0202   C87D 8A              adc  d
0203   C87E 95              sub  l
0204   C87F 67              ld   h, a
0205   C880                 ; dialog/tools.c:108 *hl = b;
0206   C880 70              ld   (hl), b
0207   C881                 ; dialog/tools.c:109 ++(a ^= a); // return nz
0208   C881 AF              xor  a
0209   C882 3C              inc  a
0210   C883                 ; dialog/tools.c:110 }
0211   C883 C9              ret
0212   C884                 ; dialog/tools.c:111 
0213   C884                 ; dialog/tools.c:112 // Удалить элемент из массива
0214   C884                 ; dialog/tools.c:113 //
0215   C884                 ; dialog/tools.c:114 // Вход:
0216   C884                 ; dialog/tools.c:115 //   de - адрес начала массива
0217   C884                 ; dialog/tools.c:116 //   hl - адрес, где хранится длинна массива
0218   C884                 ; dialog/tools.c:117 //   c  - максимальное кол-во элементов в массиве
0219   C884                 ; dialog/tools.c:118 // Выход:
0220   C884                 ; dialog/tools.c:119 //   z  - В массиве нет места
0221   C884                 ; dialog/tools.c:120 
0222   C884                 ; dialog/tools.c:121 void removeElement(de, hl, a)
0223   C884             removeElement: 
0224   C884                 ; dialog/tools.c:122 {
0225   C884                 ; dialog/tools.c:123 (*hl)--;
0226   C884 35              dec  (hl)
0227   C885                 ; dialog/tools.c:124 removeElement2:
0228   C885             removeElement2: 
0229   C885                 ; dialog/tools.c:125 b = a;
0230   C885 47              ld   b, a
0231   C886                 ; dialog/tools.c:126 e = (a += e); d = ((a +@= d) -= e); // de += a
0232   C886 83              add  e
0233   C887 5F              ld   e, a
0234   C888 8A              adc  d
0235   C889 93              sub  e
0236   C88A 57              ld   d, a
0237   C88B                 ; dialog/tools.c:127 (a = *hl) -= b;
0238   C88B 7E              ld   a, (hl)
0239   C88C 90              sub  b
0240   C88D                 ; dialog/tools.c:128 if (flag_z) return;
0241   C88D C8              ret  z
0242   C88E                 ; dialog/tools.c:129 b = 0; c = a;
0243   C88E 06 00           ld   b, 0
0244   C890 4F              ld   c, a
0245   C891                 ; dialog/tools.c:130 hl = de;
0246   C891 62              ld   h, d
0247   C892 6B              ld   l, e
0248   C893                 ; dialog/tools.c:131 hl++;
0249   C893 23              inc  hl
0250   C894                 ; dialog/tools.c:132 ldir();
0251   C894 ED B0           ldir
0252   C896                 ; dialog/tools.c:133 }
0253   C896 C9              ret
0254   C897                 ; dialog/tools.c:134 
0255   C897                 ; dialog/tools.c:135 void drawSprite2(de, bc, hl)
0256   C897             drawSprite2: 
0257   C897                 ; dialog/tools.c:136 {
0258   C897                 ; dialog/tools.c:137 *bc = a = *de; de++; b++;
0259   C897 1A              ld   a, (de)
0260   C898 02              ld   (bc), a
0261   C899 13              inc  de
0262   C89A 04              inc  b
0263   C89B                 ; dialog/tools.c:138 *bc = a = *de; de++; b++;
0264   C89B 1A              ld   a, (de)
0265   C89C 02              ld   (bc), a
0266   C89D 13              inc  de
0267   C89E 04              inc  b
0268   C89F                 ; dialog/tools.c:139 *bc = a = *de; de++; b++;
0269   C89F 1A              ld   a, (de)
0270   C8A0 02              ld   (bc), a
0271   C8A1 13              inc  de
0272   C8A2 04              inc  b
0273   C8A3                 ; dialog/tools.c:140 *bc = a = *de; de++; b++;
0274   C8A3 1A              ld   a, (de)
0275   C8A4 02              ld   (bc), a
0276   C8A5 13              inc  de
0277   C8A6 04              inc  b
0278   C8A7                 ; dialog/tools.c:141 *bc = a = *de; de++; b++;
0279   C8A7 1A              ld   a, (de)
0280   C8A8 02              ld   (bc), a
0281   C8A9 13              inc  de
0282   C8AA 04              inc  b
0283   C8AB                 ; dialog/tools.c:142 *bc = a = *de; de++; b++;
0284   C8AB 1A              ld   a, (de)
0285   C8AC 02              ld   (bc), a
0286   C8AD 13              inc  de
0287   C8AE 04              inc  b
0288   C8AF                 ; dialog/tools.c:143 *bc = a = *de; de++; b++;
0289   C8AF 1A              ld   a, (de)
0290   C8B0 02              ld   (bc), a
0291   C8B1 13              inc  de
0292   C8B2 04              inc  b
0293   C8B3                 ; dialog/tools.c:144 *bc = a = *de; de++;
0294   C8B3 1A              ld   a, (de)
0295   C8B4 02              ld   (bc), a
0296   C8B5 13              inc  de
0297   C8B6                 ; dialog/tools.c:145 *hl = a = *de; de++;
0298   C8B6 1A              ld   a, (de)
0299   C8B7 77              ld   (hl), a
0300   C8B8 13              inc  de
0301   C8B9                 ; dialog/tools.c:146 b = ((a = b) -= 7);
0302   C8B9 78              ld   a, b
0303   C8BA D6 07           sub  7
0304   C8BC 47              ld   b, a
0305   C8BD                 ; dialog/tools.c:147 l++;
0306   C8BD 2C              inc  l
0307   C8BE                 ; dialog/tools.c:148 c++;
0308   C8BE 0C              inc  c
0309   C8BF                 ; dialog/tools.c:149 }
0310   C8BF C9              ret
0311   C8C0                 ; dialog/tools.c:150 
0312   C8C0                 ; dialog/tools.c:151 void drawSprite4(bc, hl, de)
0313   C8C0             drawSprite4: 
0314   C8C0                 ; dialog/tools.c:152 {
0315   C8C0                 ; dialog/tools.c:153 drawSprite2(bc, hl, de);
0316   C8C0 CD 97 C8        call drawSprite2
0317   C8C3                 ; dialog/tools.c:154 drawSprite2(bc, hl, de);
0318   C8C3 CD 97 C8        call drawSprite2
0319   C8C6                 ; dialog/tools.c:155 l = ((a = l) += [0x20 - 2]); c = l;
0320   C8C6 7D              ld   a, l
0321   C8C7 C6 1E           add  30
0322   C8C9 6F              ld   l, a
0323   C8CA 4D              ld   c, l
0324   C8CB                 ; dialog/tools.c:156 if (flag_c) { b = ((a = b) += 8); h++; }
0325   C8CB D2 D3 C8        jp   nc, l7010
0326   C8CE 78              ld   a, b
0327   C8CF C6 08           add  8
0328   C8D1 47              ld   b, a
0329   C8D2 24              inc  h
0330   C8D3                 ; dialog/tools.c:157 drawSprite2(bc, hl, de);
0331   C8D3             l7010: 
0332   C8D3 CD 97 C8        call drawSprite2
0333   C8D6                 ; dialog/tools.c:158 drawSprite2(bc, hl, de);
0334   C8D6 CD 97 C8        call drawSprite2
0335   C8D9                 ; dialog/tools.c:159 }
0336   C8D9 C9              ret
0337   C8DA                 ; dialog/tools.c:160 
0338   C8DA                 ; dialog/tools.c:161 void drawSpriteXor(de, bc, hl, ixh)
0339   C8DA             drawSpriteXor: 
0340   C8DA                 ; dialog/tools.c:162 {
0341   C8DA                 ; dialog/tools.c:163 a = *de; de++; *hl = (a ^= *hl); h++;
0342   C8DA 1A              ld   a, (de)
0343   C8DB 13              inc  de
0344   C8DC AE              xor  (hl)
0345   C8DD 77              ld   (hl), a
0346   C8DE 24              inc  h
0347   C8DF                 ; dialog/tools.c:164 a = *de; de++; *hl = (a ^= *hl); h++;
0348   C8DF 1A              ld   a, (de)
0349   C8E0 13              inc  de
0350   C8E1 AE              xor  (hl)
0351   C8E2 77              ld   (hl), a
0352   C8E3 24              inc  h
0353   C8E4                 ; dialog/tools.c:165 a = *de; de++; *hl = (a ^= *hl); h++;
0354   C8E4 1A              ld   a, (de)
0355   C8E5 13              inc  de
0356   C8E6 AE              xor  (hl)
0357   C8E7 77              ld   (hl), a
0358   C8E8 24              inc  h
0359   C8E9                 ; dialog/tools.c:166 a = *de; de++; *hl = (a ^= *hl); h++;
0360   C8E9 1A              ld   a, (de)
0361   C8EA 13              inc  de
0362   C8EB AE              xor  (hl)
0363   C8EC 77              ld   (hl), a
0364   C8ED 24              inc  h
0365   C8EE                 ; dialog/tools.c:167 a = *de; de++; *hl = (a ^= *hl); h++;
0366   C8EE 1A              ld   a, (de)
0367   C8EF 13              inc  de
0368   C8F0 AE              xor  (hl)
0369   C8F1 77              ld   (hl), a
0370   C8F2 24              inc  h
0371   C8F3                 ; dialog/tools.c:168 a = *de; de++; *hl = (a ^= *hl); h++;
0372   C8F3 1A              ld   a, (de)
0373   C8F4 13              inc  de
0374   C8F5 AE              xor  (hl)
0375   C8F6 77              ld   (hl), a
0376   C8F7 24              inc  h
0377   C8F8                 ; dialog/tools.c:169 a = *de; de++; *hl = (a ^= *hl); h++;
0378   C8F8 1A              ld   a, (de)
0379   C8F9 13              inc  de
0380   C8FA AE              xor  (hl)
0381   C8FB 77              ld   (hl), a
0382   C8FC 24              inc  h
0383   C8FD                 ; dialog/tools.c:170 a = *de; de++; *hl = (a ^= *hl);
0384   C8FD 1A              ld   a, (de)
0385   C8FE 13              inc  de
0386   C8FF AE              xor  (hl)
0387   C900 77              ld   (hl), a
0388   C901                 ; dialog/tools.c:171 h = ((a = h) -= 7);
0389   C901 7C              ld   a, h
0390   C902 D6 07           sub  7
0391   C904 67              ld   h, a
0392   C905                 ; dialog/tools.c:172 l++;
0393   C905 2C              inc  l
0394   C906                 ; dialog/tools.c:173 *bc = a = ixh; de++;
0395   C906 DD 7C           ld   a, ixh
0396   C908 02              ld   (bc), a
0397   C909 13              inc  de
0398   C90A                 ; dialog/tools.c:174 bc++;
0399   C90A 03              inc  bc
0400   C90B                 ; dialog/tools.c:175 }
0401   C90B C9              ret
0402   C90C                 ; dialog/tools.c:176 
0403   C90C                 ; dialog/tools.c:177 void drawTextRight(hl, de, a)
0404   C90C             drawTextRight: 
0405   C90C                 ; dialog/tools.c:178 {
0406   C90C                 ; dialog/tools.c:179 push(a)
0407   C90C                 ; dialog/tools.c:180 {
0408   C90C F5              push af
0409   C90D                 ; dialog/tools.c:181 push(hl, de)
0410   C90D                 ; dialog/tools.c:182 {
0411   C90D E5              push hl
0412   C90E D5              push de
0413   C90F                 ; dialog/tools.c:183 gMeasureText(de); // Вход: de - текст. Выход: de - текст, a - терминатор, c - ширина в пикселях. Портит: b, hl.
0414   C90F CD 72 60        call gMeasureText
0415   C912                 ; dialog/tools.c:184 }
0416   C912 D1              pop  de
0417   C913 E1              pop  hl
0418   C914                 ; dialog/tools.c:185 l = ((a = l) -= c);
0419   C914 7D              ld   a, l
0420   C915 91              sub  c
0421   C916 6F              ld   l, a
0422   C917                 ; dialog/tools.c:186 }
0423   C917 F1              pop  af
0424   C918                 ; dialog/tools.c:187 gDrawTextEx(hl, de, a);
0425   C918 CD 69 60        call gDrawTextEx
0426   C91B                 ; dialog/tools.c:188 }
0427   C91B C9              ret
0428   C91C                 ; dialog/tools.c:189 
0429   C91C             
0001   C91C             dialogrect_0  db 0FFh, 0FFh, 0E0h, 0CFh, 0DCh, 0D8h, 0D0h, 0D0h, 046h
0001   C91C FFFFE0CFDCD8D0D046
0002   C925             dialogrect_1  db 0FFh, 0FFh, 000h, 000h, 000h, 000h, 000h, 000h, 046h
0002   C925 FFFF00000000000046
0003   C92E             dialogrect_2  db 0FFh, 0FFh, 007h, 0F3h, 03Bh, 01Bh, 00Bh, 00Bh, 046h
0003   C92E FFFF07F33B1B0B0B46
0004   C937             dialogrect_3  db 0C0h, 0C0h, 0C0h, 0C0h, 0C0h, 0C0h, 0C0h, 0C0h, 046h
0004   C937 C0C0C0C0C0C0C0C046
0005   C940             dialogrect_4  db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 047h
0005   C940 000000000000000047
0006   C949             dialogrect_5  db 003h, 003h, 003h, 003h, 003h, 003h, 003h, 003h, 046h
0006   C949 030303030303030346
0007   C952             dialogrect_6  db 0D0h, 0D0h, 0D8h, 0DCh, 0CFh, 0E0h, 0FFh, 0FFh, 046h
0007   C952 D0D0D8DCCFE0FFFF46
0008   C95B             dialogrect_7  db 000h, 000h, 000h, 000h, 000h, 000h, 0FFh, 0FFh, 046h
0008   C95B 000000000000FFFF46
0009   C964             dialogrect_8  db 00Bh, 00Bh, 01Bh, 03Bh, 0F3h, 007h, 0FFh, 0FFh, 046h
0009   C964 0B0B1B3BF307FFFF46
0010   C96D             dialogrect_9  db 0FEh, 0FEh, 07Ch, 038h, 038h, 010h, 010h, 000h, 046h
0010   C96D FEFE7C383810100046
0011   C976             
0001   C976             image_panelgraph: 
0002   C976                 ; Width, height
0003   C976 20 04           db 32, 4
0004   C978                 ; Black & white
0005   C978                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h ; 0
0005   C978 0000000000000000000000000000000000000000000000000000000000000000
0006   C998                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 00Ch, 0E4h, 0AAh, 097h, 080h, 000h, 031h, 0D1h, 04Bh, 09Ch, 000h
0006   C998 0000000000000000000000000000000000000000000CE4AA97800031D14B9C00
0007   C9B8                 db 00Eh, 067h, 018h, 040h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 012h, 094h, 0AAh, 094h, 000h, 000h, 04Ah, 051h, 049h, 024h, 000h
0007   C9B8 0E67184000000000000000000000000000000000001294AA9400004A51492400
0008   C9D8                 db 008h, 094h, 0A4h, 0A0h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 012h, 093h, 09Ch, 0B7h, 000h, 000h, 012h, 055h, 059h, 024h, 000h
0008   C9D8 0894A4A0000000000000000000000000000000000012939CB700001255592400
0009   C9F8                 db 008h, 097h, 024h, 0A0h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 012h, 0E0h, 0AAh, 0D4h, 000h, 000h, 04Bh, 0D5h, 069h, 03Ch, 000h
0009   C9F8 089724A0000000000000000000000000000000000012E0AAD400004BD5693C00
0010   CA18                 db 008h, 094h, 024h, 0A0h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 00Ch, 083h, 02Ah, 097h, 080h, 000h, 032h, 05Fh, 049h, 024h, 000h
0010   CA18 089424A000000000000000000000000000000000000C832A978000325F492400
0011   CA38                 db 008h, 064h, 019h, 0F0h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 080h, 000h, 000h
0011   CA38 086419F000000000000000000000000000000000000000000000000000800000
0012   CA58                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 0FFh, 0FFh, 081h, 0FFh, 0FFh, 080h, 001h, 0FFh, 0FFh, 080h, 000h
0012   CA58 000000000000000000000000000000000000000001FFFF81FFFF8001FFFF8000
0013   CA78                 db 000h, 000h, 000h, 000h, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h ; 1
0013   CA78 00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00010000810000800100008000
0014   CA98                 db 000h, 000h, 000h, 000h, 080h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0014   CA98 0000000080000000000000000000000000000100010000810000800100008000
0015   CAB8                 db 00Ah, 0A5h, 092h, 080h, 080h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0015   CAB8 0AA5928080000000000000000000000000000100010000810000800100008000
0016   CAD8                 db 00Ah, 0A4h, 052h, 0E0h, 080h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0016   CAD8 0AA452E080000000000000000000000000000100010000810000800100008000
0017   CAF8                 db 007h, 02Ch, 09Eh, 090h, 080h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0017   CAF8 072C9E9080000000000000000000000000000100010000810000800100008000
0018   CB18                 db 00Ah, 0B4h, 052h, 090h, 080h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0018   CB18 0AB4529080000000000000000000000000000100010000810000800100008000
0019   CB38                 db 00Ah, 0A5h, 092h, 0E0h, 080h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0019   CB38 0AA592E080000000000000000000000000000100010000810000800100008000
0020   CB58                 db 000h, 000h, 000h, 000h, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 0FFh, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0020   CB58 00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFF00010000810000800100008000
0021   CB78                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h ; 2
0021   CB78 0000000000000000000000000000000000000000010000810000800100008000
0022   CB98                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0022   CB98 0000000000000000000000000000000000000000010000810000800100008000
0023   CBB8                 db 006h, 073h, 01Dh, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0023   CBB8 06731D0000000000000000000000000000000000010000810000800100008000
0024   CBD8                 db 009h, 024h, 0A5h, 0C0h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0024   CBD8 0924A5C000000000000000000000000000000000010000810000800100008000
0025   CBF8                 db 008h, 027h, 0A5h, 020h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0025   CBF8 0827A52000000000000000000000000000000000010000810000800100008000
0026   CC18                 db 009h, 024h, 0A5h, 020h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0026   CC18 0924A52000000000000000000000000000000000010000810000800100008000
0027   CC38                 db 006h, 024h, 0A5h, 0C0h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0027   CC38 0624A5C000000000000000000000000000000000010000810000800100008000
0028   CC58                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 000h, 000h, 081h, 000h, 000h, 080h, 001h, 000h, 000h, 080h, 000h
0028   CC58 0000000000000000000000000000000000000000010000810000800100008000
0029   CC78                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 001h, 0FFh, 0FFh, 081h, 0FFh, 0FFh, 080h, 001h, 0FFh, 0FFh, 080h, 000h ; 3
0029   CC78 000000000000000000000000000000000000000001FFFF81FFFF8001FFFF8000
0030   CC98                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h
0030   CC98 0000000000000000000000000000000000000000000000000000000000000000
0031   CCB8                 db 00Fh, 04Bh, 0BDh, 0C0h, 094h, 0B9h, 0EEh, 067h, 020h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h
0031   CCB8 0F4BBDC094B9EE67200000000000000000000000000000000000000000000000
0032   CCD8                 db 008h, 049h, 021h, 020h, 094h, 0A5h, 004h, 094h, 0B8h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h
0032   CCD8 0849212094A50494B80000000000000000000000000000000000000000000000
0033   CCF8                 db 00Eh, 069h, 039h, 02Eh, 0B7h, 0B9h, 0C4h, 0F7h, 024h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h
0033   CCF8 0E69392EB7B9C4F7240000000000000000000000000000000000000000000000
0034   CD18                 db 008h, 059h, 021h, 0C0h, 0D4h, 0A5h, 004h, 094h, 024h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h
0034   CD18 085921C0D4A50494240000000000000000000000000000000000000000000000
0035   CD38                 db 00Fh, 049h, 03Dh, 020h, 094h, 0B9h, 0E4h, 094h, 038h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h
0035   CD38 0F493D2094B9E494380000000000000000000000000000000000000000000000
0036   CD58                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h
0036   CD58 0000000000000000000000000000000000000000000000000000000000000000
0037   CD78                 ; Color attributes
0038   CD78                 db 04Fh, 04Fh, 04Fh, 04Fh, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 049h ; 0
0038   CD78 4F4F4F4F494949494949494949494949494949494F4F4F4F4F4F4F4F4F4F4F49
0039   CD98                 db 04Fh, 04Fh, 04Fh, 04Fh, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 047h, 049h, 04Fh, 045h, 045h, 04Fh, 045h, 045h, 04Fh, 04Fh, 045h, 045h, 04Fh, 049h ; 1
0039   CD98 4F4F4F4F474747474747474747474747474747494F45454F45454F4F45454F49
0040   CDB8                 db 04Fh, 04Fh, 04Fh, 04Fh, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 04Fh, 045h, 045h, 04Fh, 045h, 045h, 04Fh, 04Fh, 045h, 045h, 04Fh, 049h ; 2
0040   CDB8 4F4F4F4F494949494949494949494949494949494F45454F45454F4F45454F49
0041   CDD8                 db 04Dh, 04Dh, 04Dh, 04Dh, 04Dh, 04Dh, 04Dh, 04Dh, 04Dh, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 049h, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 04Fh, 049h ; 3
0041   CDD8 4D4D4D4D4D4D4D4D4D49494949494949494949494F4F4F4F4F4F4F4F4F4F4F49
0042   CDF8             
0001   CDF8                ds (10000h - $) & 7
0002   CDF8             
0003   CDF8             inventgraphTails:  ; count 66
0004   CDF8                 db 000h, 000h, 000h, 000h, 000h, 000h, 000h, 000h
0004   CDF8 0000000000000000
0005   CE00                 db 000h, 000h, 000h, 003h, 00Fh, 00Ch, 018h, 018h
0005   CE00 000000030F0C1818
0006   CE08                 db 000h, 000h, 000h, 0FFh, 0FFh, 000h, 000h, 000h
0006   CE08 000000FFFF000000
0007   CE10                 db 000h, 000h, 000h, 000h, 0FFh, 0FFh, 000h, 000h
0007   CE10 00000000FFFF0000
0008   CE18                 db 01Eh, 0F7h, 0FFh, 01Eh, 000h, 0FFh, 0FFh, 000h
0008   CE18 1EF7FF1E00FFFF00
0009   CE20                 db 000h, 0C0h, 0F8h, 000h, 03Fh, 0FFh, 0E0h, 000h
0009   CE20 00C0F8003FFFE000
0010   CE28                 db 000h, 000h, 007h, 0FFh, 0FCh, 003h, 00Fh, 000h
0010   CE28 000007FFFC030F00
0011   CE30                 db 000h, 000h, 0FFh, 0FFh, 000h, 0FFh, 0FFh, 000h
0011   CE30 0000FFFF00FFFF00
0012   CE38                 db 000h, 000h, 0F0h, 0C0h, 03Fh, 0FFh, 0E0h, 000h
0012   CE38 0000F0C03FFFE000
0013   CE40                 db 000h, 000h, 0FFh, 0FFh, 000h, 0FEh, 080h, 000h
0013   CE40 0000FFFF00FE8000
0014   CE48                 db 000h, 000h, 000h, 0C0h, 0F0h, 030h, 018h, 018h
0014   CE48 000000C0F0301818
0015   CE50                 db 018h, 018h, 018h, 018h, 018h, 018h, 018h, 018h
0015   CE50 1818181818181818
0016   CE58                 db 001h, 002h, 000h, 002h, 001h, 000h, 000h, 000h
0016   CE58 0102000201000000
0017   CE60                 db 08Ch, 052h, 092h, 05Eh, 092h, 000h, 000h, 000h
0017   CE60 8C52925E92000000
0018   CE68                 db 091h, 0A2h, 0C4h, 0A4h, 094h, 000h, 000h, 000h
0018   CE68 91A2C4A494000000
0019   CE70                 db 0A5h, 0A5h, 0ADh, 0B5h, 0A5h, 000h, 000h, 000h
0019   CE70 A5A5ADB5A5000000
0020   CE78                 db 026h, 029h, 0E9h, 02Fh, 029h, 000h, 000h, 000h
0020   CE78 2629E92F29000000
0021   CE80                 db 04Ah, 04Ah, 07Ah, 04Bh, 04Ah, 000h, 000h, 000h
0021   CE80 4A4A7A4B4A000000
0022   CE88                 db 04Eh, 052h, 0D2h, 04Eh, 052h, 000h, 000h, 000h
0022   CE88 4E52D24E52000000
0023   CE90                 db 018h, 018h, 018h, 00Ch, 00Dh, 00Ch, 006h, 016h
0023   CE90 1818180C0D0C0616
0024   CE98                 db 000h, 000h, 000h, 087h, 03Fh, 0F8h, 0C0h, 010h
0024   CE98 000000873FF8C010
0025   CEA0                 db 000h, 000h, 000h, 000h, 0FFh, 0FEh, 000h, 000h
0025   CEA0 00000000FFFE0000
0026   CEA8                 db 018h, 018h, 018h, 030h, 0B0h, 030h, 060h, 068h
0026   CEA8 18181830B0306068
0027   CEB0                 db 036h, 036h, 036h, 03Ah, 01Ah, 018h, 018h, 018h
0027   CEB0 3636363A1A181818
0028   CEB8                 db 002h, 002h, 002h, 003h, 002h, 000h, 000h, 000h
0028   CEB8 0202020302000000
0029   CEC0                 db 04Ch, 052h, 0D0h, 052h, 04Ch, 000h, 000h, 000h
0029   CEC0 4C52D0524C000000
0030   CEC8                 db 0F3h, 094h, 094h, 094h, 093h, 000h, 000h, 000h
0030   CEC8 F394949493000000
0031   CED0                 db 00Dh, 095h, 0A5h, 0A5h, 025h, 000h, 000h, 000h
0031   CED0 0D95A5A525000000
0032   CED8                 db 006h, 0C9h, 022h, 029h, 0C6h, 000h, 000h, 000h
0032   CED8 06C92229C6000000
0033   CEE0                 db 033h, 04Ah, 04Bh, 04Ah, 033h, 000h, 000h, 000h
0033   CEE0 334A4B4A33000000
0034   CEE8                 db 0E8h, 04Eh, 049h, 049h, 04Eh, 000h, 000h, 000h
0034   CEE8 E84E49494E000000
0035   CEF0                 db 001h, 001h, 001h, 001h, 001h, 000h, 000h, 000h
0035   CEF0 0101010101000000
0036   CEF8                 db 00Fh, 009h, 009h, 009h, 009h, 000h, 000h, 000h
0036   CEF8 0F09090909000000
0037   CF00                 db 071h, 04Ah, 04Ah, 072h, 041h, 000h, 000h, 000h
0037   CF00 714A4A7241000000
0038   CF08                 db 08Ch, 052h, 052h, 052h, 0BFh, 000h, 000h, 000h
0038   CF08 8C525252BF000000
0039   CF10                 db 065h, 093h, 091h, 0F3h, 095h, 000h, 000h, 000h
0039   CF10 659391F395000000
0040   CF18                 db 064h, 0A4h, 01Ch, 084h, 058h, 000h, 000h, 000h
0040   CF18 64A41C8458000000
0041   CF20                 db 06Ch, 06Ch, 06Ch, 05Ch, 058h, 018h, 018h, 018h
0041   CF20 6C6C6C5C58181818
0042   CF28                 db 018h, 00Ch, 00Ch, 00Ch, 02Ch, 02Ch, 02Eh, 066h
0042   CF28 180C0C0C2C2C2E66
0043   CF30                 db 018h, 030h, 030h, 030h, 030h, 034h, 074h, 06Ch
0043   CF30 183030303034746C
0044   CF38                 db 066h, 0F6h, 0F6h, 0B6h, 0F6h, 066h, 066h, 066h
0044   CF38 66F6F6B6F6666666
0045   CF40                 db 06Ch, 068h, 068h, 068h, 068h, 068h, 068h, 060h
0045   CF40 6C68686868686860
0046   CF48                 db 00Ch, 00Ch, 00Ch, 00Ch, 00Ch, 00Ch, 00Ch, 00Ch
0046   CF48 0C0C0C0C0C0C0C0C
0047   CF50                 db 030h, 030h, 030h, 030h, 030h, 030h, 030h, 030h
0047   CF50 3030303030303030
0048   CF58                 db 018h, 018h, 00Ch, 00Dh, 00Ch, 006h, 016h, 016h
0048   CF58 18180C0D0C061616
0049   CF60                 db 034h, 034h, 038h, 018h, 018h, 018h, 018h, 018h
0049   CF60 3434381818181818
0050   CF68                 db 007h, 000h, 003h, 000h, 007h, 000h, 000h, 000h
0050   CF68 0700030007000000
0051   CF70                 db 025h, 0A9h, 0B1h, 0A9h, 025h, 000h, 000h, 000h
0051   CF70 25A9B1A925000000
0052   CF78                 db 02Fh, 029h, 069h, 0A9h, 029h, 000h, 000h, 000h
0052   CF78 2F2969A929000000
0053   CF80                 db 04Bh, 04Ah, 05Ah, 06Bh, 04Ah, 000h, 000h, 000h
0053   CF80 4B4A5A6B4A000000
0054   CF88                 db 08Ch, 052h, 052h, 092h, 00Ch, 000h, 000h, 000h
0054   CF88 8C5252920C000000
0055   CF90                 db 0E4h, 095h, 0E6h, 095h, 0E4h, 000h, 000h, 000h
0055   CF90 E495E695E4000000
0056   CF98                 db 098h, 024h, 024h, 03Ch, 0A4h, 000h, 000h, 000h
0056   CF98 9824243CA4000000
0057   CFA0                 db 068h, 06Ch, 06Ch, 05Ch, 058h, 018h, 018h, 018h
0057   CFA0 686C6C5C58181818
0058   CFA8                 db 00Ch, 00Ch, 00Ch, 00Ch, 02Ch, 02Ch, 034h, 034h
0058   CFA8 0C0C0C0C2C2C3434
0059   CFB0                 db 018h, 030h, 030h, 030h, 030h, 034h, 074h, 064h
0059   CFB0 1830303030347464
0060   CFB8                 db 016h, 016h, 016h, 016h, 016h, 016h, 006h, 006h
0060   CFB8 1616161616160606
0061   CFC0                 db 066h, 06Fh, 06Fh, 06Dh, 06Fh, 066h, 066h, 066h
0061   CFC0 666F6F6D6F666666
0062   CFC8                 db 060h, 030h, 030h, 030h, 030h, 030h, 030h, 030h
0062   CFC8 6030303030303030
0063   CFD0                 db 018h, 018h, 00Ch, 00Fh, 003h, 000h, 000h, 000h
0063   CFD0 18180C0F03000000
0064   CFD8                 db 008h, 003h, 01Fh, 0FCh, 0E1h, 000h, 000h, 000h
0064   CFD8 08031FFCE1000000
0065   CFE0                 db 000h, 0F8h, 0E0h, 01Fh, 0FFh, 070h, 000h, 000h
0065   CFE0 00F8E01FFF700000
0066   CFE8                 db 000h, 003h, 07Fh, 0FEh, 081h, 007h, 000h, 000h
0066   CFE8 00037FFE81070000
0067   CFF0                 db 000h, 0FFh, 0FFh, 000h, 0FEh, 080h, 000h, 000h
0067   CFF0 00FFFF00FE800000
0068   CFF8                 db 000h, 080h, 0FFh, 07Fh, 000h, 000h, 000h, 000h
0068   CFF8 0080FF7F00000000
0069   D000                 db 018h, 018h, 030h, 0F0h, 0C0h, 000h, 000h, 000h
0069   D000 181830F0C0000000
0070   D008             
0071   D008             inventgraphWidth=32
0072   D008             inventgraphHeight=20
0073   D008                ds (10000h - $) & 3
0074   D008             
0075   D008             inventgraphMap:  ; size 32 x 20
0076   D008                 db 1, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 3, 4, 5, 6
0076   D008 01020202020303030302020203040506
0077   D018                 db 7, 8, 6, 9, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 10
0077   D018 0708060902020202030303030202020A
0078   D028                 db 11, 151, 12, 13, 14, 15, 16, 17, 18, 11, 11, 158, 11, 11, 158, 11
0078   D028 0B970C0D0E0F1011120B0B9E0B0B9E0B
0079   D038                 db 11, 158, 11, 19, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 3
0079   D038 0B9E0B13020202030303030202020203
0080   D048                 db 4, 5, 6, 20, 2, 2, 2, 2, 2, 3, 3, 3, 21, 2, 2, 2
0080   D048 04050614020202020203030315020202
0081   D058                 db 2, 2, 22, 23, 135, 24, 25, 26, 27, 28, 29, 13, 30, 11, 135, 31
0081   D058 020216178718191A1B1C1D0D1E0B871F
0082   D068                 db 16, 32, 33, 34, 35, 36, 37, 38, 143, 11, 142, 39, 40, 143, 11, 142
0082   D068 10202122232425268F0B8E27288F0B8E
0083   D078                 db 41, 42, 143, 11, 142, 43, 11, 143, 11, 142, 11, 11, 143, 11, 142, 11
0083   D078 292A8F0B8E2B0B8F0B8E0B0B8F0B8E0B
0084   D088                 db 11, 143, 11, 142, 11, 44, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3
0084   D088 0B8F0B8E0B2C02020203030303030303
0085   D098                 db 3, 2, 2, 2, 2, 22, 142, 11, 45, 136, 46, 47, 48, 49, 50, 51
0085   D098 0302020202168E0B2D882E2F30313233
0086   D0A8                 db 52, 53, 142, 11, 54, 143, 55, 142, 11, 56, 143, 57, 142, 11, 42, 143
0086   D0A8 34358E0B368F378E0B388F398E0B2A8F
0087   D0B8                 db 58, 142, 11, 11, 143, 11, 142, 11, 59, 2, 2, 2, 2, 3, 3, 3
0087   D0B8 3A8E0B0B8F0B8E0B3B02020202030303
0088   D0C8                 db 3, 3, 3, 2, 2, 2, 2, 2, 60, 61, 62, 63, 64, 2, 2, 2
0088   D0C8 03030302020202023C3D3E3F40020202
0089   D0D8                 db 2, 3, 3, 3, 3, 2, 2, 65
0089   D0D8 0203030303020241
0090   D0E0 80              db 128
0091   D0E1             
0092   D0E1             ; maps tails
0093   D0E1             ;   1,  2,  2,  2,  2,  3,  3,  3,  3,  2,  2,  2,  3,  4,  5,  6,  7,  8,  6,  9,  2,  2,  2,  2,  3,  3,  3,  3,  2,  2,  2, 10,
0094   D0E1             ;  11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 12, 13, 14, 15, 16, 17, 18, 11,
0095   D0E1             ;  11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0096   D0E1             ;  11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0097   D0E1             ;  11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0098   D0E1             ;  19,  2,  2,  2,  3,  3,  3,  3,  2,  2,  2,  2,  3,  4,  5,  6, 20,  2,  2,  2,  2,  2,  3,  3,  3, 21,  2,  2,  2,  2,  2, 22,
0099   D0E1             ;  23,  0,  0,  0,  0,  0,  0,  0, 24, 25, 26, 27, 28, 29, 13, 30, 11,  0,  0,  0,  0,  0,  0,  0, 31, 16, 32, 33, 34, 35, 36, 37,
0100   D0E1             ;  38,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 39,
0101   D0E1             ;  40,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 41,
0102   D0E1             ;  42,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 43,
0103   D0E1             ;  11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0104   D0E1             ;  11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0105   D0E1             ;  11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0106   D0E1             ;  44,  2,  2,  2,  3,  3,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2, 22,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0107   D0E1             ;  45,  0,  0,  0,  0,  0,  0,  0,  0, 46, 47, 48, 49, 50, 51, 52, 53,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0108   D0E1             ;  54,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 55,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0109   D0E1             ;  56,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 57,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0110   D0E1             ;  42,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 58,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0111   D0E1             ;  11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 11,
0112   D0E1             ;  59,  2,  2,  2,  2,  3,  3,  3,  3,  3,  3,  2,  2,  2,  2,  2, 60, 61, 62, 63, 64,  2,  2,  2,  2,  3,  3,  3,  3,  2,  2, 65,
0113   D0E1             
0114   D0E1             ; tail using
0115   D0E1             ;    1,  53,  53,  53,  53,  35,  35,  35,  35,  53,  53,  53,  35,   2,   2,   3,   1,   1,   3,   1,  53,  53,  53,  53,  35,  35,  35,  35,  53,  53,  53,   1,
0116   D0E1             ;   29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,   1,   2,   1,   1,   2,   1,   1,  29,
0117   D0E1             ;   29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0118   D0E1             ;   29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0119   D0E1             ;   29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0120   D0E1             ;    1,  53,  53,  53,  35,  35,  35,  35,  53,  53,  53,  53,  35,   2,   2,   3,   1,  53,  53,  53,  53,  53,  35,  35,  35,   1,  53,  53,  53,  53,  53,   2,
0121   D0E1             ;    1, 454, 454, 454, 454, 454, 454, 454,   1,   1,   1,   1,   1,   1,   2,   1,  29, 454, 454, 454, 454, 454, 454, 454,   1,   2,   1,   1,   1,   1,   1,   1,
0122   D0E1             ;    1, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,   1,
0123   D0E1             ;    1, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,   1,
0124   D0E1             ;    2, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,   1,
0125   D0E1             ;   29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0126   D0E1             ;   29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0127   D0E1             ;   29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0128   D0E1             ;    1,  53,  53,  53,  35,  35,  35,  35,  35,  35,  35,  35,  53,  53,  53,  53,   2, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0129   D0E1             ;    1, 454, 454, 454, 454, 454, 454, 454, 454,   1,   1,   1,   1,   1,   1,   1,   1, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0130   D0E1             ;    1, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,   1, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0131   D0E1             ;    1, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,   1, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0132   D0E1             ;    2, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,   1, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0133   D0E1             ;   29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454, 454,  29,
0134   D0E1             ;    1,  53,  53,  53,  53,  35,  35,  35,  35,  35,  35,  53,  53,  53,  53,  53,   1,   1,   1,   1,   1,  53,  53,  53,  53,  35,  35,  35,  35,  53,  53,   1,
0135   D0E1             
0001   D0E1                 ; dialog/invent.c:2 // (c) Алексей Морозов aka alemorf
0002   D0E1                 ; dialog/invent.c:3 // Инвентарь
0003   D0E1                 ; dialog/invent.c:4 
0004   D0E1                 ; dialog/invent.c:5 #counter 16000
0005   D0E1                 ; dialog/invent.c:6 
0006   D0E1                 ; dialog/invent.c:7 #include "common.h"
0007   D0E1                 ; dialog/invent.c:8 
0008   D0E1                 ; common.h:2 const int itemsCount = 8;
0009   D0E1                 ; common.h:3 
0010   D0E1                 ; common.h:4 // Размер глобального строкового буфера
0011   D0E1                 ; common.h:5 const int gStringBufferSize = 32;
0012   D0E1                 ; common.h:6 
0013   D0E1                 ; common.h:7 // Флаги для переменных gPanelChangedA, gPanelChangedB
0014   D0E1                 ; common.h:8 const int gPanelChangedMoney = 0x01;
0015   D0E1                 ; common.h:9 const int gPanelChangedPlace = 0x02;
0016   D0E1                 ; common.h:10 //const int gPanelChangedImages = 0x04;
0017   D0E1                 ; common.h:11 const int gPanelChanedSecondWeaponCount = 0x08;
0018   D0E1                 ; common.h:12 const int gPanelChanedArmorCount = 0x10;
0019   D0E1                 ; common.h:13 
0020   D0E1                 ; common.h:14 // Максимальное кол-во символов (не учитывая терминатор строки), которое возращает функция numberToString16
0021   D0E1                 ; common.h:15 const int numberToString16max = 5;
0022   D0E1                 ; common.h:16 
0023   D0E1                 ; common.h:17 // Максимальное кол-во предметов у игрока
0024   D0E1                 ; common.h:18 const int playerItemsMax = 5;
0025   D0E1                 ; common.h:19 
0026   D0E1                 ; common.h:20 // Максимальное кол-во типов лута у игрока (кол-во отображаемых строк в инвентаре)
0027   D0E1                 ; common.h:21 const int playerLutMax = 12;
0028   D0E1                 ; common.h:22 
0029   D0E1                 ; common.h:23 // Максимальное кол-во лута у игрока (сумма)
0030   D0E1                 ; common.h:24 const int playerLutMaxCountInLine = 99;
0031   D0E1                 ; common.h:25 
0032   D0E1                 ; common.h:26 const int secondWeaponMax = 9;
0033   D0E1                 ; common.h:27 
0034   D0E1                 ; common.h:28 // Флаги клавиш для переменные gKeyPressed, gKeyTrigger
0035   D0E1                 ; common.h:29 const int KEY_UP = 1;
0036   D0E1                 ; common.h:30 const int KEY_DOWN = 2;
0037   D0E1                 ; common.h:31 const int KEY_LEFT = 4;
0038   D0E1                 ; common.h:32 const int KEY_RIGHT = 8;
0039   D0E1                 ; common.h:33 const int KEY_FIRE = 16;
0040   D0E1                 ; common.h:34 const int KEY_MENU = 32;
0041   D0E1                 ; common.h:35 
0042   D0E1                 ; common.h:36 // Стандартные адреса ZX Spectrum
0043   D0E1                 ; common.h:37 const int screenBw0 = 0x4000;
0044   D0E1                 ; common.h:38 const int screenAttr0 = 0x5800;
0045   D0E1                 ; common.h:39 
0046   D0E1                 ; common.h:40 // Размеры экрана
0047   D0E1                 ; common.h:41 const int screenWidthTails = 32;
0048   D0E1                 ; common.h:42 const int panelHeightTails = 4;
0049   D0E1                 ; common.h:43 const int tailHeight = 8;
0050   D0E1                 ; common.h:44 const int tailWidth = 8;
0051   D0E1                 ; common.h:45 const int playfieldHeightTails = 20;
0052   D0E1                 ; common.h:46 
0053   D0E1                 ; common.h:47 // Используется при упаковке координат X, Y в регистровую пару
0054   D0E1                 ; common.h:48 const int bpl = 256;
0055   D0E1                 ; common.h:49 
0056   D0E1                 ; common.h:50 // Точки входа
0057   D0E1                 ; common.h:51 const int gPanelRedrawImagesPage = 6;
0058   D0E1                 ; common.h:52 const int gPanelRedrawImages = 0xC006;
0059   D0E1                 ; common.h:53 const int gInventPage = 6;
0060   D0E1                 ; common.h:54 const int gInvent = 0xC000;
0061   D0E1                 ; common.h:55 
0062   D0E1                 ; common.h:56 // Параметр для drawText
0063   D0E1                 ; common.h:57 const int smallFontFlag = 0x80;
0064   D0E1                 ; common.h:58 
0065   D0E1                 ; dialog/invent.c:9 const int borderColor                   = 0x44;
0066   D0E1                 ; dialog/invent.c:10 
0067   D0E1                 ; dialog/invent.c:11 const int secondWeaponBwAddrForPict     = 0x4042;
0068   D0E1                 ; dialog/invent.c:12 const int secondWeaponClAddrForPict     = 0x5842;
0069   D0E1                 ; dialog/invent.c:13 const int secondWeaponTextPos           = 35 * 256 + 19;
0070   D0E1                 ; dialog/invent.c:14 const int secondWeaponTextInactiveColor = 0x41;
0071   D0E1                 ; dialog/invent.c:15 const int secondWeaponTextActiveColor   = 0x47;
0072   D0E1                 ; dialog/invent.c:16 const int secondWeaponStepTails         = 3;
0073   D0E1                 ; dialog/invent.c:17 
0074   D0E1                 ; dialog/invent.c:18 const int itemsPos                      = 7 * 8 * 256 + 16;
0075   D0E1                 ; dialog/invent.c:19 const int itemsCursorPos                = 7 * 8 * 256 + 9;
0076   D0E1                 ; dialog/invent.c:20 const int itemsCursorColor              = 0x43;
0077   D0E1                 ; dialog/invent.c:21 const int itemColor                     = 0x45;
0078   D0E1                 ; dialog/invent.c:22 const int itemHeight                    = 10;
0079   D0E1                 ; dialog/invent.c:23 
0080   D0E1                 ; dialog/invent.c:24 const int lutPos                        = 7 * 8 * 256 + 144;
0081   D0E1                 ; dialog/invent.c:25 const int lutCountX                     = 240;
0082   D0E1                 ; dialog/invent.c:26 const int lutColor                      = 0x47;
0083   D0E1                 ; dialog/invent.c:27 const int lutItemHeight                 = 10;
0084   D0E1                 ; dialog/invent.c:28 
0085   D0E1                 ; dialog/invent.c:29 uint8_t selectedItem = 0;
0086   D0E1 00          selectedItem db 0
0087   D0E2                 ; dialog/invent.c:30 uint8_t selectedItem1 = 0;
0088   D0E2 00          selectedItem1 db 0
0089   D0E3                 ; dialog/invent.c:31 
0090   D0E3                 ; dialog/invent.c:32 const int inventgraphMapSpecialCodes = 0x80;
0091   D0E3                 ; dialog/invent.c:33 
0092   D0E3                 ; dialog/invent.c:34 void invent()
0093   D0E3             invent: 
0094   D0E3                 ; dialog/invent.c:35 {
0095   D0E3                 ; dialog/invent.c:36 // Перемещаем курсор в начало
0096   D0E3                 ; dialog/invent.c:37 selectedItem = a = 0;
0097   D0E3 3E 00           ld   a, 0
0098   D0E5 32 E1 D0        ld   (selectedItem), a
0099   D0E8                 ; dialog/invent.c:38 selectedItem1 = a;
0100   D0E8 32 E2 D0        ld   (selectedItem1), a
0101   D0EB                 ; dialog/invent.c:39 
0102   D0EB                 ; dialog/invent.c:40 // Начало рисования
0103   D0EB                 ; dialog/invent.c:41 gBeginDraw();
0104   D0EB CD 8A 60        call gBeginDraw
0105   D0EE                 ; dialog/invent.c:42 
0106   D0EE                 ; dialog/invent.c:43 // Очищаем экран, но не трогаем панель.
0107   D0EE                 ; dialog/invent.c:44 hl = screenBw0;
0108   D0EE 21 00 40        ld   hl, 16384
0109   D0F1                 ; dialog/invent.c:45 *hl = 0; // Без пикселей
0110   D0F1 36 00           ld   (hl), 0
0111   D0F3                 ; dialog/invent.c:46 ldir(hl, de = [screenBw0 + 1], bc = [screenWidthTails * 128 + screenWidthTails * panelHeightTails - 1]);
0112   D0F3 11 01 40        ld   de, 16385
0113   D0F6 01 7F 10        ld   bc, 4223
0114   D0F9 ED B0           ldir
0115   D0FB                 ; dialog/invent.c:47 a = [tailHeight - 1]; // Один проход уже сделали
0116   D0FB 3E 07           ld   a, 7
0117   D0FD                 ; dialog/invent.c:48 do
0118   D0FD             l16000: 
0119   D0FD                 ; dialog/invent.c:49 {
0120   D0FD                 ; dialog/invent.c:50 (hl = [screenWidthTails * panelHeightTails]) += de;
0121   D0FD 21 80 00        ld   hl, 128
0122   D100 19              add  hl, de
0123   D101                 ; dialog/invent.c:51 ex(hl, de);
0124   D101 EB              ex de, hl
0125   D102                 ; dialog/invent.c:52 ldir(hl = screenBw0, de, bc = [screenWidthTails * panelHeightTails]);
0126   D102 21 00 40        ld   hl, 16384
0127   D105 01 80 00        ld   bc, 128
0128   D108 ED B0           ldir
0129   D10A                 ; dialog/invent.c:53 } while(flag_nz --a);
0130   D10A 3D              dec  a
0131   D10B C2 FD D0        jp   nz, l16000
0132   D10E             l16001: 
0133   D10E                 ; dialog/invent.c:54 
0134   D10E                 ; dialog/invent.c:55 // Заливаем весь экран цветом рамки
0135   D10E                 ; dialog/invent.c:56 hl = screenAttr0;
0136   D10E 21 00 58        ld   hl, 22528
0137   D111                 ; dialog/invent.c:57 *hl = borderColor;
0138   D111 36 44           ld   (hl), 68
0139   D113                 ; dialog/invent.c:58 ldir(hl, de = [screenAttr0 + 1], bc = [screenWidthTails * playfieldHeightTails - 1]);
0140   D113 11 01 58        ld   de, 22529
0141   D116 01 7F 02        ld   bc, 639
0142   D119 ED B0           ldir
0143   D11B                 ; dialog/invent.c:59 
0144   D11B                 ; dialog/invent.c:60 // Рисуем рамку
0145   D11B                 ; dialog/invent.c:61 bc = screenBw0;
0146   D11B 01 00 40        ld   bc, 16384
0147   D11E                 ; dialog/invent.c:62 de = &inventgraphMap;
0148   D11E 11 08 D0        ld   de, inventgraphMap
0149   D121                 ; dialog/invent.c:63 while()
0150   D121             l16002: 
0151   D121                 ; dialog/invent.c:64 {
0152   D121                 ; dialog/invent.c:65 // Читаем код
0153   D121                 ; dialog/invent.c:66 a = *de; de++;
0154   D121 1A              ld   a, (de)
0155   D122 13              inc  de
0156   D123                 ; dialog/invent.c:67 
0157   D123                 ; dialog/invent.c:68 // Это специальный код
0158   D123                 ; dialog/invent.c:69 if (a >= inventgraphMapSpecialCodes)
0159   D123 FE 80           cp   128
0160   D125                 ; dialog/invent.c:70 {
0161   D125 DA 39 D1        jp   c, l16004
0162   D128                 ; dialog/invent.c:71 // Конец рисования
0163   D128                 ; dialog/invent.c:72 if (flag_z) break;
0164   D128 CA 70 D1        jp   z, l16003
0165   D12B                 ; dialog/invent.c:73 
0166   D12B                 ; dialog/invent.c:74 // Пропуск
0167   D12B                 ; dialog/invent.c:75 a -= inventgraphMapSpecialCodes;
0168   D12B D6 80           sub  128
0169   D12D                 ; dialog/invent.c:76 c = (a += c);
0170   D12D 81              add  c
0171   D12E 4F              ld   c, a
0172   D12F                 ; dialog/invent.c:77 if (flag_c) b = ((a = b) += 8);
0173   D12F D2 36 D1        jp   nc, l16005
0174   D132 78              ld   a, b
0175   D133 C6 08           add  8
0176   D135 47              ld   b, a
0177   D136                 ; dialog/invent.c:78 continue;
0178   D136             l16005: 
0179   D136 C3 21 D1        jp l16002
0180   D139                 ; dialog/invent.c:79 }
0181   D139                 ; dialog/invent.c:80 
0182   D139                 ; dialog/invent.c:81 // Вычисление адреса. Тут арифметка написана так, что номер тейла не может быть больше 127
0183   D139                 ; dialog/invent.c:82 a += a;
0184   D139             l16004: 
0185   D139 87              add  a
0186   D13A                 ; dialog/invent.c:83 l = (a += [&inventgraphTails >> 2]);
0187   D13A C6 7E           add  (inventgraphTails) >> (2)
0188   D13C 6F              ld   l, a
0189   D13D                 ; dialog/invent.c:84 h = ((a +@= [&inventgraphTails >> 10]) -= l);
0190   D13D CE 33           adc  (inventgraphTails) >> (10)
0191   D13F 95              sub  l
0192   D140 67              ld   h, a
0193   D141                 ; dialog/invent.c:85 hl += hl += hl;
0194   D141 29              add  hl, hl
0195   D142 29              add  hl, hl
0196   D143                 ; dialog/invent.c:86 
0197   D143                 ; dialog/invent.c:87 // Копируем тейл в видеопамять. Тайлы не пересекают 256-байтную страницу.
0198   D143                 ; dialog/invent.c:88 *bc = a = *hl; l++; b++;
0199   D143 7E              ld   a, (hl)
0200   D144 02              ld   (bc), a
0201   D145 2C              inc  l
0202   D146 04              inc  b
0203   D147                 ; dialog/invent.c:89 *bc = a = *hl; l++; b++;
0204   D147 7E              ld   a, (hl)
0205   D148 02              ld   (bc), a
0206   D149 2C              inc  l
0207   D14A 04              inc  b
0208   D14B                 ; dialog/invent.c:90 *bc = a = *hl; l++; b++;
0209   D14B 7E              ld   a, (hl)
0210   D14C 02              ld   (bc), a
0211   D14D 2C              inc  l
0212   D14E 04              inc  b
0213   D14F                 ; dialog/invent.c:91 *bc = a = *hl; l++; b++;
0214   D14F 7E              ld   a, (hl)
0215   D150 02              ld   (bc), a
0216   D151 2C              inc  l
0217   D152 04              inc  b
0218   D153                 ; dialog/invent.c:92 *bc = a = *hl; l++; b++;
0219   D153 7E              ld   a, (hl)
0220   D154 02              ld   (bc), a
0221   D155 2C              inc  l
0222   D156 04              inc  b
0223   D157                 ; dialog/invent.c:93 *bc = a = *hl; l++; b++;
0224   D157 7E              ld   a, (hl)
0225   D158 02              ld   (bc), a
0226   D159 2C              inc  l
0227   D15A 04              inc  b
0228   D15B                 ; dialog/invent.c:94 *bc = a = *hl; l++; b++;
0229   D15B 7E              ld   a, (hl)
0230   D15C 02              ld   (bc), a
0231   D15D 2C              inc  l
0232   D15E 04              inc  b
0233   D15F                 ; dialog/invent.c:95 *bc = a = *hl;
0234   D15F 7E              ld   a, (hl)
0235   D160 02              ld   (bc), a
0236   D161                 ; dialog/invent.c:96 
0237   D161                 ; dialog/invent.c:97 // Следующий адрес
0238   D161                 ; dialog/invent.c:98 b = ((a = b) -= 7);
0239   D161 78              ld   a, b
0240   D162 D6 07           sub  7
0241   D164 47              ld   b, a
0242   D165                 ; dialog/invent.c:99 c++;
0243   D165 0C              inc  c
0244   D166                 ; dialog/invent.c:100 if (flag_z) b = ((a = b) += 8);
0245   D166 C2 6D D1        jp   nz, l16006
0246   D169 78              ld   a, b
0247   D16A C6 08           add  8
0248   D16C 47              ld   b, a
0249   D16D                 ; dialog/invent.c:101 }
0250   D16D             l16006: 
0251   D16D C3 21 D1        jp   l16002
0252   D170             l16003: 
0253   D170                 ; dialog/invent.c:102 
0254   D170                 ; dialog/invent.c:103 // Скрываем надпись "Заклинания", если на неё заезжает курсор
0255   D170                 ; dialog/invent.c:104 if ((a = gPlayerSecondWeaponCount) >= 8)
0256   D170 3A E1 60        ld   a, (gPlayerSecondWeaponCount)
0257   D173 FE 08           cp   8
0258   D175                 ; dialog/invent.c:105 {
0259   D175 DA 8A D1        jp   c, l16007
0260   D178                 ; dialog/invent.c:106 d = h = 0x40;
0261   D178 26 40           ld   h, 64
0262   D17A 54              ld   d, h
0263   D17B                 ; dialog/invent.c:107 do
0264   D17B             l16008: 
0265   D17B                 ; dialog/invent.c:108 {
0266   D17B                 ; dialog/invent.c:109 l = 0x37;
0267   D17B 2E 37           ld   l, 55
0268   D17D                 ; dialog/invent.c:110 e = 0x38;
0269   D17D 1E 38           ld   e, 56
0270   D17F                 ; dialog/invent.c:111 ldir(hl, de, bc = 7);
0271   D17F 01 07 00        ld   bc, 7
0272   D182 ED B0           ldir
0273   D184                 ; dialog/invent.c:112 d++;
0274   D184 14              inc  d
0275   D185                 ; dialog/invent.c:113 } while(flag_z d & 0x8);
0276   D185 CB 5A           bit  3, d
0277   D187 CA 7B D1        jp   z, l16008
0278   D18A             l16009: 
0279   D18A                 ; dialog/invent.c:114 }
0280   D18A                 ; dialog/invent.c:115 
0281   D18A                 ; dialog/invent.c:116 // Рисуем пиктограммы второго оружия
0282   D18A                 ; dialog/invent.c:117 bc = secondWeaponBwAddrForPict;
0283   D18A             l16007: 
0284   D18A 01 42 40        ld   bc, 16450
0285   D18D                 ; dialog/invent.c:118 hl = secondWeaponClAddrForPict;
0286   D18D 21 42 58        ld   hl, 22594
0287   D190                 ; dialog/invent.c:119 d = 0; //! Заменить на B
0288   D190 16 00           ld   d, 0
0289   D192                 ; dialog/invent.c:120 do
0290   D192             l16010: 
0291   D192                 ; dialog/invent.c:121 {
0292   D192                 ; dialog/invent.c:122 push(bc, de)
0293   D192                 ; dialog/invent.c:123 {
0294   D192 C5              push bc
0295   D193 D5              push de
0296   D194                 ; dialog/invent.c:124 push(hl)
0297   D194                 ; dialog/invent.c:125 {
0298   D194 E5              push hl
0299   D195                 ; dialog/invent.c:126 h = 0; l = d;
0300   D195 26 00           ld   h, 0
0301   D197 6A              ld   l, d
0302   D198                 ; dialog/invent.c:127 hl += hl += hl; de = hl; (hl += hl += hl += hl) += de; hl += (de = &magic_0); ex(hl, de); // *36
0303   D198 29              add  hl, hl
0304   D199 29              add  hl, hl
0305   D19A 54              ld   d, h
0306   D19B 5D              ld   e, l
0307   D19C 29              add  hl, hl
0308   D19D 29              add  hl, hl
0309   D19E 29              add  hl, hl
0310   D19F 19              add  hl, de
0311   D1A0 11 2C D4        ld   de, magic_0
0312   D1A3 19              add  hl, de
0313   D1A4 EB              ex de, hl
0314   D1A5                 ; dialog/invent.c:128 }
0315   D1A5 E1              pop  hl
0316   D1A6                 ; dialog/invent.c:129 push(hl)
0317   D1A6                 ; dialog/invent.c:130 {
0318   D1A6 E5              push hl
0319   D1A7                 ; dialog/invent.c:131 drawSprite4(bc, hl, de);
0320   D1A7 CD C0 C8        call drawSprite4
0321   D1AA                 ; dialog/invent.c:132 }
0322   D1AA E1              pop  hl
0323   D1AB                 ; dialog/invent.c:133 }
0324   D1AB D1              pop  de
0325   D1AC C1              pop  bc
0326   D1AD                 ; dialog/invent.c:134 l = ((a = l) += secondWeaponStepTails); c = l;
0327   D1AD 7D              ld   a, l
0328   D1AE C6 03           add  3
0329   D1B0 6F              ld   l, a
0330   D1B1 4D              ld   c, l
0331   D1B2                 ; dialog/invent.c:135 d++;
0332   D1B2 14              inc  d
0333   D1B3                 ; dialog/invent.c:136 } while((a = gPlayerSecondWeaponCount) != d);
0334   D1B3 3A E1 60        ld   a, (gPlayerSecondWeaponCount)
0335   D1B6 BA              cp   d
0336   D1B7 C2 92 D1        jp   nz, l16010
0337   D1BA             l16011: 
0338   D1BA                 ; dialog/invent.c:137 
0339   D1BA                 ; dialog/invent.c:138 // Рисуем кол-во второго оружия
0340   D1BA                 ; dialog/invent.c:139 b = 0;
0341   D1BA 06 00           ld   b, 0
0342   D1BC                 ; dialog/invent.c:140 hl = secondWeaponTextPos;
0343   D1BC 21 13 23        ld   hl, 8979
0344   D1BF                 ; dialog/invent.c:141 do
0345   D1BF             l16012: 
0346   D1BF                 ; dialog/invent.c:142 {
0347   D1BF                 ; dialog/invent.c:143 push(bc)
0348   D1BF                 ; dialog/invent.c:144 {
0349   D1BF C5              push bc
0350   D1C0                 ; dialog/invent.c:145 push (hl)
0351   D1C0                 ; dialog/invent.c:146 {
0352   D1C0 E5              push hl
0353   D1C1                 ; dialog/invent.c:147 ex(hl, de);
0354   D1C1 EB              ex de, hl
0355   D1C2                 ; dialog/invent.c:148 getItemOfArray8(hl = &gPlayerSecondWeaponCounters, a = b);
0356   D1C2 21 E2 60        ld   hl, gPlayerSecondWeaponCounters
0357   D1C5 78              ld   a, b
0358   D1C6 CD 11 C8        call getItemOfArray8
0359   D1C9                 ; dialog/invent.c:149 ex(hl, de);
0360   D1C9 EB              ex de, hl
0361   D1CA                 ; dialog/invent.c:150 numberToString16(d = 0, e = a, hl = &gStringBuffer);                
0362   D1CA 16 00           ld   d, 0
0363   D1CC 5F              ld   e, a
0364   D1CD 21 99 60        ld   hl, gStringBuffer
0365   D1D0 CD 32 C8        call numberToString16
0366   D1D3                 ; dialog/invent.c:151 }
0367   D1D3 E1              pop  hl
0368   D1D4                 ; dialog/invent.c:152 push (hl)
0369   D1D4                 ; dialog/invent.c:153 {
0370   D1D4 E5              push hl
0371   D1D5                 ; dialog/invent.c:154 a = *[&gStringBuffer + 1];
0372   D1D5 3A 9A 60        ld   a, ((gStringBuffer) + (1))
0373   D1D8                 ; dialog/invent.c:155 if (a < 3) ++++l; // Выравнивание по ширине
0374   D1D8 FE 03           cp   3
0375   D1DA D2 DF D1        jp   nc, l16014
0376   D1DD 2C              inc  l
0377   D1DE 2C              inc  l
0378   D1DF                 ; dialog/invent.c:156 gDrawTextEx(hl, de = &gStringBuffer, a = [secondWeaponTextInactiveColor | 0x80]);
0379   D1DF             l16014: 
0380   D1DF 11 99 60        ld   de, gStringBuffer
0381   D1E2 3E C1           ld   a, 193
0382   D1E4 CD 69 60        call gDrawTextEx
0383   D1E7                 ; dialog/invent.c:157 }
0384   D1E7 E1              pop  hl
0385   D1E8                 ; dialog/invent.c:158 }
0386   D1E8 C1              pop  bc
0387   D1E9                 ; dialog/invent.c:159 l = ((a = l) += [secondWeaponStepTails * tailWidth]);
0388   D1E9 7D              ld   a, l
0389   D1EA C6 18           add  24
0390   D1EC 6F              ld   l, a
0391   D1ED                 ; dialog/invent.c:160 b++;
0392   D1ED 04              inc  b
0393   D1EE                 ; dialog/invent.c:161 } while((a = gPlayerSecondWeaponCount) != b);
0394   D1EE 3A E1 60        ld   a, (gPlayerSecondWeaponCount)
0395   D1F1 B8              cp   b
0396   D1F2 C2 BF D1        jp   nz, l16012
0397   D1F5             l16013: 
0398   D1F5                 ; dialog/invent.c:162 
0399   D1F5                 ; dialog/invent.c:163 // Рисуем наименования предметов
0400   D1F5                 ; dialog/invent.c:164 b = a = gPlayerItemsCount;
0401   D1F5 3A DE 60        ld   a, (gPlayerItemsCount)
0402   D1F8 47              ld   b, a
0403   D1F9                 ; dialog/invent.c:165 hl = itemsPos;
0404   D1F9 21 10 38        ld   hl, 14352
0405   D1FC                 ; dialog/invent.c:166 de = &gPlayerItems;
0406   D1FC 11 D9 60        ld   de, gPlayerItems
0407   D1FF                 ; dialog/invent.c:167 do
0408   D1FF             l16015: 
0409   D1FF                 ; dialog/invent.c:168 {
0410   D1FF                 ; dialog/invent.c:169 push(bc, de, hl)
0411   D1FF                 ; dialog/invent.c:170 {
0412   D1FF C5              push bc
0413   D200 D5              push de
0414   D201 E5              push hl
0415   D202                 ; dialog/invent.c:171 ex(hl, de);
0416   D202 EB              ex de, hl
0417   D203                 ; dialog/invent.c:172 getItemOfArray16(a = *hl, hl = &itemNames);
0418   D203 7E              ld   a, (hl)
0419   D204 21 00 D6        ld   hl, itemNames
0420   D207 CD 18 C8        call getItemOfArray16
0421   D20A                 ; dialog/invent.c:173 ex(hl, de);
0422   D20A EB              ex de, hl
0423   D20B                 ; dialog/invent.c:174 gDrawTextEx(hl, de, a = itemColor);
0424   D20B 3E 45           ld   a, 69
0425   D20D CD 69 60        call gDrawTextEx
0426   D210                 ; dialog/invent.c:175 }
0427   D210 E1              pop  hl
0428   D211 D1              pop  de
0429   D212 C1              pop  bc
0430   D213                 ; dialog/invent.c:176 de++;
0431   D213 13              inc  de
0432   D214                 ; dialog/invent.c:177 h = ((a = h) += itemHeight);
0433   D214 7C              ld   a, h
0434   D215 C6 0A           add  10
0435   D217 67              ld   h, a
0436   D218                 ; dialog/invent.c:178 } while(--b);
0437   D218 10 E5           djnz l16015
0438   D21A             l16016: 
0439   D21A                 ; dialog/invent.c:179 
0440   D21A                 ; dialog/invent.c:180 // Рисуем наименование лута
0441   D21A                 ; dialog/invent.c:181 b = a = gPlayerLutCount;
0442   D21A 3A D8 60        ld   a, (gPlayerLutCount)
0443   D21D 47              ld   b, a
0444   D21E                 ; dialog/invent.c:182 hl = lutPos;
0445   D21E 21 90 38        ld   hl, 14480
0446   D221                 ; dialog/invent.c:183 de = &gPlayerLut;
0447   D221 11 C0 60        ld   de, gPlayerLut
0448   D224                 ; dialog/invent.c:184 do
0449   D224             l16017: 
0450   D224                 ; dialog/invent.c:185 {
0451   D224                 ; dialog/invent.c:186 push(bc)
0452   D224                 ; dialog/invent.c:187 {
0453   D224 C5              push bc
0454   D225                 ; dialog/invent.c:188 // Преобразуем кол-во в строку (gStringBuffer)
0455   D225                 ; dialog/invent.c:189 push(hl, de)
0456   D225                 ; dialog/invent.c:190 {
0457   D225 E5              push hl
0458   D226 D5              push de
0459   D227                 ; dialog/invent.c:191 (hl = playerLutMax) += de;
0460   D227 21 0C 00        ld   hl, 12
0461   D22A 19              add  hl, de
0462   D22B                 ; dialog/invent.c:192 numberToString16(d = 0, e = *hl, hl = &gStringBuffer);
0463   D22B 16 00           ld   d, 0
0464   D22D 5E              ld   e, (hl)
0465   D22E 21 99 60        ld   hl, gStringBuffer
0466   D231 CD 32 C8        call numberToString16
0467   D234                 ; dialog/invent.c:193 }
0468   D234 D1              pop  de
0469   D235 E1              pop  hl
0470   D236                 ; dialog/invent.c:194 
0471   D236                 ; dialog/invent.c:195 push(de)
0472   D236                 ; dialog/invent.c:196 {
0473   D236 D5              push de
0474   D237                 ; dialog/invent.c:197 // Тип лута
0475   D237                 ; dialog/invent.c:198 a = *de;
0476   D237 1A              ld   a, (de)
0477   D238                 ; dialog/invent.c:199 
0478   D238                 ; dialog/invent.c:200 // Тип лута в строку (de)
0479   D238                 ; dialog/invent.c:201 ex(hl, de);
0480   D238 EB              ex de, hl
0481   D239                 ; dialog/invent.c:202 getItemOfArray16(hl = &lutNames, a);
0482   D239 21 10 D6        ld   hl, lutNames
0483   D23C CD 18 C8        call getItemOfArray16
0484   D23F                 ; dialog/invent.c:203 ex(hl, de);
0485   D23F EB              ex de, hl
0486   D240                 ; dialog/invent.c:204 
0487   D240                 ; dialog/invent.c:205 // Выводим наименование
0488   D240                 ; dialog/invent.c:206 push(hl)
0489   D240                 ; dialog/invent.c:207 {
0490   D240 E5              push hl
0491   D241                 ; dialog/invent.c:208 gDrawTextEx(hl, de, a = lutColor);
0492   D241 3E 47           ld   a, 71
0493   D243 CD 69 60        call gDrawTextEx
0494   D246                 ; dialog/invent.c:209 }
0495   D246 E1              pop  hl
0496   D247                 ; dialog/invent.c:210 
0497   D247                 ; dialog/invent.c:211 // Выводим кол-во по правому краю
0498   D247                 ; dialog/invent.c:212 push(hl)
0499   D247                 ; dialog/invent.c:213 {
0500   D247 E5              push hl
0501   D248                 ; dialog/invent.c:214 l = lutCountX;
0502   D248 2E F0           ld   l, 240
0503   D24A                 ; dialog/invent.c:215 drawTextRight(hl, de = &gStringBuffer, a = lutColor);
0504   D24A 11 99 60        ld   de, gStringBuffer
0505   D24D 3E 47           ld   a, 71
0506   D24F CD 0C C9        call drawTextRight
0507   D252                 ; dialog/invent.c:216 }
0508   D252 E1              pop  hl
0509   D253                 ; dialog/invent.c:217 }
0510   D253 D1              pop  de
0511   D254                 ; dialog/invent.c:218 }
0512   D254 C1              pop  bc
0513   D255                 ; dialog/invent.c:219 
0514   D255                 ; dialog/invent.c:220 h = ((a = h) += lutItemHeight); // Следующий текст пишем ниже
0515   D255 7C              ld   a, h
0516   D256 C6 0A           add  10
0517   D258 67              ld   h, a
0518   D259                 ; dialog/invent.c:221 de++; // Следующий ЛУТ
0519   D259 13              inc  de
0520   D25A                 ; dialog/invent.c:222 } while(--b);
0521   D25A 10 C8           djnz l16017
0522   D25C             l16018: 
0523   D25C                 ; dialog/invent.c:223 
0524   D25C                 ; dialog/invent.c:224 // Рисуем основное оружие
0525   D25C                 ; dialog/invent.c:225 drawSprite4(hl = 0x59E1, bc = 0x48E1, de = [&magic_0 + 36]);
0526   D25C 21 E1 59        ld   hl, 23009
0527   D25F 01 E1 48        ld   bc, 18657
0528   D262 11 50 D4        ld   de, (magic_0) + (36)
0529   D265 CD C0 C8        call drawSprite4
0530   D268                 ; dialog/invent.c:226 gDrawTextEx(hl = [15 * 8 * 256 + 28], de = "Обычное оружие", a = 0x47);
0531   D268 21 1C 78        ld   hl, 30748
0532   D26B 11 EB D3        ld   de, s16000
0533   D26E 3E 47           ld   a, 71
0534   D270 CD 69 60        call gDrawTextEx
0535   D273                 ; dialog/invent.c:227 gDrawTextEx(hl = [(15 * 8 + 9) * 256 + 28], de = "\x16\x17\x18\x15\x19\x1A\x1B\x02", a = 0x46);
0536   D273 21 1C 81        ld   hl, 33052
0537   D276 11 C8 D3        ld   de, s16001
0538   D279 3E 46           ld   a, 70
0539   D27B CD 69 60        call gDrawTextEx
0540   D27E                 ; dialog/invent.c:228 
0541   D27E                 ; dialog/invent.c:229 // Рисуем защиту
0542   D27E                 ; dialog/invent.c:230 drawSprite4(hl = 0x5A21, bc = 0x5021, de = [&magic_0 + 36 * 3]);
0543   D27E 21 21 5A        ld   hl, 23073
0544   D281 01 21 50        ld   bc, 20513
0545   D284 11 98 D4        ld   de, (magic_0) + (108)
0546   D287 CD C0 C8        call drawSprite4
0547   D28A                 ; dialog/invent.c:231 gDrawTextEx(hl = [17 * 8 * 256 + 28], de = "Обычная защита", a = 0x47);
0548   D28A 21 1C 88        ld   hl, 34844
0549   D28D 11 DC D3        ld   de, s16002
0550   D290 3E 47           ld   a, 71
0551   D292 CD 69 60        call gDrawTextEx
0552   D295                 ; dialog/invent.c:232 gDrawTextEx(hl = [(17 * 8 + 9) * 256 + 28], de = "\x1A\x1B\x1C\x15\x1D\x1E\x1F\x02", a = 0x46);
0553   D295 21 1C 91        ld   hl, 37148
0554   D298 11 D1 D3        ld   de, s16003
0555   D29B 3E 46           ld   a, 70
0556   D29D CD 69 60        call gDrawTextEx
0557   D2A0                 ; dialog/invent.c:233 
0558   D2A0                 ; dialog/invent.c:234 // Рисуем ключи
0559   D2A0                 ; dialog/invent.c:235 drawSprite4(hl = 0x5A2E, bc = 0x502E, de = [&magic_0 + 36 * 9]);
0560   D2A0 21 2E 5A        ld   hl, 23086
0561   D2A3 01 2E 50        ld   bc, 20526
0562   D2A6 11 70 D5        ld   de, (magic_0) + (324)
0563   D2A9 CD C0 C8        call drawSprite4
0564   D2AC                 ; dialog/invent.c:236 
0565   D2AC                 ; dialog/invent.c:237 // Рисуем курсоры
0566   D2AC                 ; dialog/invent.c:238 drawSecondWeaponCursor(ixh = secondWeaponTextActiveColor);
0567   D2AC DD 26 47        ld   ixh, 71
0568   D2AF CD 83 D3        call drawSecondWeaponCursor
0569   D2B2                 ; dialog/invent.c:239 drawItemCursor();
0570   D2B2 CD 52 D3        call drawItemCursor
0571   D2B5                 ; dialog/invent.c:240 
0572   D2B5                 ; dialog/invent.c:241 gEndDraw();
0573   D2B5 CD 8D 60        call gEndDraw
0574   D2B8                 ; dialog/invent.c:242 
0575   D2B8                 ; dialog/invent.c:243 // ** Меню ***
0576   D2B8                 ; dialog/invent.c:244 
0577   D2B8                 ; dialog/invent.c:245 while()
0578   D2B8             l16019: 
0579   D2B8                 ; dialog/invent.c:246 {
0580   D2B8                 ; dialog/invent.c:247 // Ждем, если прошло меньше 1/50 сек с прошлого цикла.
0581   D2B8                 ; dialog/invent.c:248 while ((a = gVideoPage) & 1);
0582   D2B8             l16021: 
0583   D2B8 3A BA 60        ld   a, (gVideoPage)
0584   D2BB CB 47           bit  0, a
0585   D2BD CA C3 D2        jp   z, l16022
0586   D2C0 C3 B8 D2        jp   l16021
0587   D2C3             l16022: 
0588   D2C3                 ; dialog/invent.c:249 gVideoPage = (a |= 1);
0589   D2C3 F6 01           or   1
0590   D2C5 32 BA 60        ld   (gVideoPage), a
0591   D2C8                 ; dialog/invent.c:250 
0592   D2C8                 ; dialog/invent.c:251 // Клавиша
0593   D2C8                 ; dialog/invent.c:252 hl = &gKeyTrigger;
0594   D2C8 21 BC 60        ld   hl, gKeyTrigger
0595   D2CB                 ; dialog/invent.c:253 a = *hl;
0596   D2CB 7E              ld   a, (hl)
0597   D2CC                 ; dialog/invent.c:254 *hl = 0;
0598   D2CC 36 00           ld   (hl), 0
0599   D2CE                 ; dialog/invent.c:255 if (a & KEY_LEFT)
0600   D2CE CB 57           bit  2, a
0601   D2D0                 ; dialog/invent.c:256 {
0602   D2D0 CA E1 D2        jp   z, l16023
0603   D2D3                 ; dialog/invent.c:257 a = gPlayerSecondWeaponSel;
0604   D2D3 3A EB 60        ld   a, (gPlayerSecondWeaponSel)
0605   D2D6                 ; dialog/invent.c:258 a-=1;
0606   D2D6 D6 01           sub  1
0607   D2D8                 ; dialog/invent.c:259 if (flag_c) continue;
0608   D2D8 DA B8 D2        jp   c, l16019
0609   D2DB                 ; dialog/invent.c:260 setSecondWeapon(a);
0610   D2DB CD 63 D3        call setSecondWeapon
0611   D2DE                 ; dialog/invent.c:261 }
0612   D2DE                 ; dialog/invent.c:262 else if (a & KEY_RIGHT)
0613   D2DE C3 2C D3        jp   l16024
0614   D2E1             l16023: 
0615   D2E1 CB 5F           bit  3, a
0616   D2E3                 ; dialog/invent.c:263 {
0617   D2E3 CA F7 D2        jp   z, l16025
0618   D2E6                 ; dialog/invent.c:264 a = gPlayerSecondWeaponSel;
0619   D2E6 3A EB 60        ld   a, (gPlayerSecondWeaponSel)
0620   D2E9                 ; dialog/invent.c:265 a++;
0621   D2E9 3C              inc  a
0622   D2EA                 ; dialog/invent.c:266 if (a >= *(hl = &gPlayerSecondWeaponCount)) continue;
0623   D2EA 21 E1 60        ld   hl, gPlayerSecondWeaponCount
0624   D2ED BE              cp   (hl)
0625   D2EE D2 B8 D2        jp   nc, l16019
0626   D2F1                 ; dialog/invent.c:267 setSecondWeapon(a);
0627   D2F1 CD 63 D3        call setSecondWeapon
0628   D2F4                 ; dialog/invent.c:268 }
0629   D2F4                 ; dialog/invent.c:269 else if (a & KEY_UP)
0630   D2F4 C3 2C D3        jp   l16026
0631   D2F7             l16025: 
0632   D2F7 CB 47           bit  0, a
0633   D2F9                 ; dialog/invent.c:270 {
0634   D2F9 CA 0A D3        jp   z, l16027
0635   D2FC                 ; dialog/invent.c:271 a = selectedItem;
0636   D2FC 3A E1 D0        ld   a, (selectedItem)
0637   D2FF                 ; dialog/invent.c:272 a-=1;
0638   D2FF D6 01           sub  1
0639   D301                 ; dialog/invent.c:273 if (flag_c) continue;
0640   D301 DA B8 D2        jp   c, l16019
0641   D304                 ; dialog/invent.c:274 selectedItem = a;
0642   D304 32 E1 D0        ld   (selectedItem), a
0643   D307                 ; dialog/invent.c:275 }
0644   D307                 ; dialog/invent.c:276 else if (a & KEY_DOWN)
0645   D307 C3 2C D3        jp   l16028
0646   D30A             l16027: 
0647   D30A CB 4F           bit  1, a
0648   D30C                 ; dialog/invent.c:277 {
0649   D30C CA 20 D3        jp   z, l16029
0650   D30F                 ; dialog/invent.c:278 a = selectedItem;
0651   D30F 3A E1 D0        ld   a, (selectedItem)
0652   D312                 ; dialog/invent.c:279 a++;
0653   D312 3C              inc  a
0654   D313                 ; dialog/invent.c:280 if (a >= *(hl = &gPlayerItemsCount)) continue; //*(hl = &gPlayerItemsCount)) continue;
0655   D313 21 DE 60        ld   hl, gPlayerItemsCount
0656   D316 BE              cp   (hl)
0657   D317 D2 B8 D2        jp   nc, l16019
0658   D31A                 ; dialog/invent.c:281 selectedItem = a;
0659   D31A 32 E1 D0        ld   (selectedItem), a
0660   D31D                 ; dialog/invent.c:282 }
0661   D31D                 ; dialog/invent.c:283 else if (a & KEY_MENU)
0662   D31D C3 2C D3        jp   l16030
0663   D320             l16029: 
0664   D320 CB 6F           bit  5, a
0665   D322                 ; dialog/invent.c:284 {
0666   D322 CA 2C D3        jp   z, l16031
0667   D325                 ; dialog/invent.c:285 gBeginDraw();
0668   D325 CD 8A 60        call gBeginDraw
0669   D328                 ; dialog/invent.c:286 gEndDraw();
0670   D328 CD 8D 60        call gEndDraw
0671   D32B                 ; dialog/invent.c:287 return;
0672   D32B C9              ret
0673   D32C                 ; dialog/invent.c:288 }
0674   D32C                 ; dialog/invent.c:289 
0675   D32C                 ; dialog/invent.c:290 // Умножение на 10
0676   D32C                 ; dialog/invent.c:291 a = selectedItem;
0677   D32C             l16031: 
0678   D32C             l16030: 
0679   D32C             l16028: 
0680   D32C             l16026: 
0681   D32C             l16024: 
0682   D32C 3A E1 D0        ld   a, (selectedItem)
0683   D32F                 ; dialog/invent.c:292 c = (a += a);
0684   D32F 87              add  a
0685   D330 4F              ld   c, a
0686   D331                 ; dialog/invent.c:293 ((a += a) += a) += c;
0687   D331 87              add  a
0688   D332 87              add  a
0689   D333 81              add  c
0690   D334                 ; dialog/invent.c:294 
0691   D334                 ; dialog/invent.c:295 // Плавное перемещение курсора
0692   D334                 ; dialog/invent.c:296 hl = &selectedItem1;
0693   D334 21 E2 D0        ld   hl, selectedItem1
0694   D337                 ; dialog/invent.c:297 b = *hl;
0695   D337 46              ld   b, (hl)
0696   D338                 ; dialog/invent.c:298 if (a == b) continue; // Оставит флаг CF при выполнении dialogX1 - menuX
0697   D338 B8              cp   b
0698   D339 CA B8 D2        jp   z, l16019
0699   D33C                 ; dialog/invent.c:299 b++; // Не изменяет CF
0700   D33C 04              inc  b
0701   D33D                 ; dialog/invent.c:300 if (flag_c) ----b;
0702   D33D D2 42 D3        jp   nc, l16032
0703   D340 05              dec  b
0704   D341 05              dec  b
0705   D342                 ; dialog/invent.c:301 
0706   D342                 ; dialog/invent.c:302 // Стираем прошлый курсор
0707   D342                 ; dialog/invent.c:303 push(bc);
0708   D342             l16032: 
0709   D342 C5              push bc
0710   D343                 ; dialog/invent.c:304 drawItemCursor();
0711   D343 CD 52 D3        call drawItemCursor
0712   D346                 ; dialog/invent.c:305 pop(bc);
0713   D346 C1              pop  bc
0714   D347                 ; dialog/invent.c:306 
0715   D347                 ; dialog/invent.c:307 // Сохраняем новые координаты курсора
0716   D347                 ; dialog/invent.c:308 *(hl = &selectedItem1) = b;
0717   D347 21 E2 D0        ld   hl, selectedItem1
0718   D34A 70              ld   (hl), b
0719   D34B                 ; dialog/invent.c:309 
0720   D34B                 ; dialog/invent.c:310 // Рисуем курсор
0721   D34B                 ; dialog/invent.c:311 drawItemCursor();
0722   D34B CD 52 D3        call drawItemCursor
0723   D34E                 ; dialog/invent.c:312 }
0724   D34E C3 B8 D2        jp   l16019
0725   D351             l16020: 
0726   D351                 ; dialog/invent.c:313 }
0727   D351 C9              ret
0728   D352                 ; dialog/invent.c:314 
0729   D352                 ; dialog/invent.c:315 void drawItemCursor()
0730   D352             drawItemCursor: 
0731   D352                 ; dialog/invent.c:316 {
0732   D352                 ; dialog/invent.c:317 l = itemsCursorPos;
0733   D352 2E 09           ld   l, 14345
0734   D354                 ; dialog/invent.c:318 h = ((a = selectedItem1) += [itemsCursorPos >> 8]);
0735   D354 3A E2 D0        ld   a, (selectedItem1)
0736   D357 C6 38           add  56
0737   D359 67              ld   h, a
0738   D35A                 ; dialog/invent.c:319 gDrawTextEx(hl, de = "@", a = itemsCursorColor);
0739   D35A 11 DA D3        ld   de, s16004
0740   D35D 3E 43           ld   a, 67
0741   D35F CD 69 60        call gDrawTextEx
0742   D362                 ; dialog/invent.c:320 }
0743   D362 C9              ret
0744   D363                 ; dialog/invent.c:321 
0745   D363                 ; dialog/invent.c:322 void setSecondWeapon(a)
0746   D363             setSecondWeapon: 
0747   D363                 ; dialog/invent.c:323 {
0748   D363                 ; dialog/invent.c:324 push(a)
0749   D363                 ; dialog/invent.c:325 {
0750   D363 F5              push af
0751   D364                 ; dialog/invent.c:326 drawSecondWeaponCursor(ixh = secondWeaponTextInactiveColor);
0752   D364 DD 26 41        ld   ixh, 65
0753   D367 CD 83 D3        call drawSecondWeaponCursor
0754   D36A                 ; dialog/invent.c:327 }
0755   D36A F1              pop  af
0756   D36B                 ; dialog/invent.c:328 gPlayerSecondWeaponSel = a;
0757   D36B 32 EB 60        ld   (gPlayerSecondWeaponSel), a
0758   D36E                 ; dialog/invent.c:329 drawSecondWeaponCursor(ixh = secondWeaponTextActiveColor);
0759   D36E DD 26 47        ld   ixh, 71
0760   D371 CD 83 D3        call drawSecondWeaponCursor
0761   D374                 ; dialog/invent.c:330 gPanelChangedA = a = 0xFF;
0762   D374 3E FF           ld   a, 255
0763   D376 32 DF 60        ld   (gPanelChangedA), a
0764   D379                 ; dialog/invent.c:331 gPanelChangedB = a;
0765   D379 32 E0 60        ld   (gPanelChangedB), a
0766   D37C                 ; dialog/invent.c:332 gPanelRedraw();
0767   D37C CD 93 60        call gPanelRedraw
0768   D37F                 ; dialog/invent.c:333 return panelDrawSecondWeapon();
0769   D37F C3 19 D4        jp   panelDrawSecondWeapon
0770   D382                 ; dialog/invent.c:334 }
0771   D382 C9              ret
0772   D383                 ; dialog/invent.c:335 
0773   D383                 ; dialog/invent.c:336 void drawSecondWeaponCursor(ixh)
0774   D383             drawSecondWeaponCursor: 
0775   D383                 ; dialog/invent.c:337 {
0776   D383                 ; dialog/invent.c:338 a = gPlayerSecondWeaponSel;
0777   D383 3A EB 60        ld   a, (gPlayerSecondWeaponSel)
0778   D386                 ; dialog/invent.c:339 b = a; (a += a) += b;
0779   D386 47              ld   b, a
0780   D387 87              add  a
0781   D388 80              add  b
0782   D389                 ; dialog/invent.c:340 hl = [secondWeaponBwAddrForPict - 0x21]; l = (a += l);
0783   D389 21 21 40        ld   hl, 16417
0784   D38C 85              add  l
0785   D38D 6F              ld   l, a
0786   D38E                 ; dialog/invent.c:341 b = [(secondWeaponClAddrForPict - 0x21) >> 8]; c = l;
0787   D38E 06 58           ld   b, 88
0788   D390 4D              ld   c, l
0789   D391                 ; dialog/invent.c:342 de = &magic_10;    
0790   D391 11 94 D5        ld   de, magic_10
0791   D394                 ; dialog/invent.c:343 drawSpriteXor(bc, hl, de);
0792   D394 CD DA C8        call drawSpriteXor
0793   D397                 ; dialog/invent.c:344 drawSpriteXor(bc, hl, de);
0794   D397 CD DA C8        call drawSpriteXor
0795   D39A                 ; dialog/invent.c:345 drawSpriteXor(bc, hl, de);
0796   D39A CD DA C8        call drawSpriteXor
0797   D39D                 ; dialog/invent.c:346 drawSpriteXor(bc, hl, de);
0798   D39D CD DA C8        call drawSpriteXor
0799   D3A0                 ; dialog/invent.c:347 ixl = 2;
0800   D3A0 DD 2E 02        ld   ixl, 2
0801   D3A3                 ; dialog/invent.c:348 do
0802   D3A3             l16033: 
0803   D3A3                 ; dialog/invent.c:349 {
0804   D3A3                 ; dialog/invent.c:350 l = ((a = l) += [0x20 - 4]); c = l;
0805   D3A3 7D              ld   a, l
0806   D3A4 C6 1C           add  28
0807   D3A6 6F              ld   l, a
0808   D3A7 4D              ld   c, l
0809   D3A8                 ; dialog/invent.c:351 drawSpriteXor(bc, hl, de);
0810   D3A8 CD DA C8        call drawSpriteXor
0811   D3AB                 ; dialog/invent.c:352 l++; l++; c = l;
0812   D3AB 2C              inc  l
0813   D3AC 2C              inc  l
0814   D3AD 4D              ld   c, l
0815   D3AE                 ; dialog/invent.c:353 drawSpriteXor(bc, hl, de);
0816   D3AE CD DA C8        call drawSpriteXor
0817   D3B1                 ; dialog/invent.c:354 } while (flag_nz --ixl);
0818   D3B1 DD 2D           dec  ixl
0819   D3B3 C2 A3 D3        jp   nz, l16033
0820   D3B6             l16034: 
0821   D3B6                 ; dialog/invent.c:355 l = ((a = l) += [0x20 - 4]); c = l;
0822   D3B6 7D              ld   a, l
0823   D3B7 C6 1C           add  28
0824   D3B9 6F              ld   l, a
0825   D3BA 4D              ld   c, l
0826   D3BB                 ; dialog/invent.c:356 drawSpriteXor(bc, hl, de);
0827   D3BB CD DA C8        call drawSpriteXor
0828   D3BE                 ; dialog/invent.c:357 drawSpriteXor(bc, hl, de);
0829   D3BE CD DA C8        call drawSpriteXor
0830   D3C1                 ; dialog/invent.c:358 drawSpriteXor(bc, hl, de);
0831   D3C1 CD DA C8        call drawSpriteXor
0832   D3C4                 ; dialog/invent.c:359 drawSpriteXor(bc, hl, de);
0833   D3C4 CD DA C8        call drawSpriteXor
0834   D3C7                 ; dialog/invent.c:360 }
0835   D3C7 C9              ret
0836   D3C8                 ; dialog/invent.c:361 
0837   D3C8                 ; strings
0838   D3C8             s16001 db 22,23,24,21,25,26,27,2,0
0838   D3C8 16171815191A1B0200
0839   D3D1             s16003 db 26,27,28,21,29,30,31,2,0
0839   D3D1 1A1B1C151D1E1F0200
0840   D3DA 40 00       s16004 db "@",0
0841   D3DC             s16002 db " ",0
0841   D3DC CEE1FBF7EDE0FF20E7E0F9E8F2E000
0842   D3EB             s16000 db " ",0
0842   D3EB CEE1FBF7EDEEE520EEF0F3E6E8E500
0843   D3FA             
0001   D3FA                 ; dialog/panel.c:2 
0002   D3FA                 ; dialog/panel.c:3 const int gPanelX = 0;
0003   D3FA                 ; dialog/panel.c:4 const int gPanelY = 20;
0004   D3FA                 ; dialog/panel.c:5 
0005   D3FA                 ; dialog/panel.c:6 void panelFullRedraw()
0006   D3FA             panelFullRedraw: 
0007   D3FA                 ; dialog/panel.c:7 {
0008   D3FA                 ; dialog/panel.c:8 gDrawImage(de = [0x5800 + gPanelX + (gPanelY << 5)], hl = &image_panelgraph);
0009   D3FA 11 80 5A        ld   de, 23168
0010   D3FD 21 76 C9        ld   hl, image_panelgraph
0011   D400 CD 6F 60        call gDrawImage
0012   D403                 ; dialog/panel.c:9 return panelRedrawImages();
0013   D403 C3 07 D4        jp   panelRedrawImages
0014   D406                 ; dialog/panel.c:10 }
0015   D406 C9              ret
0016   D407                 ; dialog/panel.c:11 
0017   D407                 ; dialog/panel.c:12 void panelRedrawImages()
0018   D407             panelRedrawImages: 
0019   D407                 ; dialog/panel.c:13 {
0020   D407                 ; dialog/panel.c:14 panelDrawSecondWeapon();
0021   D407 CD 19 D4        call panelDrawSecondWeapon
0022   D40A                 ; dialog/panel.c:15 }
0023   D40A C9              ret
0024   D40B                 ; dialog/panel.c:16 
0025   D40B                 ; dialog/panel.c:17 void deMulA36(a) // a должно быть меньше 16
0026   D40B             deMulA36: 
0027   D40B                 ; dialog/panel.c:18 {
0028   D40B                 ; dialog/panel.c:19 a += a += a;
0029   D40B 87              add  a
0030   D40C 87              add  a
0031   D40D                 ; dialog/panel.c:20 c = a;
0032   D40D 4F              ld   c, a
0033   D40E                 ; dialog/panel.c:21 a += a += a;
0034   D40E 87              add  a
0035   D40F 87              add  a
0036   D410                 ; dialog/panel.c:22 l = a; h = 0; b = h;
0037   D410 6F              ld   l, a
0038   D411 26 00           ld   h, 0
0039   D413 44              ld   b, h
0040   D414                 ; dialog/panel.c:23 hl += hl += bc += de;
0041   D414 29              add  hl, hl
0042   D415 09              add  hl, bc
0043   D416 19              add  hl, de
0044   D417                 ; dialog/panel.c:24 ex(hl, de);
0045   D417 EB              ex de, hl
0046   D418                 ; dialog/panel.c:25 }
0047   D418 C9              ret
0048   D419                 ; dialog/panel.c:26 
0049   D419                 ; dialog/panel.c:27 void panelDrawSecondWeapon()
0050   D419             panelDrawSecondWeapon: 
0051   D419                 ; dialog/panel.c:28 {
0052   D419                 ; dialog/panel.c:29 deMulA36(a = gPlayerSecondWeaponSel, de = &magic_0);
0053   D419 3A EB 60        ld   a, (gPlayerSecondWeaponSel)
0054   D41C 11 2C D4        ld   de, magic_0
0055   D41F CD 0B D4        call deMulA36
0056   D422                 ; dialog/panel.c:30 return drawSprite4(hl = 0x5AB8, bc = 0x50B8, de);
0057   D422 21 B8 5A        ld   hl, 23224
0058   D425 01 B8 50        ld   bc, 20664
0059   D428 C3 C0 C8        jp   drawSprite4
0060   D42B                 ; dialog/panel.c:31 }
0061   D42B C9              ret
0062   D42C                 ; dialog/panel.c:32 
0063   D42C             
0001   D42C             magic_0:  ; 0
0002   D42C                 db 001h, 007h, 01Fh, 006h, 001h, 000h, 000h, 003h, 046h
0002   D42C 01071F060100000346
0003   D435                 db 080h, 0C0h, 040h, 040h, 080h, 030h, 0F8h, 0E8h, 047h
0003   D435 80C040408030F8E847
0004   D43E                 db 000h, 000h, 001h, 007h, 01Fh, 006h, 001h, 000h, 006h
0004   D43E 000001071F06010006
0005   D447                 db 0C8h, 030h, 080h, 0C0h, 040h, 040h, 080h, 000h, 007h
0005   D447 C83080C04040800007
0006   D450             magic_1:  ; 0
0007   D450                 db 000h, 000h, 003h, 007h, 00Fh, 01Fh, 03Ch, 07Fh, 045h
0007   D450 000003070F1F3C7F45
0008   D459                 db 000h, 000h, 0C0h, 0F0h, 0C0h, 000h, 000h, 080h, 005h
0008   D459 0000C0F0C000008005
0009   D462                 db 00Fh, 001h, 013h, 01Fh, 00Fh, 00Eh, 008h, 000h, 047h
0009   D462 0F01131F0F0E080047
0010   D46B                 db 0F0h, 0FCh, 0C0h, 0F0h, 0C0h, 000h, 000h, 000h, 007h
0010   D46B F0FCC0F0C000000007
0011   D474             magic_2:  ; 0
0012   D474                 db 000h, 000h, 007h, 00Fh, 01Fh, 01Fh, 019h, 009h, 041h
0012   D474 0000070F1F1F190941
0013   D47D                 db 000h, 000h, 0E0h, 0F0h, 0F8h, 0F8h, 098h, 090h, 041h
0013   D47D 0000E0F0F8F8989041
0014   D486                 db 00Fh, 006h, 007h, 004h, 003h, 000h, 000h, 000h, 041h
0014   D486 0F0607040300000041
0015   D48F                 db 0F0h, 060h, 0E0h, 020h, 0C0h, 000h, 000h, 000h, 041h
0015   D48F F060E020C000000041
0016   D498             magic_3:  ; 0
0017   D498                 db 003h, 00Ch, 010h, 038h, 04Eh, 04Fh, 087h, 087h, 043h
0017   D498 030C10384E4F878743
0018   D4A1                 db 0C0h, 030h, 008h, 01Ch, 072h, 0F2h, 0E1h, 0E1h, 043h
0018   D4A1 C030081C72F2E1E143
0019   D4AA                 db 08Fh, 0BFh, 07Fh, 043h, 023h, 011h, 00Dh, 003h, 003h
0019   D4AA 8FBF7F4323110D0303
0020   D4B3                 db 0F1h, 0FDh, 0FEh, 0C2h, 0C4h, 088h, 0B0h, 0C0h, 003h
0020   D4B3 F1FDFEC2C488B0C003
0021   D4BC             magic_4:  ; 0
0022   D4BC                 db 000h, 004h, 012h, 012h, 036h, 036h, 077h, 067h, 042h
0022   D4BC 000412123636776742
0023   D4C5                 db 000h, 080h, 080h, 0C4h, 0C4h, 0E6h, 073h, 07Bh, 046h
0023   D4C5 008080C4C4E6737B46
0024   D4CE                 db 009h, 044h, 026h, 033h, 073h, 063h, 066h, 036h, 056h
0024   D4CE 094426337363663656
0025   D4D7                 db 03Fh, 0BFh, 09Eh, 09Eh, 03Ch, 03Ch, 078h, 0E0h, 056h
0025   D4D7 3FBF9E9E3C3C78E056
0026   D4E0             magic_5:  ; 0
0027   D4E0                 db 000h, 008h, 018h, 030h, 064h, 06Dh, 0C8h, 0DAh, 004h
0027   D4E0 00081830646DC8DA04
0028   D4E9                 db 000h, 010h, 018h, 00Ch, 026h, 0B6h, 013h, 05Bh, 044h
0028   D4E9 0010180C26B6135B44
0029   D4F2                 db 0DAh, 0C8h, 06Dh, 064h, 030h, 018h, 008h, 000h, 044h
0029   D4F2 DAC86D643018080044
0030   D4FB                 db 05Bh, 013h, 0B6h, 026h, 00Ch, 018h, 010h, 000h, 004h
0030   D4FB 5B13B6260C18100004
0031   D504             magic_6:  ; 0
0032   D504                 db 002h, 009h, 029h, 019h, 079h, 005h, 082h, 07Ch, 045h
0032   D504 020929197905827C45
0033   D50D                 db 080h, 020h, 028h, 030h, 03Ch, 040h, 082h, 07Ch, 047h
0033   D50D 802028303C40827C47
0034   D516                 db 082h, 005h, 079h, 019h, 029h, 009h, 002h, 000h, 007h
0034   D516 820579192909020007
0035   D51F                 db 082h, 040h, 03Ch, 030h, 028h, 020h, 080h, 000h, 005h
0035   D51F 82403C302820800005
0036   D528             magic_7:  ; 0
0037   D528                 db 000h, 000h, 010h, 010h, 010h, 030h, 031h, 031h, 042h
0037   D528 000010101030313142
0038   D531                 db 000h, 000h, 004h, 084h, 084h, 08Ch, 08Ch, 08Ch, 002h
0038   D531 00000484848C8C8C02
0039   D53A                 db 069h, 04Bh, 032h, 001h, 000h, 000h, 000h, 000h, 046h
0039   D53A 694B32010000000046
0040   D543                 db 09Ah, 052h, 04Ch, 080h, 000h, 000h, 000h, 000h, 006h
0040   D543 9A524C800000000006
0041   D54C             magic_8:  ; 0
0042   D54C                 db 000h, 000h, 020h, 030h, 078h, 07Ch, 0C6h, 0C1h, 043h
0042   D54C 00002030787CC6C143
0043   D555                 db 000h, 004h, 00Ch, 01Eh, 036h, 043h, 003h, 003h, 042h
0043   D555 00040C1E3643030342
0044   D55E                 db 0C0h, 0C0h, 0C2h, 06Ch, 078h, 030h, 020h, 000h, 002h
0044   D55E C0C0C26C7830200002
0045   D567                 db 083h, 063h, 03Eh, 01Eh, 00Ch, 004h, 000h, 000h, 003h
0045   D567 83633E1E0C04000003
0046   D570             magic_9:  ; 0
0047   D570                 db 000h, 010h, 06Ch, 092h, 082h, 06Ch, 038h, 010h, 046h
0047   D570 00106C92826C381046
0048   D579                 db 000h, 010h, 06Ch, 092h, 082h, 06Ch, 038h, 010h, 046h
0048   D579 00106C92826C381046
0049   D582                 db 010h, 010h, 050h, 070h, 030h, 070h, 050h, 000h, 046h
0049   D582 101050703070500046
0050   D58B                 db 010h, 010h, 050h, 070h, 030h, 070h, 050h, 000h, 046h
0050   D58B 101050703070500046
0051   D594             magic_10:  ; 0
0052   D594                 db 000h, 000h, 000h, 000h, 000h, 000h, 002h, 000h, 047h
0052   D594 000000000000020047
0053   D59D                 db 000h, 000h, 000h, 000h, 000h, 000h, 0AAh, 000h, 047h
0053   D59D 000000000000AA0047
0054   D5A6                 db 000h, 000h, 000h, 000h, 000h, 000h, 0AAh, 000h, 047h
0054   D5A6 000000000000AA0047
0055   D5AF                 db 000h, 000h, 000h, 000h, 000h, 000h, 080h, 040h, 047h
0055   D5AF 000000000000804047
0056   D5B8                 db 002h, 000h, 002h, 000h, 002h, 000h, 002h, 000h, 047h
0056   D5B8 020002000200020047
0057   D5C1                 db 000h, 040h, 000h, 040h, 000h, 040h, 000h, 040h, 047h
0057   D5C1 004000400040004047
0058   D5CA                 db 002h, 000h, 002h, 000h, 002h, 000h, 002h, 000h, 047h
0058   D5CA 020002000200020047
0059   D5D3                 db 000h, 040h, 000h, 040h, 000h, 040h, 000h, 040h, 047h
0059   D5D3 004000400040004047
0060   D5DC                 db 002h, 001h, 000h, 000h, 000h, 000h, 000h, 000h, 047h
0060   D5DC 020100000000000047
0061   D5E5                 db 000h, 055h, 000h, 000h, 000h, 000h, 000h, 000h, 047h
0061   D5E5 005500000000000047
0062   D5EE                 db 000h, 055h, 000h, 000h, 000h, 000h, 000h, 000h, 047h
0062   D5EE 005500000000000047
0063   D5F7                 db 000h, 040h, 000h, 000h, 000h, 000h, 000h, 000h, 047h
0063   D5F7 004000000000000047
0064   D600             
0001   D600                 ; dialog/descr.c:2 
0002   D600                 ; dialog/descr.c:3 #include "common.h"
0003   D600                 ; dialog/descr.c:4 
0004   D600                 ; common.h:2 const int itemsCount = 8;
0005   D600                 ; common.h:3 
0006   D600                 ; common.h:4 // Размер глобального строкового буфера
0007   D600                 ; common.h:5 const int gStringBufferSize = 32;
0008   D600                 ; common.h:6 
0009   D600                 ; common.h:7 // Флаги для переменных gPanelChangedA, gPanelChangedB
0010   D600                 ; common.h:8 const int gPanelChangedMoney = 0x01;
0011   D600                 ; common.h:9 const int gPanelChangedPlace = 0x02;
0012   D600                 ; common.h:10 //const int gPanelChangedImages = 0x04;
0013   D600                 ; common.h:11 const int gPanelChanedSecondWeaponCount = 0x08;
0014   D600                 ; common.h:12 const int gPanelChanedArmorCount = 0x10;
0015   D600                 ; common.h:13 
0016   D600                 ; common.h:14 // Максимальное кол-во символов (не учитывая терминатор строки), которое возращает функция numberToString16
0017   D600                 ; common.h:15 const int numberToString16max = 5;
0018   D600                 ; common.h:16 
0019   D600                 ; common.h:17 // Максимальное кол-во предметов у игрока
0020   D600                 ; common.h:18 const int playerItemsMax = 5;
0021   D600                 ; common.h:19 
0022   D600                 ; common.h:20 // Максимальное кол-во типов лута у игрока (кол-во отображаемых строк в инвентаре)
0023   D600                 ; common.h:21 const int playerLutMax = 12;
0024   D600                 ; common.h:22 
0025   D600                 ; common.h:23 // Максимальное кол-во лута у игрока (сумма)
0026   D600                 ; common.h:24 const int playerLutMaxCountInLine = 99;
0027   D600                 ; common.h:25 
0028   D600                 ; common.h:26 const int secondWeaponMax = 9;
0029   D600                 ; common.h:27 
0030   D600                 ; common.h:28 // Флаги клавиш для переменные gKeyPressed, gKeyTrigger
0031   D600                 ; common.h:29 const int KEY_UP = 1;
0032   D600                 ; common.h:30 const int KEY_DOWN = 2;
0033   D600                 ; common.h:31 const int KEY_LEFT = 4;
0034   D600                 ; common.h:32 const int KEY_RIGHT = 8;
0035   D600                 ; common.h:33 const int KEY_FIRE = 16;
0036   D600                 ; common.h:34 const int KEY_MENU = 32;
0037   D600                 ; common.h:35 
0038   D600                 ; common.h:36 // Стандартные адреса ZX Spectrum
0039   D600                 ; common.h:37 const int screenBw0 = 0x4000;
0040   D600                 ; common.h:38 const int screenAttr0 = 0x5800;
0041   D600                 ; common.h:39 
0042   D600                 ; common.h:40 // Размеры экрана
0043   D600                 ; common.h:41 const int screenWidthTails = 32;
0044   D600                 ; common.h:42 const int panelHeightTails = 4;
0045   D600                 ; common.h:43 const int tailHeight = 8;
0046   D600                 ; common.h:44 const int tailWidth = 8;
0047   D600                 ; common.h:45 const int playfieldHeightTails = 20;
0048   D600                 ; common.h:46 
0049   D600                 ; common.h:47 // Используется при упаковке координат X, Y в регистровую пару
0050   D600                 ; common.h:48 const int bpl = 256;
0051   D600                 ; common.h:49 
0052   D600                 ; common.h:50 // Точки входа
0053   D600                 ; common.h:51 const int gPanelRedrawImagesPage = 6;
0054   D600                 ; common.h:52 const int gPanelRedrawImages = 0xC006;
0055   D600                 ; common.h:53 const int gInventPage = 6;
0056   D600                 ; common.h:54 const int gInvent = 0xC000;
0057   D600                 ; common.h:55 
0058   D600                 ; common.h:56 // Параметр для drawText
0059   D600                 ; common.h:57 const int smallFontFlag = 0x80;
0060   D600                 ; common.h:58 
0061   D600                 ; dialog/descr.c:5 uint16_t itemNames[itemsCount] = {
0062   D600                 ; dialog/descr.c:6 "Отвар листьев",
0063   D600                 ; dialog/descr.c:7 "Полное исцеление",
0064   D600                 ; dialog/descr.c:8 "Заклинание 1",
0065   D600                 ; dialog/descr.c:9 "Магические силы",
0066   D600                 ; dialog/descr.c:10 "Каменная кожа",
0067   D600                 ; dialog/descr.c:11 "Огонь бездны",
0068   D600                 ; dialog/descr.c:12 "Порча",
0069   D600                 ; dialog/descr.c:13 "Телепортация"
0070   D600                 ; dialog/descr.c:14 };
0071   D600             itemNames: 
0072   D600 E5 D6           dw s22000
0073   D602 F9 D6           dw s22001
0074   D604 50 D6           dw s22002
0075   D606 B1 D6           dw s22003
0076   D608 72 D6           dw s22004
0077   D60A D8 D6           dw s22005
0078   D60C 0A D7           dw s22006
0079   D60E 16 D7           dw s22007
0080   D610                 ; dialog/descr.c:15 
0081   D610                 ; dialog/descr.c:16 uint16_t lutNames[] = {
0082   D610                 ; dialog/descr.c:17 "Кожа змеи",
0083   D610                 ; dialog/descr.c:18 "Нож хобгоблина",
0084   D610                 ; dialog/descr.c:19 "Ядовитый клык",
0085   D610                 ; dialog/descr.c:20 "Кровь дракона!",
0086   D610                 ; dialog/descr.c:21 "Кислота",
0087   D610                 ; dialog/descr.c:22 "Перья",
0088   D610                 ; dialog/descr.c:23 "Слизь",
0089   D610                 ; dialog/descr.c:24 "Копыта",
0090   D610                 ; dialog/descr.c:25 "Кольчуга",
0091   D610                 ; dialog/descr.c:26 "Изумруд",
0092   D610                 ; dialog/descr.c:27 "Золотое руно",
0093   D610                 ; dialog/descr.c:28 "Майоран"
0094   D610                 ; dialog/descr.c:29 };
0095   D610             lutNames: 
0096   D610 88 D6           dw s22008
0097   D612 C9 D6           dw s22009
0098   D614 89 D7           dw s22010
0099   D616 A2 D6           dw s22011
0100   D618 80 D6           dw s22012
0101   D61A F3 D6           dw s22013
0102   D61C 10 D7           dw s22014
0103   D61E 9B D6           dw s22015
0104   D620 92 D6           dw s22016
0105   D622 6A D6           dw s22017
0106   D624 5D D6           dw s22018
0107   D626 C1 D6           dw s22019
0108   D628                 ; dialog/descr.c:30 
0109   D628                 ; dialog/descr.c:31 uint16_t lutPrices[] = {
0110   D628                 ; dialog/descr.c:32 1,
0111   D628                 ; dialog/descr.c:33 2,
0112   D628                 ; dialog/descr.c:34 3
0113   D628                 ; dialog/descr.c:35 };
0114   D628             lutPrices: 
0115   D628 01 00           dw 1
0116   D62A 02 00           dw 2
0117   D62C 03 00           dw 3
0118   D62E                 ; dialog/descr.c:36 
0119   D62E                 ; dialog/descr.c:37 uint16_t itemInfo[itemsCount] = {
0120   D62E                 ; dialog/descr.c:38 "*", //"Восстанавливает 10 единиц здоровья\r",
0121   D62E                 ; dialog/descr.c:39 
0122   D62E                 ; dialog/descr.c:40 "*", //"Полностью восстанавливает здоровье\r",
0123   D62E                 ; dialog/descr.c:41 
0124   D62E                 ; dialog/descr.c:42 "*", //"Полностью восстанавливает\n"
0125   D62E                 ; dialog/descr.c:43 //"заклинание 1\r",
0126   D62E                 ; dialog/descr.c:44 
0127   D62E                 ; dialog/descr.c:45 "*", //"Полностью восстанавливает\n"
0128   D62E                 ; dialog/descr.c:46 //"все заклинания\r",
0129   D62E                 ; dialog/descr.c:47 
0130   D62E                 ; dialog/descr.c:48 "Это заклинание делает вашу\n"
0131   D62E                 ; dialog/descr.c:49 "плоть твердой как камень.\n"
0132   D62E                 ; dialog/descr.c:50 "Пока заклинание активно,\n"
0133   D62E                 ; dialog/descr.c:51 "урон уменьшается вдвое.",
0134   D62E                 ; dialog/descr.c:52 
0135   D62E                 ; dialog/descr.c:53 "*", //"Полностью восстанавливает амулет\r",
0136   D62E                 ; dialog/descr.c:54 
0137   D62E                 ; dialog/descr.c:55 "*", //"Пока заклинание активно,\n"
0138   D62E                 ; dialog/descr.c:56 //"каждая ваша атака наноит в\n"
0139   D62E                 ; dialog/descr.c:57 //"два раза больше урона врагу.\r",
0140   D62E                 ; dialog/descr.c:58 
0141   D62E                 ; dialog/descr.c:59 "*" //"Это заклинание возращает\n"
0142   D62E                 ; dialog/descr.c:60 //"Вас в последний посещенный\n"
0143   D62E                 ; dialog/descr.c:61 //"вами город.\r"
0144   D62E                 ; dialog/descr.c:62 };
0145   D62E             itemInfo: 
0146   D62E 4E D6           dw s22020
0147   D630 4E D6           dw s22020
0148   D632 4E D6           dw s22020
0149   D634 4E D6           dw s22020
0150   D636 23 D7           dw s22021
0151   D638 4E D6           dw s22020
0152   D63A 4E D6           dw s22020
0153   D63C 4E D6           dw s22020
0154   D63E                 ; dialog/descr.c:63 
0155   D63E                 ; dialog/descr.c:64 uint16_t itemPrices[itemsCount] = {
0156   D63E                 ; dialog/descr.c:65 10,
0157   D63E                 ; dialog/descr.c:66 20,
0158   D63E                 ; dialog/descr.c:67 30,
0159   D63E                 ; dialog/descr.c:68 40,
0160   D63E                 ; dialog/descr.c:69 50,
0161   D63E                 ; dialog/descr.c:70 60,
0162   D63E                 ; dialog/descr.c:71 70,
0163   D63E                 ; dialog/descr.c:72 80
0164   D63E                 ; dialog/descr.c:73 };
0165   D63E             itemPrices: 
0166   D63E 0A 00           dw 10
0167   D640 14 00           dw 20
0168   D642 1E 00           dw 30
0169   D644 28 00           dw 40
0170   D646 32 00           dw 50
0171   D648 3C 00           dw 60
0172   D64A 46 00           dw 70
0173   D64C 50 00           dw 80
0174   D64E                 ; dialog/descr.c:74 
0175   D64E                 ; strings
0176   D64E 2A 00       s22020 db "*",0
0177   D650             s22002 db " 1",0
0177   D650 C7E0EAEBE8EDE0EDE8E5203100
0178   D65D             s22018 db " ",0
0178   D65D C7EEEBEEF2EEE520F0F3EDEE00
0179   D66A             s22017 db "",0
0179   D66A C8E7F3ECF0F3E400
0180   D672             s22004 db " ",0
0180   D672 CAE0ECE5EDEDE0FF20EAEEE6E000
0181   D680             s22012 db "",0
0181   D680 CAE8F1EBEEF2E000
0182   D688             s22008 db " ",0
0182   D688 CAEEE6E020E7ECE5E800
0183   D692             s22016 db "",0
0183   D692 CAEEEBFCF7F3E3E000
0184   D69B             s22015 db "",0
0184   D69B CAEEEFFBF2E000
0185   D6A2             s22011 db " !",0
0185   D6A2 CAF0EEE2FC20E4F0E0EAEEEDE02100
0186   D6B1             s22003 db " ",0
0186   D6B1 CCE0E3E8F7E5F1EAE8E520F1E8EBFB00
0187   D6C1             s22019 db "",0
0187   D6C1 CCE0E9EEF0E0ED00
0188   D6C9             s22009 db " ",0
0188   D6C9 CDEEE620F5EEE1E3EEE1EBE8EDE000
0189   D6D8             s22005 db " ",0
0189   D6D8 CEE3EEEDFC20E1E5E7E4EDFB00
0190   D6E5             s22000 db " ",0
0190   D6E5 CEF2E2E0F020EBE8F1F2FCE5E200
0191   D6F3             s22013 db "",0
0191   D6F3 CFE5F0FCFF00
0192   D6F9             s22001 db " ",0
0192   D6F9 CFEEEBEDEEE520E8F1F6E5EBE5EDE8E500
0193   D70A             s22006 db "",0
0193   D70A CFEEF0F7E000
0194   D710             s22014 db "",0
0194   D710 D1EBE8E7FC00
0195   D716             s22007 db "",0
0195   D716 D2E5EBE5EFEEF0F2E0F6E8FF00
0196   D723             s22021 db "   ",10,"   .",10,"  ,",10,"  .",0
0196   D723 DDF2EE20E7E0EAEBE8EDE0EDE8E520E4E5EBE0E5F220E2E0F8F30AEFEBEEF2FC
0196   D743 20F2E2E5F0E4EEE920EAE0EA20EAE0ECE5EDFC2E0ACFEEEAE020E7E0EAEBE8ED
0196   D763 E0EDE8E520E0EAF2E8E2EDEE2C0AF3F0EEED20F3ECE5EDFCF8E0E5F2F1FF20E2
0196   D783 E4E2EEE52E00
0197   D789             s22010 db " ",0
0197   D789 DFE4EEE2E8F2FBE920EAEBFBEA00
0198   D797             
0001   D797                 savebin "dialog/dialog.C", begin, $ - begin ; dialog/dialog.asm dialog/div16.asm dialog/alg.asm dialog/shop.asm dialog/tools.asm dialog/dialogrect.asm dialog/panelgraph.asm dialog/inventgraph.asm dialog/invent.asm dialog/panel.asm dialog/magic.asm dialog/descr.asm
0002   D797             
